@using DEWAXP.Foundation.Integration.CorporatePortal
@using DEWAXP.Foundation.Helpers
@using Sitecore.Mvc.Configuration
@using Sitecore.Globalization
@using DEWAXP.Foundation.Content
@using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, FormMethod.Post, new { @class = "form static-form", @id = "form-meetingrequest", data_form = "true", enctype = "multipart/form-data" }))
{
    var fromtotime = DEWAXP.Feature.Partner.Models.CorporatePartnership.CPHelpers.GetFromToTime();
    @Html.AntiForgeryToken()
    <style type="text/css">
        .picker {
            width: 330px !important;
        }

        @@media screen and (max-width: 1024px) {
            .picker {
                width: 100% !important;
            }
        }
    </style>
    <div class="m39-modal__header">
        <div class="m39-modal__title">@Translate.Text("cpportal.Request")</div>
        <a data-close="true" class="m39-modal__button--close" id="_qnz27sx8u_close" aria-controls="_qnz27sx8u_content"></a>
    </div>
    <div class="m39-modal__content" id="_qnz27sx8u_content">
        <div class="grid__row">
            <div class="grid__column grid__column--12">
                <fieldset class="fieldset">
                    <legend class="legend-color">.</legend>
                    @if (Model)
                    {
                        var cplist = DEWAXP.Feature.Partner.Models.CorporatePartnership.CPHelpers.GetCPMeetingRequestTypes();
                        int i = 1;
                        <div class="form-field form-field--select form-field--select-single form-field--select-single--6">
                            <label for="form-field-requesttype" class="form-field__label">
                                @Translate.Text("cpportal.Event Type")
                            </label>
                            <span class="form-field__input-wrapper form-field__input-wrapper--select">
                                <select class="form-field__input form-field__input--select form-field__input--select-full"
                                        id="form-field-requesttype"
                                        name="requesttype"
                                        aria-describedby="description-for-requesttype"
                                        data-parsley-errors-container="#description-for-requesttype"
                                        data-parsley-trigger="change"
                                        data-parsley-id="1">
                                    <option>@Translate.Text("cpportal_requestTypeOption")</option>
                                    @foreach (var selectList in cplist)
                                    {
                                        <option value="@selectList.Value" @(i == 1 ? @"selected=""" : "")>@selectList.Text</option>
                                        i++;
                                    }


                                </select>
                            </span>
                            <div id="description-for-requesttype" class="form-field__messages">
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="form-field form-field--text  ">
                            <label for="form-field-requesttype" class="form-field__label">
                                @Translate.Text("cpportal.Request Type")
                                <span class="form-field__label-required aria-only">(required)</span>
                            </label>
                            <span class="form-field__input-wrapper">
                                <input class="form-field__input form-field__input--text"
                                       id="form-field-requesttype"
                                       name="requesttype"
                                       type="text"
                                       placeholder="@Translate.Text("cpportal.Request Typeph")"
                                       aria-describedby="description-for-requesttype"
                                       data-parsley-errors-container="#description-for-requesttype"
                                       required=""
                                       data-parsley-required-message="@Translate.Text("cpportal.Request Typemsg")"
                                       data-parsley-trigger="focusout"
                                       data-parsley-id="2"
                                       readonly="readonly">
                            </span>
                            <div id="description-for-requesttype" class="form-field__messages">
                            </div>
                        </div>
                    }
                    <div class="form-field form-field--text  ">
                        <label for="form-field-location" class="form-field__label">
                            @Translate.Text("cpportal.Location")
                            <span class="form-field__label-required aria-only">(required)</span>
                        </label>
                        <span class="form-field__input-wrapper">
                            <input class="form-field__input form-field__input--text"
                                   id="form-field-location"
                                   name="location"
                                   type="text"
                                   placeholder="@Translate.Text("cpportal.Locationph")"
                                   aria-describedby="description-for-location"
                                   data-parsley-errors-container="#description-for-location"
                                   required=""
                                   maxlength="100"
                                   data-parsley-required-message="@Translate.Text("cpportal.Locationmsg")"
                                   data-parsley-trigger="focusout"
                                   data-parsley-id="3">
                        </span>
                        <div id="description-for-location" class="form-field__messages">
                        </div>
                    </div>
                    <div class="form-field form-field--text  ">
                        <label for="form-field-eventname" class="form-field__label">
                            @Translate.Text("cpportal.Event Name")
                            <span class="form-field__label-required aria-only">(required)</span>
                        </label>
                        <span class="form-field__input-wrapper">
                            <input class="form-field__input form-field__input--text"
                                   id="form-field-eventname"
                                   name="eventName"
                                   type="text"
                                   placeholder="@Translate.Text("cpportal.Event Nameph")"
                                   aria-describedby="description-for-eventname"
                                   data-parsley-errors-container="#description-for-eventname"
                                   required=""
                                   maxlength="100"
                                   data-parsley-required-message="@Translate.Text("cpportal.Event Namemsg")"
                                   data-parsley-trigger="focusout"
                                   data-parsley-id="4">
                        </span>
                        <div id="description-for-eventname" class="form-field__messages">
                        </div>
                    </div>
                    <div class="form-field form-field--select form-field--select-single">
                        <label for="form-field-tolist1" class="form-field__label">
                            @Translate.Text("cpportal.Attendees")
                        </label>
                        <span class="form-field__input-wrapper form-field__input-wrapper--select removePseudo">
                            <select class="m5-quick-services--mail_select form-field__input form-field__input--select form-field__input--select-full form-field__input--select2 select2-hidden-accessible"
                                    id="form-field-tolist1" select2-isemail="true"
                                    name="division_linkage" multiple=""
                                    aria-describedby="description-for-tolist1"
                                    data-parsley-errors-container="#description-for-tolist1"
                                    placeholder="@Translate.Text("cpportal.Attendeesph")"
                                    required=""
                                    data-parsley-required-message="@Translate.Text("cpportal.Attendeesmsg")"
                                    data-select2-id="form-field-tolist1" data-parsley-id="5"
                                    tabindex="-1" aria-hidden="true" data-parsley-trigger="change"></select>
                        </span>
                        <div id="description-for-tolist1" class="form-field__messages">
                        </div>
                    </div>
                    <div id="datepicker-container-fromdate" class="form-field form-field--text form-field--select-single--4">
                        <label for="form-field-fromdate" class="form-field__label">
                            @Translate.Text("cpportal.From")
                            <span class="form-field__label-required aria-only">(required)</span>
                        </label>
                        <span class="form-field__input-wrapper form-field__input-wrapper--datepicker">
                            <input class="form-field__input form-field__input--text form-field__input--datepicker picker__input"
                                   id="form-field-fromdate"
                                   name="fromdate"
                                   type="text"
                                   placeholder="@Translate.Text("cpportal.Fromph")"
                                   aria-describedby="description-for-fromdate"
                                   data-parsley-errors-container="#description-for-fromdate"
                                   required=""
                                   data-parsley-required-message="@Translate.Text("cpportal.Frommsg")"
                                   data-el="datepicker-future"
                                   readonly=""
                                   aria-haspopup="true"
                                   aria-expanded="false"
                                   aria-readonly="false"
                                   data-scroll="false" data-parsley-id="6">
                            <input type="hidden" name="text-dateFrom_submit">
                        </span>
                        <div id="description-for-fromdate" class="form-field__messages">
                        </div>
                    </div>
                    <div id="datepicker-container-todate" class="form-field form-field--text form-field--select-single--4">
                        <label for="form-field-todate" class="form-field__label">
                            @Translate.Text("cpportal.To")
                            <span class="form-field__label-required aria-only">(required)</span>
                        </label>
                        <span class="form-field__input-wrapper form-field__input-wrapper--datepicker">
                            <input class="form-field__input form-field__input--text form-field__input--datepicker picker__input"
                                   id="form-field-todate"
                                   name="todate"
                                   type="text"
                                   placeholder="@Translate.Text("cpportal.Toph")"
                                   aria-describedby="description-for-todate"
                                   data-parsley-errors-container="#description-for-todate"
                                   required=""
                                   data-parsley-required-message="@Translate.Text("cpportal.Tomsg")"
                                   data-el="datepicker"
                                   data-scroll="false"
                                   aria-haspopup="true"
                                   aria-expanded="false"
                                   aria-readonly="false" data-parsley-id="7">
                            <input type="hidden" name="text-dateTo_submit">
                        </span>
                        <div id="description-for-todate" class="form-field__messages">
                        </div>
                    </div>

                    <div class="form-field form-field--select form-field--select-single form-field--select-single--2">
                        <label for="form-field-fromtime" class="form-field__label">
                            @Translate.Text("cpportal.Time From")
                        </label>
                        <span class="form-field__input-wrapper form-field__input-wrapper--select">
                            <select class="form-field__input form-field__input--select form-field__input--select-full"
                                    id="form-field-fromtime"
                                    name="fromtime"
                                    aria-describedby="description-for-fromtime"
                                    data-parsley-errors-container="#description-for-fromtime"
                                    data-parsley-trigger="change"
                                    data-parsley-id="8">
                                @{
                                    int j = 1;
                                }
                                @foreach (var item in fromtotime)
                                {
                                    <option value="@item.Value" @(j == 1 ? @"selected=""" : "")>@item.Text</option>
                                    j++;
                                }
                            </select>
                        </span>
                        <div id="description-for-fromtime" class="form-field__messages">
                        </div>
                    </div>



                    <div class="form-field form-field--select form-field--select-single form-field--select-single--2">
                        <label for="form-field-totime" class="form-field__label">
                            @Translate.Text("cpportal.Time To")
                        </label>
                        <span class="form-field__input-wrapper form-field__input-wrapper--select">
                            <select class="form-field__input form-field__input--select form-field__input--select-full"
                                    id="form-field-totime"
                                    name="totime"
                                    aria-describedby="description-for-totime"
                                    data-parsley-errors-container="#description-for-totime"
                                    data-parsley-trigger="change"
                                    data-parsley-id="9">
                                @{
                                    int k = 1;
                                }
                                @foreach (var item in fromtotime)
                                {
                                    <option value="@item.Value" @(k == 1 ? @"selected=""" : "")>@item.Text</option>
                                    k++;
                                }
                                @*<option value="1:30PM">1:30PM</option>
                                    <option value="2:00PM">2:00PM</option>
                                    <option value="2:30PM">2:30PM</option>*@

                            </select>
                        </span>
                        <div id="description-for-totime" class="form-field__messages">
                        </div>
                    </div>
                    <div class="grid__column grid__column--6" id="fromdatecontainer" style="clear: both;padding: 0 !important;height: 1px;position: relative;top: -28px;"></div>
                    <div class="grid__column grid__column--6" id="todatecontainer" style="padding: 0 !important;height: 1px;position: relative;top: -28px;"></div>

                    <div class="form-field form-field--text form-field--textarea">
                        <label for="form-field-message1" class="form-field__label">
                            @Translate.Text("cpportal.Message")
                            <span class="form-field__label-required aria-only">(required)</span>
                        </label>
                        <span class="form-field__input-wrapper">
                            <textarea class="form-field__input form-field__input--text form-field__input--textarea"
                                      id="form-field-message1"
                                      name="message1"
                                      type="textarea"
                                      aria-describedby="description-for-message1"
                                      data-parsley-errors-container="#description-for-message1"
                                      required=""
                                      data-parsley-required-message="@Translate.Text("cpportal.Messagemsg")"
                                      data-parsley-id="10"></textarea>
                        </span>
                        <div id="description-for-message1" class="form-field__messages">
                        </div>
                    </div>
                    <input type="hidden" name="updaterequest" id="updaterequest" value="" />
                </fieldset>

            </div>
        </div>
    </div>
    <div class="m39-modal__footer">
        @if (Model)
        {
            <div id="Submitmeetingbutton" class="button button--primary button--next" data-accountupdate="true" data-modal-confirm="true">@Translate.Text("cpportal.Submit")</div>
        }
        else
        {
            <div id="Submitmeetingbutton" class="button button--primary button--next cancalleddiv" data-accountupdate="true" data-modal-confirm="true">@Translate.Text("cpportal.Update")</div>
        }
        <div class="button m5-quick-services--request_cancel" id="meetingrequestcancel">@Translate.Text("cpportal.cancel")</div>
    </div>
}
<script>
    docReady(function () {
        var $requesttype;

        jQuery("#Submitmeetingbutton").on('click', function (event) {
            event.preventDefault();
            event.stopPropagation();
            if ('@Model' == 'true') {
                $requesttype = $('#form-field-requesttype option:selected').text();
            }
            else {
                $requesttype = $('#form-field-requesttype').val();
            }
            if (jQuery("#form-meetingrequest").parsley().validate()) {
                var tolisttext = [];
                 $('#form-field-tolist1 option:selected').each(function () {
                     tolisttext.push($(this).val());
                 });
                 var $tolist1 = tolisttext.join("; ");
                var url = "/api/sitecore/CorporatePartnership/MeetingRequest";
                jQuery.ajax({
                    url: url,
                    traditional: true,
                    data:
                        AddForgeryToken({
                            requesttype: $requesttype,
                            updaterequest: $('#updaterequest').val(),
                            location: $('#form-field-location').val(),
                            eventname: $('#form-field-eventname').val(),
                            tolist: $tolist1,
                            fromdate: $('#form-field-fromdate').val(),
                            todate: $('#form-field-todate').val(),
                            fromtime: $('#form-field-fromtime option:selected').text(),
                            totime: $('#form-field-totime option:selected').text(),
                            message: $('#form-field-message1').val()
                        }, "form-meetingrequest"),
                    beforeSend: function () {
                        jQuery('.j1-CP--loader').show();
                        jQuery('.j1-CP--loader').css('top', $(window).scrollTop());
                    },
                    complete: function () {
                        jQuery('.j1-CP--loader').hide();
                    },
                    dataType: 'json',
                    type: 'POST',
                }).done(function (response) {

                    if($('#updaterequest').val()!="")
                    {
                        window.location.reload();
                    }
                    if (response.status) {
                        jQuery('#successtitlemessage').html('@Translate.Text("cpportal.success title")');
                        jQuery('#successtextmessage').html('@Translate.Text("cpportal.success text")');
                        jQuery('#form-meetingrequest').find('#meetingrequestcancel').trigger('click');
                        jQuery('#successmodal').find('.m39-modal__trigger').trigger('click');
                        $('#submittedrequestcount').html(parseInt($('#submittedrequestcount').html()) + 1);
                    }
                    else {
                        if (response.islogin == undefined) {
                            jQuery('#successtitlemessage').html('@Translate.Text("cpportal.failure title")');
                            jQuery('#successtextmessage').html('@Translate.Text("cpportal.failure text")');
                            jQuery('#form-meetingrequest').find('#meetingrequestcancel').trigger('click');
                            jQuery('#successmodal').find('.m39-modal__trigger').trigger('click');
                        }
                        else {
                            window.location.reload();
                        }
                    }

                });
            }
        });

        require(['picker'], function () {
            var from_$input = jQuery('#form-field-fromdate').pickadate(),
                from_picker = from_$input.pickadate('picker')

            var to_$input = jQuery('#form-field-todate').pickadate(),
                to_picker = to_$input.pickadate('picker')


            // Check if there’s a “from” or “to” date to start with.
            if (from_picker.get('value')) {
                to_picker.set('min', from_picker.get('select'))
            }
            if (to_picker.get('value')) {
                from_picker.set('max', to_picker.get('select'))
            }

            // When something is selected, update the “from” and “to” limits.
            from_picker.on('set', function (event) {
                if (event.select) {
                    to_picker.set('min', from_picker.get('select'))
                } else if ('clear' in event) {
                    to_picker.set('min', false)
                }
            })
            to_picker.on('set', function (event) {
                if (event.select) {
                    from_picker.set('max', to_picker.get('select'))
                } else if ('clear' in event) {
                    from_picker.set('max', false)
                }
            });
        });
    });
</script>