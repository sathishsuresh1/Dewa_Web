@using Sitecore.Globalization
@using Sitecore.Mvc
@using Sitecore.Mvc.Configuration
@using DEWAXP.Foundation.Content
@model DEWAXP.Feature.Account.Models.GovernmentObservation.SubmitObservationModel

<div class="grid">
    @Html.Sitecore().Placeholder("j91/m26-page-title")

    @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")

    @using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, FormMethod.Post, new { @data_form = "true", @data_parsley_focus = "none", @class = "form", @data_submit_validate = "enabled", @novalidate = "true", encType = "multipart/form-data" }))
    {
        @Html.AntiForgeryToken()
        @Html.Sitecore().FormHandler()

        @Html.HiddenFor(m => m.Longitude)
        @Html.HiddenFor(m => m.Latitude)

        <div class="grid__row">
            <div class="grid__column grid__column--12 grid__column--form">
                <div class="form-field form-field--select form-field--select-single">
                    <label for="form-field-type" class="form-field__label">
                        @Translate.Text("Observation Type")
                        <span class="form-field__label-required aria-only">(@Translate.Text("required")</span>
                    </label>

                    <span class="form-field__input-wrapper form-field__input-wrapper--select">
                        <select class="form-field__input form-field__input--select form-field__input--select-full" id="form-field-type" name="ElectricityOrWater" aria-describedby="description-for-type" required="" data-parsley-error-message="@Translate.Text("Please enter a value")" data-parsley-errors-container="#description-for-type" data-parsley-trigger="change" data-parsley-id="8">
                            <option value="" selected="selected">@Translate.Text("Select from dropdown")</option>
                            <option value="E">@Translate.Text("Electricity")</option>
                            <option value="W">@Translate.Text("Water")</option>
                        </select>
                    </span>
                    <div id="description-for-type" class="form-field__messages">
                        @Html.ValidationMessageFor(x => x.ElectricityOrWater, string.Empty, new { @class = "parsley-errors-list" })
                    </div>
                </div>

                <div class="form-field form-field--text">
                    <label for="form-field-date" class="form-field__label form-field__label--readonly">
                        @Translate.Text("Date of observation")
                        <span class="form-field__label-required aria-only">(@Translate.Text("required")</span>
                    </label>
                    <div class="form-field__input-wrapper form-field__input-wrapper--readonly">
                        <input class="form-field__input form-field__input--readonly align_left"
                               readonly="readonly" id="form-field-date" name="DateDisplay"
                               type="text"
                               value="@Model.Date.ToString("dd MMM yyyy", Sitecore.Context.Culture)" aria-describedby="description-for-date" data-parsley-trigger="focusout" />
                        <input class="form-field__input form-field__input--readonly align_left"
                               readonly="readonly" id="form-field-date" name="Date"
                               type="hidden"
                               value="@Model.Date" aria-describedby="description-for-date" data-parsley-trigger="focusout" />
                    </div>
                    <div id="description-for-date" class="form-field__messages"></div>
                </div>

                <div class="form-field">
                    <fieldset class="fieldset">
                        <legend class="form-field__label">
                            @Translate.Text("Send location coordinates")
                            <span class="form-field__label-required aria-only">(@Translate.Text("required"))</span>
                        </legend>
                        <p class="form-field__radio ">
                            <label for="form-field-radio_1_1">
                                <input class="form-field__input form-field__input--radio" id="form-field-radio_1_1" name="SendCoordinates" type="radio" value="false" aria-describedby="description-for-coords" checked="checked" data-parsley-multiple="radios_group1" data-parsley-id="13">
                                <span class="form-field__fakeradio focus-enabled">@Translate.Text("No")</span>
                            </label>
                        </p>
                        <p class="form-field__radio ">
                            <label for="form-field-radio_1_2">
                                <input class="form-field__input form-field__input--radio" id="form-field-radio_1_2" name="SendCoordinates" type="radio" value="true" aria-describedby="description-for-coords" data-parsley-multiple="radios_group1">
                                <span class="form-field__fakeradio focus-enabled">@Translate.Text("Yes")</span>
                            </label>
                        </p>
                        <div id="description-for-coords" class="form-field__messages"></div>
                    </fieldset>
                </div>

                <div class="form-field form-field--text ">
                    <label for="form-field-area" class="form-field__label">
                        @Translate.Text("Enter area name")
                        <span class="form-field__label-required aria-only">(@Translate.Text("required")</span>
                    </label>
                    <span class="form-field__input-wrapper">
                        <input class="form-field__input form-field__input--text" id="form-field-area" name="Area" type="text" placeholder="@Translate.Text("Enter area name")" aria-describedby="description-for-area" required="" data-parsley-error-message="@Translate.Text("Please enter a value")" data-parsley-errors-container="#description-for-area" data-parsley-trigger="focusout" data-parsley-id="17">
                    </span>
                    <div id="description-for-area" class="form-field__messages">
                        @Html.ValidationMessageFor(x => x.Road, string.Empty, new { @class = "parsley-errors-list" })
                    </div>
                </div>

                <div class="form-field form-field--text ">
                    <label for="form-field-road" class="form-field__label">
                        @Translate.Text("Road name or street number")
                        <span class="form-field__label-required aria-only">(@Translate.Text("required")</span>
                    </label>
                    <span class="form-field__input-wrapper">
                        <input class="form-field__input form-field__input--text" id="form-field-road" name="Road" type="text" placeholder="@Translate.Text(DictionaryKeys.GovernmentObservation.EnterRoadName)" aria-describedby="description-for-road" required=""
                               data-parsley-error-message="@Translate.Text("Please enter a value")" data-parsley-errors-container="#description-for-road" data-parsley-trigger="focusout" data-parsley-id="19">
                    </span>
                    <div id="description-for-road" class="form-field__messages">
                        @Html.ValidationMessageFor(x => x.Road, string.Empty, new { @class = "parsley-errors-list" })
                    </div>
                </div>

                <div class="form-field form-field--text ">
                    <label for="form-field-communityno" class="form-field__label">
                        @Translate.Text("Community No")
                        <span class="form-field__label-optional">(@Translate.Text("optional"))</span>
                    </label>
                    <span class="form-field__input-wrapper">
                        <input class="form-field__input form-field__input--text"
                               id="form-field-communityno"
                               name="Community"
                               type="text"
                               placeholder="@Translate.Text("Enter Community No")"
                               aria-describedby="description-for-communityno"
                               data-parsley-trigger="focusout"
                               data-parsley-id="21">
                    </span>
                    <div id="description-for-communityno" class="form-field__messages"></div>
                </div>

                <div class="form-field form-field--text ">
                    <label for="form-field-ssno" class="form-field__label">
                        @Translate.Text("DEWA SS No. / Light pole No/Building name")
                        <span class="form-field__label-optional">(@Translate.Text("optional"))</span>
                    </label>
                    <span class="form-field__input-wrapper">
                        <input class="form-field__input form-field__input--text" id="form-field-ssno" name="Structure" type="text" placeholder="@Translate.Text("DEWA SS or light pole or building name")" aria-describedby=" description-for-ssno" data-parsley-trigger="focusout" data-parsley-id="23" />
                    </span>

                    <div id="description-for-ssno" class="form-field__messages">
                        <p class="form-field__description">@Translate.Text(DictionaryKeys.GovernmentObservation.HelpText)</p>
                    </div>
                </div>

                <div class="form-field form-field--text">
                    <label for="form-field-mobile" class="form-field__label form-field__label--readonly">
                        @Translate.Text("Mobile number")
                    </label>
                    <div class="form-field__input-wrapper form-field__input-wrapper--readonly">
                        <input class="form-field__input form-field__input--readonly" readonly="readonly" id="form-field-mobile" name="MobileNumber" type="text" value="@Model.MobileNumber" aria-describedby="description-for-mobile" data-parsley-trigger="focusout">
                    </div>
                    <div id="description-for-mobile" class="form-field__messages"></div>
                </div>

                <div class="form-field form-field--text">
                    <label for="form-field-email" class="form-field__label form-field__label--readonly">
                        @Translate.Text("Observer email ID")
                    </label>
                    <div class="form-field__input-wrapper form-field__input-wrapper--readonly">
                        <input class="form-field__input form-field__input--readonly" readonly="readonly" id="form-field-email" name="Email" type="text" value="@Model.Email" aria-describedby="description-for-email" data-parsley-trigger="focusout">
                    </div>
                    <div id="description-for-email" class="form-field__messages"></div>
                </div>

                <div class="form-field form-field--text form-field--textarea">
                    <label for="form-field-desc" class="form-field__label">
                        @Translate.Text("Defect description")
                        <span class="form-field__label-required aria-only">(@Translate.Text("required")</span>
                    </label>
                    <span class="form-field__input-wrapper">
                        <textarea class="form-field__input form-field__input--text form-field__input--textarea" maxlength="100" data-textarea="desc" id="form-field-desc" name="Defect" type="textarea" placeholder="@Translate.Text(DictionaryKeys.Global.EnterYourMessage)" aria-describedby="description-for-desc" required="" data-parsley-error-message="@Translate.Text(DictionaryKeys.Global.EnterDescription)" data-parsley-errors-container="#description-for-desc" data-parsley-id="25"></textarea>
                    </span>
                    <div id="description-for-desc" class="form-field__messages">
                        <p class="form-field__charcount">@Translate.Text("Max") <span data-charcount="desc">0</span>/100 @Translate.Text("Characters")</p>
                        @Html.ValidationMessageFor(x => x.Defect, string.Empty, new { @class = "parsley-errors-list" })
                    </div>
                </div>

                <div class="form-field form-field--upload">
                    <div class="form-field__input-wrapper">
                        <div class="form-field__preview-wrapper">
                            <img src="/images/preview_pdf@2x.png" data-src="/images/preview_pdf@2x.png" data-success="/images/upload_success@2x.png" class="form-field__preview" aria-hidden="true" role="presentation" alt="" data-uploader-image="attach1">
                        </div>
                        <div class="form-field__uploader-details">
                            <label for="form-field-attach1" class="form-field__label">
                                <strong class="form-field__label-description inline-block">@Translate.Text(DictionaryKeys.GovernmentObservation.Attachment1)</strong>
                                <span class="form-field__label-optional">(@Translate.Text("optional"))</span>
                            </label>
                            <div>
                                <label>
                                    <input class="form-field__input form-field__input--upload" id="form-field-attach1" name="files" type="file" aria-describedby="description-for-attach1" data-uploader-field="attach1" accept="image/png,image/x-png,image/jpeg,image/jpg,image/bmp,image/gif,application/pdf,text/csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" data-parsley-id="27">
                                    <span class="button button--primary button--next button--small focus-enabled">@Translate.Text("Choose")</span>
                                </label>
                            </div>
                            <p class="form-field__input--upload-filename" data-uploader-filename="attach1"></p>
                            <p>
                                <button class="button button--text button--remove hidden" data-uploader-remove="attach1">@Translate.Text("Remove")</button>
                            </p>
                        </div>
                    </div>
                    <div id="description-for-attach1" class="form-field__messages"></div>
                </div>

                <div class="form-field form-field--upload">
                    <div class="form-field__input-wrapper">
                        <div class="form-field__preview-wrapper">
                            <img src="/images/preview_pdf@2x.png" data-src="/images/preview_pdf@2x.png" data-success="/images/upload_success@2x.png" class="form-field__preview" aria-hidden="true" role="presentation" alt="" data-uploader-image="attach2">
                        </div>
                        <div class="form-field__uploader-details">
                            <label for="form-field-attach2" class="form-field__label">
                                <strong class="form-field__label-description inline-block">@Translate.Text(DictionaryKeys.GovernmentObservation.Attachment2)</strong>
                                <span class="form-field__label-optional">(@Translate.Text("optional"))</span>
                            </label>
                            <div>
                                <label>
                                    <input class="form-field__input form-field__input--upload" id="form-field-attach2" name="files" type="file" aria-describedby="description-for-attach2" data-uploader-field="attach2" accept="image/png,image/x-png,image/jpeg,image/jpg,image/bmp,image/gif,application/pdf,text/csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" data-parsley-id="29">
                                    <span class="button button--primary button--next button--small focus-enabled">@Translate.Text("Choose")</span>
                                </label>
                            </div>
                            <p class="form-field__input--upload-filename" data-uploader-filename="attach2"></p>
                            <p>
                                <button class="button button--text button--remove hidden" data-uploader-remove="attach2">@Translate.Text("Remove")</button>
                            </p>
                        </div>
                    </div>
                    <div id="description-for-attach2" class="form-field__messages"></div>
                </div>

                <div class="form-field form-field--upload">
                    <div class="form-field__input-wrapper">
                        <div class="form-field__preview-wrapper">
                            <img src="/images/preview_pdf@2x.png" data-src="/images/preview_pdf@2x.png" data-success="/images/upload_success@2x.png" class="form-field__preview" aria-hidden="true" role="presentation" alt="" data-uploader-image="attach3">
                        </div>
                        <div class="form-field__uploader-details">
                            <label for="form-field-attach3" class="form-field__label">
                                <strong class="form-field__label-description inline-block">@Translate.Text(DictionaryKeys.GovernmentObservation.Attachment3)</strong>
                                <span class="form-field__label-optional">(@Translate.Text("optional"))</span>
                            </label>
                            <div>
                                <label>
                                    <input class="form-field__input form-field__input--upload" id="form-field-attach3" name="files" type="file" aria-describedby="description-for-attach3" data-uploader-field="attach3" accept="image/png,image/x-png,image/jpeg,image/jpg,image/bmp,image/gif,application/pdf,text/csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" data-parsley-id="31">
                                    <span class="button button--primary button--next button--small focus-enabled">@Translate.Text("Choose")</span>
                                </label>
                            </div>
                            <p class="form-field__input--upload-filename" data-uploader-filename="attach3"></p>
                            <p>
                                <button class="button button--text button--remove hidden" data-uploader-remove="attach3">@Translate.Text("Remove")</button>
                            </p>
                        </div>
                    </div>
                    <div id="description-for-attach3" class="form-field__messages">
                        <p class="form-field__description">@Translate.Text("Max Size Copy")</p>
                    </div>
                </div>

                <div class="form-field__button">
                    <button type="submit" class="button button--primary" data-text="@Translate.Text("Submitting...")">@Translate.Text("Submit")</button>
                </div>
            </div>
        </div>
    }
</div>

<script type="text/javascript">
	docReady(function() {
		jQuery('input[name="SendCoordinates"]').change(function() {
			var $this = jQuery(this);
			if ($this.val() === "true") {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function (position) {
						jQuery('input[name="Longitude"]').val(position.coords.longitude);
						jQuery('input[name="Latitude"]').val(position.coords.latitude);
						var lng = position.coords.longitude;
					    var lat = position.coords.latitude;
					    var url = "https://maps.googleapis.com/maps/api/geocode/json?latlng=" + lat.toString() + "," + lng.toString() + "&key=@Model.ApiKey";
					    //alert(url);
					    $.getJSON(url, function (data, textStatus) {
					        //alert(JSON.stringify(data, null, 4));
					        var houseNo = data.results[0].address_components[0].long_name;
					        var streetNo =data.results[0].address_components[1].long_name;
					        var area1 =   data.results[0].address_components[2].long_name;
					        var area2 =   data.results[0].address_components[3].long_name;
					        //alert(streetaddress);
					        jQuery('input[name="Road"]').val(houseNo + ", " + streetNo);
					        jQuery('input[name="Road"]').parsley().validate();
					        jQuery('input[name="Area"]').val(area1 + ", " + area2);
					        jQuery('input[name="Area"]').parsley().validate();
					    });

					});
				}
				return;
			}
			jQuery('input[name="Longitude"]').val('');
			jQuery('input[name="Latitude"]').val('');
		});

	});
</script>

<script src="~/scripts/External/nml/form-submit-validate.js"></script>
