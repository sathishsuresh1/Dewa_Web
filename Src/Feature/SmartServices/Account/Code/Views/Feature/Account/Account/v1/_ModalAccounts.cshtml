@using DEWAXP.Foundation.Helpers.Extensions
@using DEWAXP.Foundation.Helpers
@using Sitecore.Mvc
@using Sitecore.Globalization
@using Sitecore.Mvc.Configuration
@model  DEWAXP.Foundation.Content.Models.AccountModel.ModalaccountList

@if (Model.Accounts != null && Model.Accounts.Length > 0)
{
        <div class="m39-modal m39-modal--new" data-component="m39-modal" id="modal_manageprofile">
            <button data-trigger="true" class="m39-modal__trigger hidden"
                    type="button" id="manageprofileform_trigger"
                    aria-controls="m43-accountsel__selected_content">
                adadsasd
            </button>
            <div data-content="true" class="m39-modal__container" role="dialog" aria-expanded="false" id="m43-accountsel__selected_content" aria-labelledby="m43-accountsel__selected_trigger">
                <div class="m39-modal__dialog m39-modal__dialog--account">
                    <div class="m39-modal__header">
                        <div class="m39-modal__title">@Translate.Text("cust.choose.account")</div>
                        <span class="hidden" id="accountselector-bp"></span>
                        <a data-close="acc-sel-ctrl" class="m39-modal__button--close" id="m43-accountsel__selected_close" aria-controls="m43-accountsel__selected_content">@Translate.Text("Close")</a>
                    </div>
                    <div class="m39-modal__content" id="m43-account-list" style="top: 149px;">
                        <div class="red hidden" id="accselectonemsg">@Translate.Text("cust.select.account")</div>
                        <a class="link m44-bill-selector__deselect floatRight" style="position:static;" href="#" data-state="1" data-select="@Translate.Text("cust.selectall")" data-deselect="@Translate.Text("cust.deselectall")">@Translate.Text("cust.selectall")</a>

                        <div class="m44-bill-selector-list-placeholder mt24">
                            <div class="m44-bill-selector__partner">
                                <div class="m44-bill-selector__partner-title">
                                    @Translate.Text("cust.profile.businesspartners"): @Model.BusinessPartnerNumber <strong>(@Model.Accounts.Length @Translate.Text("cust.accounts.count"))</strong>
                                </div>
                                <div class="m44-bill-selector__accounts-list">
                                    <div class="m44-bill-selector__checkbox-wrapper">
                                        <div class="form-field form-field--toggles">
                                            <fieldset class="fieldset">
                                                @foreach (DEWAXP.Foundation.Integration.Responses.AccountDetails account in Model.Accounts)
                                                {
                                                    var indicatorClass = account.IsActive ? "active" : "inactive";
                                                    var indicatorText = account.IsActive ? "Active" : "Inactive";

                                                    <div class="form-field__checkbox  form-field__checkbox--billselector  first">
                                                        <label>
                                                            <input class="form-field__input form-field__input--checkbox"
                                                                   id="form-field-bill-sel-1"
                                                                   name="checkboxes_group1"
                                                                   type="checkbox"
                                                                   value="@account.AccountNumber"
                                                                   aria-describedby="description-for-"
                                                                   data-parsley-errors-container="#description-for-"
                                                                   data-input="checkbox"
                                                                   data-parsley-multiple="checkboxes_group1"
                                                                   data-parsley-id="7">

                                                            <span class="form-field__fakecheckbox form-field__fakecheckbox--right focus-enabled">
                                                                <span class="m43-accountsel__account" data-acc-detail="wrapper">
                                                                    @if (account.HasPhoto)
                                                                    {
                                                                        <img src="/images/ajax-loader_50x50.gif"
                                                                             data-src="/account_thumbs.ashx?id=@account.AccountNumber&aty=@((int)account.BillingClass)"
                                                                             class="m43-accountsel__image withimagemodal tooltipstered" 
                                                                             alt="@(string.IsNullOrWhiteSpace(account.NickName) ? account.AccountName : account.NickName)"
                                                                             role="presentation" 
                                                                             data-acc-detail="acc_image">
                                                                    }
                                                                    else
                                                                    {
                                                                        <img src="@ImageHelper.GetAccountImage(account.BillingClass)"
                                                                             data-src="@ImageHelper.GetAccountImage(account.BillingClass)"
                                                                             class="m43-accountsel__image tooltipstered" alt="@(string.IsNullOrWhiteSpace(account.NickName) ? account.AccountName : account.NickName)"
                                                                             role="presentation" data-acc-detail="acc_image">
                                                                    }
                                                                        <span class="m43-accountsel__header">
                                                                            <span class="m43-accountsel__name" data-acc-detail="acc_name">
                                                                                <span class="inline-block" dir="ltr">@(string.IsNullOrWhiteSpace(account.NickName) ? account.AccountName : account.NickName)</span>
                                                                                @if (account.AccountClass == DEWAXP.Foundation.Integration.Enums.AccountClassification.Active ||
                                                                                account.AccountClass == DEWAXP.Foundation.Integration.Enums.AccountClassification.Inactive)
                                                                                {
                                                                                    <span dir="ltr" style="left:25px;top:-20px;right:25px;" class="m43-accountsel__status m43-accountsel__status--@indicatorClass">@*@Translate.Text(indicatorText)*@</span>
                                                                                }
                                                                                <span class="hidden accountselector-ownertype" dir="ltr" style="font-weight:normal;">@account.CustomerType</span>
                                                                            </span>

                                                                            <span class="m43-accountsel__details">
                                                                                <span dir="ltr" data-acc-detail="type">@account.PremiseType</span> |
                                                                                <span title="Account">@Translate.Text("MBAccountNumber")</span>
                                                                                <span dir="ltr" data-acc-detail="acc_number">(@account.AccountNumber)</span>


                                                                            </span>
                                                                            <span class="m43-accountsel__details">
                                                                                @if ((!string.IsNullOrWhiteSpace(account.BillingClassCode) && !account.BillingClassCode.Equals("-")))
                                                                                {
                                                                                    <span dir="ltr" data-acc-detail="type">@account.BillingClassCode</span> @("|")
                                                                                }
                                                                                else
                                                                                {
                                                                                    <span dir="ltr" data-acc-detail="type" style="display:none">@account.BillingClassCode</span>
                                                                                }

                                                                                @if ((!string.IsNullOrWhiteSpace(account.AccountNumber) && !account.AccountNumber.Equals("-")))
                                                                                {
                                                                                    <span title="Account">@Translate.Text("global.accountnumber")</span>
                                                                                    <span dir="ltr" data-acc-detail="acc_number">(@account.AccountNumber)</span>
                                                                                }


                                                                            </span>
                                                                            <span class="m43-accountsel__details hidden">
                                                                                <span dir="ltr" data-acc-detail="acc_businesspartner">@account.BusinessPartnerNumber</span>
                                                                            </span>

                                                                            @if (!string.IsNullOrWhiteSpace(account.Street) && !string.IsNullOrWhiteSpace(account.Location))
                                                                            {
                                                                                <span class="m43-accountsel__details m43-accountsel__secondarydetails">
                                                                                    <span dir="ltr" data-acc-detail="address">
                                                                                        @account.Street, @account.Location
                                                                                    </span>
                                                                                </span>
                                                                            }

                                                                            <span class="m43-accountsel__details m43-accountsel__secondarydetails">
                                                                                <span dir="ltr" data-acc-detail="acc_premiseType">
                                                                                    @Translate.Text("Premise")
                                                                                </span>
                                                                                (
                                                                                <span dir="ltr" data-acc-detail="acc_premise">
                                                                                    @account.CustomerPremiseNumber
                                                                                </span>
                                                                                )
                                                                            </span>
                                                                        </span>
                                                                </span>
                                                            </span>
                                                        </label>
                                                    </div>
                                                }
                                                <div id="description-for-" class="form-field__messages">
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="m39-modal__footer">
                        <div class="button button--outline" id="skipthisstep">@Translate.Text("cust.skipstep.button.text")</div>
                        @*<div class="button button--primary button--next qwerty"  id="updateSelectedAccountbutton">UPDATE SELECTED</div>*@
                        <button class="button button--primary updateSelectedAccountbutton" id="updateSelectedAccountbutton">@Translate.Text("cust.update.selected.button.text")</button>
                    </div>
                </div>
            </div>
        </div>

    }
<script>
    docReady(function () {
        jQuery('.withimagemodal').each(function (index,obj) {
            var thiselement = jQuery(this);
            var $url = jQuery(this).attr('data-src')
            setTimeout(function () {
                thiselement.attr("src", $url);
            }, 300)
        });
    });
</script>
