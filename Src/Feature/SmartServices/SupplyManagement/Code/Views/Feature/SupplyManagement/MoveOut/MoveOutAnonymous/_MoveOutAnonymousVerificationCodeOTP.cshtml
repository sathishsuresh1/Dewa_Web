@using DEWAXP.Foundation.Helpers
@using DEWAXP.Foundation.Content
@using Sitecore.Globalization
@using Sitecore.Mvc
@using Glass.Mapper.Sc.Web.Mvc
@using Sitecore.Mvc.Configuration
@model DEWAXP.Foundation.Content.Models.MoveOut.v3.MoveOutAnonymous


@using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, FormMethod.Post, new { @class = "form form--inline", @id = "MoveOutAnonymous", @data_form = "true", @data_submit_validate = "enabled", @novalidate = string.Empty }))
{
    @Html.Sitecore().FormHandler()
    @Html.AntiForgeryToken()

    <div class="grid__row">

        @Html.Sitecore().Placeholder("j15/m26-page-title")

        <div class="grid__column grid__column--12 grid__column--form">

            @Html.Sitecore().Placeholder("j15/m38-step-tracker")
            @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")

            <p class="text__content-copy">@Model.Message</p>

            <fieldset>

                <legend class="legend-color">.</legend>
                <div class="form-field form-field--text">


                    <div dir="ltr" class="form-field__input-wrapper form-field__input-wrapper--readonly">
                        <input class="form-field__input form-field__input--readonly align_left" readonly
                               id="form-field-naqubcy3g"
                               name="mobile_number"
                               type="text"
                               value="@Model.MaskedDisplayValue"
                               aria-describedby="description-for-naqubcy3g"
                               data-parsley-errors-container="#description-for-naqubcy3g" />

                    </div>

                </div>
                <div class="form-field form-field--text ">
                    <label for="form-field-otp_number" class="form-field__label">
                        @Translate.Text("Moveout.Anonymous.Label.VerificationCode")
                        <span class="form-field__label-required aria-only">(@Translate.Text("required"))</span>
                    </label>
                    <span class="form-field__input-wrapper">
                        <input class="form-field__input form-field__input--text" id="form-field-otp_number"
                               name="OTPNumber"
                               maxlength="6" data-parsley-maxlength="6"
                               type="text" lang="en"
                               placeholder="@Translate.Text("Moveout.Anonymous.Enter.OTP")"
                               aria-describedby="description-for-otpnumber"
                               data-parsley-errors-container="#description-for-otpnumber"
                               required=""
                               data-parsley-required-message="@Translate.Text("Moveout.Anonymous.Enter.OTP")"
                               data-parsley-verification_code=""
                               data-parsley-verification_code-message="@Translate.Text("Moveout.Anonymous.Enter.OTP")" />
                    </span>

                    <input type="hidden" value="@Model.PremiseNumber" name="PremiseNumber" />
                    <input type="hidden" value="@Model.AccountNumber" name="AccountNumber" />

                    <div id="description-for-otpnumber" class="form-field__messages">
                        <p class="form-field__description">
                            @Translate.Text("Moveout.Anonymous.Notification.Code")
                        </p>
                        <p class="form-field__description">

                            <a id="resendpin" href="#" class='link'>@Translate.Text("Moveout.Anonymous.Resend.Code")</a>

                            <div id="divtxtresendpin" style="display:none; color: red; white-space:normal;" class="j108-np"></div>
                        </p>
                    </div>
                </div>


            </fieldset>

            <div class="form-field__button">
                <button class="button button--primary button--next" data-submission-text="@Translate.Text("Submitting")..." type="submit">@Translate.Text("Submit")</button>
            </div>
        </div>
    </div>
}

<script type="text/javascript">
       $('.m38-step-tracker').attr('data-total-steps', "5");
        $('.m38-step-tracker').attr('data-current-step', "3");
        $('.m38-step-tracker__progressbar').attr('aria-valuetext', '@Translate.Text("Moveout.Anonymous.Step3.Info")');
        $('.m38-step-tracker').attr('data-hasinfo', "true");
    var CallApi = function () {

        var url = "/api/MoveoutAnonymous/Get/";

        jQuery.ajax(url, {
            dataType: 'json',
            method: 'GET',
            success:function (data) {
                if (data.message == "Success") {

                    $('#divtxtresendpin').text('@Translate.Text("Moveout.Anonymous.Message.Resend.Code")');
                    $('#divtxtresendpin').show();
                }
                else {
                    $('#divtxtresendpin').text(data.description);
                    $('#divtxtresendpin').show();
                }
            }
        });
    };


    $("#resendpin").click(function (e) {
        e.preventDefault();
        CallApi()

    });

</script>
<script src="~/scripts/External/nml/form-submit-validate.js"></script>