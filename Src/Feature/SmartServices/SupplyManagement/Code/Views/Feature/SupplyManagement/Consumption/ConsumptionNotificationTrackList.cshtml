@model DEWAXP.Feature.SupplyManagement.Models.ConsumptionComplaint.NotificationStatusModel
@using _commonHelper = DEWAXP.Feature.SupplyManagement.Helpers.ConsumptionComplaint.ConsumptionHelper;
@using _commonUtility = DEWAXP.Foundation.Content.Utils.CommonUtility;
@using Sitecore.Globalization;
@using DEWAXP.Foundation.Helpers;
@using DEWAXP.Foundation.Content

@{

    string msg = !string.IsNullOrEmpty(Model.Message) ? Model.Message : _commonHelper.GetSMTranslation("No record found");
}

@if (Model.StatusList != null && Model.StatusList.Count > 0)
{
    bool CurrentState = true;
    <ul class="j120-smart-response--track_list" data-msg="@(msg)">

        @foreach (var item in Model.StatusList)
        {
            decimal _zero = Convert.ToDecimal(null);
            bool isMapShow = Convert.ToBoolean(item.currentstatus == "X" && item.status == "S002" && Convert.ToDecimal(item.toxcord) != _zero && Convert.ToDecimal(item.toycord) != _zero);
            string extClass = string.Format("j120-smart-response--track_item--current {0}j120-smart-response--track_item--done", (item.status == "S002" ? "j120-smart-response--track_item--location " : ""));
            <li data-nid="@(item.notificationnumber)" class="j120-smart-response--track_item @(CurrentState?extClass:"")">
                <div class="j120-smart-response--track_item-content">
                    <span class="j120-smart-response--track_item-status-title">@_commonHelper.GetSMTranslation(item.notificationstatustext)</span>
                    @if (item.date != "0000-00-00")
                    {
                        string mnth = _commonHelper.GetSMTranslation(_commonHelper.CustomDateFormate(item.date, "yyyy-MM-dd", "MMM"));
                        string dd = _commonHelper.GetSMTranslation(_commonHelper.CustomDateFormate(item.date, "yyyy-MM-dd", "dd"));
                        string yyyy = _commonHelper.GetSMTranslation(_commonHelper.CustomDateFormate(item.date, "yyyy-MM-dd", "yyyy"));
                        string fromattedDate = string.Format("{0} {1} {2}", dd, mnth, yyyy);
                        if (isMapShow)
                        {
                            <span class="date-time arrivaldesc"
                                  data-formmatted_request_time="@string.Format("{0} {1}", fromattedDate, item.time)"
                                  data-statustext="@_commonHelper.GetSMTranslation(Translate.Text("TrackingStatusMapStatusDesc"))"
                                  data-notif="@(item.notificationnumber)"
                                  data-buffertime="@(Convert.ToDecimal(item.additionalinfo1))" onclick="GetStatusMapDescription(this)">
                                @Html.Raw(string.Format("{0} {1}", fromattedDate, item.time))
                            </span>
                        }
                        else
                        {
                            <span class="date-time">@string.Format("{0} {1}", fromattedDate, item.time) </span>

                        }
                    }
                </div>

                @if (isMapShow)
                {
                    <a href="@(string.Format("{0}?n={1}",LinkHelper.GetItemUrl(SitecoreItemIdentifiers.DTMC_TRACKING_MAP),item.notificationnumber))"><span class="icon icon-location"></span></a>
                }
            </li>
            if (item.currentstatus == "X" && CurrentState)
            {
                CurrentState = false;
            }
        }
    </ul>


    <script>
        docReady(function () {
            setTimeout(function () {
                var arrivalElement = $(".arrivaldesc");

                $(arrivalElement).each(function (i, o) {
                    GetStatusMapDescription(o);
                });
            }, 100)


        })
    </script>


}
else
{
    <p>@(msg)</p>
}
