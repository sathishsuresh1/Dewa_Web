@model DEWAXP.Feature.HR.Models.CareerPortal.CandidateProfile
@using DEWAXP.Foundation.Helpers
@using Glass.Mapper.Sc.Fields
@using Sitecore.Mvc
@using Sitecore.Mvc.Configuration
@using Sitecore.Globalization
@using DEWAXP.Feature.HR.Models.CareerPortal
@using _scPageItemId = DEWAXP.Foundation.Content.ScPageItemId
@using DEWAXP.Foundation.Content
@using DEWAXP.Feature.HR.Helpers.CareerPortal
@{

    var genderList = CareerPortalHelper.GetGender();
    var MaritalStatusList = CareerPortalHelper.GetMaritalStatus();
    var profilePic = Model.ProfilePic != null ? "data:image/png;base64," + @Model.ProfilePic : "../../images/no-image.png";
}
<div class="j105-drrg">
    <div class="m66-preloader j105-drrg--loader hidden">
        <div class="grid">
            <div class="grid__row">
                <div class="grid__column grid__column--12">
                    <h2 class="text__section-subtitle">@Translate.Text("J100.Pleasewait")</h2>
                    <div class="loader"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="j126-career-portal" data-journey="j126-career-portal">
    <div class="m41-tabs-box m41-tabs-box--variant m41-tabs-box--scripted">
        <div class="m41-tabs-box__tabs">
            <div class="m41-tabs-box__tab-panels">
                <div class="m41-tabs-box__tab-panel" style="display: block;">
                    <div class="m25-tabs m25-tabs--variant" data-component="m25-tabs" data-selected-tab-id="m25-tab-5" data-helper="toggle-menu" data-toggle-breakpoint='m'>
                        <div class="box--news">
                            <div class="grid">
                                <div class="grid__row">
                                    <div class="grid__column grid__column--4">
                                        <div class="m21-avatar">
                                            <div class="m21-avatar__content">
                                                <div class="m21-avatar__image" style="background-image: url(@profilePic);">
                                                    <a id="lnkProfilePic">
                                                        <div class="m21-avatar__image--control icon-photo">
                                                            @Translate.Text("change photo label")
                                                        </div>
                                                    </a>
                                                    @using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, new { id = Model.ProfilePicId }, FormMethod.Post, new { @id = "ChangePicture", @name = "j126-career-portal-profilepic", @data_parsley_focus = "true", @data_form = "true", @data_submit_validate = "enabled", enctype = "multipart/form-data", @novalidate = string.Empty, @autocomplete = "off" }))
                                                    {
                                                        @Html.Sitecore().FormHandler("CareerPortal", "ChangePicture")
                                                        @Html.AntiForgeryToken()
                                                        <input id="profilePic"
                                                               name="profilePic"
                                                               type="file"
                                                               style="display:none"
                                                               aria-describedby="description-for-profilePic"
                                                               data-parsley-errors-container="#description-for-profilePic"
                                                               required=""
                                                               data-parsley-required-message="This field is required"
                                                               accept="image/*"
                                                               data-accepts="&quot;jpg&quot;,&quot;png&quot;,&quot;jpeg&quot;"
                                                               data-size="2048000"
                                                               data-parsley-trigger="focusout"
                                                               data-parsley-id="6"
                                                               aria-invalid="false"
                                                               onchange="this.form.submit();">
                                                    }
                                                </div>
                                                <div class="m21-avatar__details">
                                                    <h2 class="m21-avatar__name"></h2>
                                                    <p class="m21-avatar__bp"></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="m25-tabs__menu" data-m25-tabs-menu="true">
                                            <ul aria-role="tablist">
                                                <li>
                                                    <a href="#m25-panel-1" aria-controls="m25-panel-1" class="m25-tabs__tab " data-m25-tabs-tab="true" id="m25-tab-1">@Translate.Text("application wizard title")</a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="m25-tabs__body grid__column grid__column--8">
                                        @*<div class="m15-tabs--mobile">
                                                <div class="m25-tabs--title-mobile">
                                                    About DEWA
                                                </div>
                                                <div class="form-field form-field--select form-field--select-single">
                                                    <span class="form-field__input-wrapper form-field__input-wrapper--select m25-tabs--select-mobile--wrapper">
                                                        <select class="m25-tabs--select-mobile form-field__input form-field__input--select"></select>
                                                    </span>
                                                </div>
                                            </div>*@
                                        <div class="toggle-menu__item">
                                            @*<div class="toggle-menu__trigger" data-toggle-trigger="true">
                                                    <h2 class="m25-tabs__title toggle-menu__title icon-share">Change of landlord information</h2>
                                                </div>*@
                                            <div aria-labelledby="m25-tab-1" aria-role="tabpanel" id="m25-panel-1" class="m25-tabs__content toggle-menu__content" data-m25-tabs-content="true" data-toggle-content="true">
                                                <div class="grid__row">
                                                    <div class="grid__column--6">
                                                        <div class="m17-sectiontitle" data-component="m17-sectiontitle">
                                                            <h3 class="m17-sectiontitle__title m17-sectiontitle__title--green text__section-title">
                                                                @Translate.Text("application wizard title")
                                                            </h3>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="grid__row">
                                                    <div class="grid__column--6">
                                                        @*<p class="import-buttons">
                                                                <a href="#modal_terms_checkbox" class="button button--quaternary button--import" data-modal-trigger="terms_checkbox" id="_q39br6swv_trigger" aria-controls="_q39br6swv_content">@Translate.Text("import from emirates id button label")</a>
                                                                <button class="button button--quaternary button--import">@Translate.Text("import from linkedin button label")</button>
                                                            </p>
                                                            <p class="import-text">
                                                                @Translate.Text("application wizard text")
                                                            </p>*@
                                                    </div>
                                                </div>
                                                <div class="form">
                                                    <fieldset class="fieldset">
                                                        @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")

                                                    </fieldset>
                                                    <fieldset class="fieldset candidatefieldset expanded">
                                                        <legend class="legend legend_tabs" data-fieldset-div="personalInfo" data-fieldset-id="1">@Translate.Text("personal information label")</legend>
                                                        <div id="personalInfo">
                                                            <p>Personal Info</p>
                                                        </div>
                                                    </fieldset>
                                                    <fieldset class="fieldset candidatefieldset collapsed">
                                                        <legend class="legend legend_tabs" data-fieldset-div="addressInfo" data-fieldset-id="2">@Translate.Text("address contact Information label")</legend>
                                                        <div id="addressInfo">
                                                            <p>Address & Contact Information</p>
                                                        </div>
                                                    </fieldset>
                                                    <fieldset class="fieldset candidatefieldset collapsed">
                                                        <legend class="legend legend_tabs" data-fieldset-div="educationWorkInfo" data-fieldset-id="3">@Translate.Text("education and professional label")</legend>
                                                        <div id="educationWorkInfo">
                                                            <p>Education Information</p>
                                                        </div>
                                                    </fieldset>
                                                    <fieldset class="fieldset candidatefieldset collapsed">
                                                        <legend class="legend legend_tabs" data-fieldset-div="workExperienceInfo" data-fieldset-id="4">@Translate.Text("work experience label")</legend>
                                                        <div id="workExperienceInfo">
                                                            <p>Work Experience</p>
                                                        </div>
                                                    </fieldset>
                                                    <fieldset class="fieldset candidatefieldset collapsed">
                                                        <legend class="legend legend_tabs" data-fieldset-div="attachementInfo" data-fieldset-id="5">@Translate.Text("addupdate Attachments label")</legend>
                                                        <div id="attachementInfo">
                                                            <p>Add/Update Attachments</p>
                                                        </div>
                                                    </fieldset>
                                                    <fieldset class="fieldset candidatefieldset collapsed">
                                                        <legend class="legend legend_tabs" data-fieldset-div="preferences" data-fieldset-id="6">@Translate.Text("preferencesInfo label")</legend>
                                                        <div id="preferences">
                                                            <p>Preferences</p>
                                                        </div>
                                                    </fieldset>
                                                    @*<fieldset class="fieldset candidatefieldset collapsed">
                                                            <legend class="legend legend_tabs" data-fieldset-div="generalQuestionnaire" data-fieldset-id="7">@Translate.Text("general questionnaire label")</legend>
                                                            <div id="generalQuestionnaire">
                                                                <p>General Questionnaire</p>
                                                            </div>
                                                        </fieldset>*@
                                                    <fieldset class="fieldset candidatefieldset collapsed">
                                                        <legend class="legend legend_tabs" data-fieldset-div="coverLetter" data-fieldset-id="8">@Translate.Text("cover letter label")</legend>
                                                        <div id="coverLetter">
                                                            <p>Cover Letter</p>
                                                        </div>
                                                    </fieldset>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="m39-modal" data-component="m39-modal" id="modal_terms_checkbox">
    <div data-content="terms_checkbox" class="m39-modal__container" id="_xcetvlagg_content" role="dialog" aria-expanded="false">
        <div class="m39-modal__dialog m39-modal__dialog--account" style="height:45%;">
            <div class="m39-modal__header">
                <div class="m39-modal__title">@Translate.Text("emirates id label")</div>
                <a data-close="true" class="m39-modal__button--close" id="_xcetvlagg_close" aria-controls="_xcetvlagg_content">@Translate.Text("TH.Close")</a>
            </div>
            <div class="m39-modal__content">
                <input class="form-field__input form-field__input--text"
                       value="@Model.ImportEmiratesID"
                       id="form-field-ImportEmiratesID"
                       name="ImportEmiratesID"
                       maxlength="15"
                       data-parsley-maxlength="15"
                       type="text"
                       data-parsley-emiratesid="true"
                       placeholder="@Translate.Text("emiratesId placeholder text")"
                       data-parsley-emiratesid-message="@Translate.Text("emiratesid validation message")"
                       aria-describedby="description-for-ImportEmiratesID"
                       data-parsley-errors-container="#description-for-ImportEmiratesID"
                       required
                       data-parsley-required-message="@Translate.Text("emiratesid validation message")" />
                <div id="description-for-ImportEmiratesID" class="form-field__messages parsley-errors-list hide">
                    @Translate.Text("emiratesid validation message")
                </div>
            </div>

            <div class="m39-modal__footer">
                <p class="m39-modal__accsel-error hidden" data-modal="errormessage" aria-hidden="true" tabindex="0" data-min-error="Select at least 1 account" data-max-error="Select up to 2 accounts"></p>
                <button type="button" class="button button--primary" data-accountupdate="true" onclick="GetEmirateDetail();" data-modal-confirm="true">@Translate.Text("fetch label")</button>
            </div>
        </div>
    </div>
    <div class="m39-modal__overlay"> </div>
</div>
<script language="javascript" type="text/javascript">
    $("#lnkProfilePic").click(function () {
        var $input = $('#profilePic');
        $input.trigger('click');
    });
    AjaxCall('@Model.Section');
    $('.fieldset .legend_tabs').on('click', function () {
        if ($(this).parent().hasClass('expanded')) {
            jQuery('.candidatefieldset').addClass('collapsed');
            $(this).parent().removeClass('expanded');
            $(this).parent().addClass('collapsed');
        } else {
            jQuery('.candidatefieldset').removeClass('expanded');
            jQuery('.candidatefieldset').addClass('collapsed');
            $(this).parent().removeClass('collapsed');
            $(this).parent().addClass('expanded');
            $(".legend_tabs").each(function (i, obj) {
                jQuery('#' + $(obj).attr("data-fieldset-div")).html('');
            });
            AjaxCall($(this).attr("data-fieldset-id"), $(this).attr("data-fieldset-div"));
        }
    });
    function AjaxCall(sec, divId) {
        if (sec == null || sec == undefined || sec == '')
            return false;
        if (divId == null || divId == undefined) {
            $(".legend_tabs").each(function (i, obj) {
                if ($(obj).attr("data-fieldset-id") == sec) {
                    divId = $(obj).attr("data-fieldset-div");
                    jQuery('.candidatefieldset').removeClass('expanded');
                    jQuery('.candidatefieldset').addClass('collapsed');
                    $(obj).parent().removeClass('collapsed');
                    $(obj).parent().addClass('expanded');
                    return false;
                }
            });
        }
        var url = "/api/sitecore/CareerPortal/AjaxApplicationWizard";
         var jobId = '@Model.JobId';
        jQuery.ajax({
            url: url,
            type: 'POST',
            //datatype: 'application/json',
            data: { section: sec, jobId: jobId },
            beforeSend: function () {
                jQuery('.j105-drrg--loader').show();
                jQuery('.j105-drrg--loader').css('top', $(window).scrollTop());
                jQuery('body').removeClass('unscrollable').addClass('unscrollable');
            },
            complete: function () {
                jQuery('.j105-drrg--loader').hide();
                jQuery('body').removeClass('unscrollable');
            },
        }).done(function (response) {
            jQuery('#' + divId).html('');
            jQuery('#' + divId).html(response);
            if (jQuery("#ExperienceType").val() != "" && jQuery("#ExperienceType").val() == "C2") {
                jQuery("#workExpFieldset").hide();
            }
            requirejs(['parsley'], function () {
                jQuery('#candidateprofile' + sec).parsley();
            });
            setTimeout(function () {
                window.initComponents('rs_area');
                jQuery(window).trigger('reinit_form');
                jQuery(window).trigger('dateReinit');
                jQuery(window).trigger('uploadReinit');
            }, 100);
        });
    }
</script>