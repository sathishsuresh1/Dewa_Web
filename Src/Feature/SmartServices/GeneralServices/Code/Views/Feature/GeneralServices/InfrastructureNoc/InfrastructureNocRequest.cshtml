@using DEWAXP.Foundation.Helpers
@using Sitecore.Mvc
@using Sitecore.Mvc.Configuration
@using Sitecore.Globalization
@using DEWAXP.Feature.GeneralServices.Models.Infrastructure_Noc
@using DEWAXP.Foundation.Content
@model InfrastructureNocReqModel

@{
    var backURL = LinkHelper.GetItemUrl(SitecoreItemIdentifiers.INFRASTRUCTURE_NOC_LANDING_PAGE);
    if (!string.IsNullOrWhiteSpace(Model.TransactionId))
    {
        backURL = LinkHelper.GetItemUrl(SitecoreItemIdentifiers.INFRASTRUCTURE_NOC_STATUS);
    }
}
<style>
    .form-field__input--readonly {
        font-weight: normal !important;
    }

    .form-field__input-wrapper--small {
        max-width: 200px;
        width: 200px;
    }
</style>

<div class="j105-drrg">
    <div class="m66-preloader j105-drrg--loader hidden">
        <div class="grid">
            <div class="grid__row">
                <div class="grid__column grid__column--12">
                    <h2 class="text__section-subtitle">@Translate.Text("J100.Pleasewait")</h2>
                    <div class="loader"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="grid j134-infrastructure-noc" data-journey="j134-infrastructure-noc">
    <div class="grid__row mb12">
        <div class="grid__column grid__column--12">
            <!-- m26-page-title-start -->
            <div class="m26-page-title title_message">
                <div class="m26-page-title__links">
                    <p class="m26-page-title__backlink j113-epass--main_controls">
                        <a class="button button--text button--back back-noc hidden">
                            @Translate.Text("NOC_Back")
                        </a>
                    </p>
                </div>
                <div class="m26-page-title__links">
                    <p class="m26-page-title__backlink  back-noc-status">
                        <a class="button button--text button--back" href="@backURL">
                            @Translate.Text("NOC_Back")
                        </a>
                    </p>
                </div>
                <h2 class="text__page-title mb24">@Translate.Text("NOC_Title")</h2>
                @*<p class="intro-text mt12">@Translate.Text("NOC_SubDescription")</p>*@
            </div>
            <!-- m26-page-title-end -->
        </div>
        <div class="grid__column grid__column--12 grid__column--form">
            <div id="tracker">
                @Html.Sitecore().Placeholder("j18/m38-step-tracker")
            </div>
        </div>
    </div>
    <div class="grid__row">

        <div class="grid__column grid__column--12 grid__column--form">
            <div id="accountSelector" class="mb32 mt24">
                <div class="m66-preloader small" style="display: none;">
                    <div class="loader-small"></div>
                </div>

                <div class="errordiv">@Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")</div>

                @*@if (!string.IsNullOrWhiteSpace(Model.TransactionId) && Model.selectedAccounts != null)
                    {
                        @Html.Partial("~/Views/Feature/CommonComponents/Shared/_ViewSelectedAccount.cshtml", new SelectedAccountViewModel(Model.selectedAccounts) { FieldLabel = "" })
                    }
                    else
                    {
                    }*@
                @Html.Sitecore().Placeholder("j69/account-selector")

                <div id="description-for-ContractAccount" class="form-field__messages hidden">
                    <ul class="parsley-errors-list filled" id="parsley-id-6"><li class="parsley-custom-error-message">@Translate.Text("PrimseTypeInValidationMessage")</li></ul>
                </div>
            </div>
            @using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, FormMethod.Post, new { @id = "NocRequestForm", @class = "nocRequestForm", @data_form = "true", @enctype = "multipart/form-data", @data_submit_validate = "enabled" }))
            {
                @Html.AntiForgeryToken()
                @Html.HiddenFor(m => m.BusinessPartner)
                @Html.HiddenFor(m => m.ContractAccount, new
                {
               @data_parsley_error_message = Translate.Text("PrimseTypeInValidationMessage"),
               @data_parsley_errors_container = "#description-for-ContractAccount",
               @data_parsley_trigger = "focusout",
               @required = "required",
           })
                @Html.HiddenFor(m => m.TransactionId)

                <div id="step1">

                    @if (!string.IsNullOrWhiteSpace(Model.TransactionId))
                    {
                        <fieldset class="fieldset mt24">
                            <legend class="legend">@Translate.Text("NOC_GeneralDetails")</legend>
                        </fieldset>

                        <div class="form-field form-field--text">
                            <label for="form-field-lblrevision" class="form-field__label form-field__label--readonly">
                                @Translate.Text("NOC_VerNo")
                            </label>
                            <div class="form-field__input-wrapper form-field__input-wrapper--readonly">
                                <input class="form-field__input form-field__input--readonly"
                                       readonly=""
                                       id="form-field-lblrevision"
                                       name="Revision"
                                       type="text"
                                       value="@Model.Revision" />
                            </div>
                        </div>

                        <div class="form-field form-field--text">
                            <label for="form-field-lblapplicationnumber" class="form-field__label form-field__label--readonly">
                                @Translate.Text("NOC_DewaApplicationNumber")
                            </label>
                            <div class="form-field__input-wrapper form-field__input-wrapper--readonly">
                                <input class="form-field__input form-field__input--readonly"
                                       readonly=""
                                       id="form-field-lblapplicationnumber"
                                       name="applicationnumber"
                                       type="number"
                                       value="@Model.TransactionId" />
                            </div>
                        </div>

                        <div class="form-field form-field--text">
                            <label for="form-field-lblstatus" class="form-field__label form-field__label--readonly">
                                @Translate.Text("NOC_Status")
                            </label>
                            <div class="form-field__input-wrapper form-field__input-wrapper--readonly">
                                <input class="form-field__input form-field__input--readonly"
                                       readonly=""
                                       id="form-field-lblstatus"
                                       name="status"
                                       type="text"
                                       value="@Model.StatusDescription" />
                            </div>
                        </div>

                        <div class="form-field form-field--text">
                            <label for="form-field-lblsubmissiondate" class="form-field__label form-field__label--readonly">
                                @Translate.Text("NOC_DateOfSubmissionToDewa")
                            </label>
                            <div class="form-field__input-wrapper form-field__input-wrapper--readonly">
                                <input class="form-field__input form-field__input--readonly"
                                       readonly=""
                                       id="form-field-lblsubmissiondate"
                                       name="submissiondate"
                                       type="text"
                                       value="@Model.SubmittedDate" />
                            </div>
                        </div>
                    }

                    <fieldset class="fieldset mt24">
                        <legend class="legend">@Translate.Text("NOC_ProjectDetails")</legend>
                    </fieldset>

                    <div class="form-field form-field--text">
                        <label for="form-field-plotnumber" class="form-field__label">@Translate.Text("NOC_Plotnumber")</label>
                        <span class="form-field__input-wrapper">
                            @Html.TextBoxFor(x => x.PlotNumber, new
                       {
                           @class = "form-field__input form-field__input--text plot",
                           @type = "text",
                           @id = "form-field-plotnumber",
                           @maxlength = "10",
                           @data_parsley_pattern = "/^[0-9]*$/",
                           @placeholder = Translate.Text("NOC_PlaceHolder_Plotnumber"),
                           @required = "required",
                           @data_parsley_error_message = Translate.Text("NOC_RequiredField"),
                           @data_parsley_errors_container = "#description-for-plotnumber",
                           @aria_describedby = "description-for-plotnumber",
                           @data_parsley_trigger = "focusout",
                           @data_parsley_id = "18"
                       })
                        </span>
                        <div id="description-for-plotnumber" class="form-field__messages">
                        </div>
                    </div>

                    <div class="form-field form-field--select form-field--select-single">
                        <label for="form-field-worktype" class="form-field__label">
                            @Translate.Text("NOC_ProposedWorkType")
                        </label>
                        @if (Model.WorkTypeList != null)
                        {
                            <span class="form-field__input-wrapper form-field__input-wrapper--select">

                                @Html.DropDownListFor(x => x.SelectedWorkType, new SelectList(Model.WorkTypeList, "Value", "Text", "Y0096"), Translate.Text("NOC_SelectWorkType"), new
                           {
                               @class = "form-field__input form-field__input--select form-field__input--select-full",
                               @data_parsley_id = "1",
                               @id = "form-field-worktype",
                               @required = "",
                               @aria_describedby = "description-for-worktype",
                               @data_parsley_errors_container = "#description-for-worktype",
                               data_parsley_required_message = Translate.Text("NOC_RequiredField")

                           })
                            </span>
                        }
                        <div id="description-for-worktype" class="form-field__messages">
                        </div>
                    </div>

                    <div class="form-field form-field--text form-field--textarea">
                        <label for="form-field-descproposedWorktype" class="form-field__label">
                            @Translate.Text("NOC_DescProposedWorkType")
                        </label>
                        <span class="form-field__input-wrapper">
                            @Html.TextAreaFor(m => m.DescProposedWorkYype,
                                new
                                     {
                                    @value = "Enter here",
                                    @class = "form-field__input form-field__input--text form-field__input--textarea",
                                    @placeholder = Translate.Text("NOC_PlaceHolder_DescProposedWorkType"),
                                    @data_parsley_error_message = Translate.Text("NOC_RequiredField"),
                                    @data_parsley_errors_container = "#description-for-descproposedWorktype",
                                    @aria_describedby = "description-for-descproposedWorktype",
                                    @data_parsley_id = "18",
                                    @maxlength = "500",
                                    @required = "",
                                    @data_textarea = "descproposedWorktype"
                                })
                        </span>
                        <div id="description-for-descproposedWorktype" class="form-field__messages">
                            <p class="form-field__charcount">@Translate.Text("Max") <span data-charcount="descproposedWorktype">0</span>/500 @Translate.Text("Characters")</p>
                            <p class="form-field__description">
                                @Translate.Text("NOC_ProposedWork_Notes")
                            </p>
                        </div>
                    </div>

                    <div class="form-field__button">
                        <button type="button" id="nocNext" class="button button--primary button--fullwidth-mobile">@Translate.Text("NOC_Next")</button>
                    </div>
                </div>

                <div id="step2" class="hidden">
                    @if (!string.IsNullOrWhiteSpace(Model.TransactionId))
                    {
                        if (Model.nocReqAttachments != null)
                        {
                            var prev = string.Empty;
                            <fieldset class="fieldset">
                                <legend class="legend">@Translate.Text("NOC_UploadDocuments")</legend>
                                <div class="form-field form-field--text">
                                    @foreach (NocRequestAttachments item in Model.nocReqAttachments)
                                    {
                                        if (!string.IsNullOrWhiteSpace(item.Folder) && !item.Folder.Equals(prev))
                                        {
                                            <p class="form-field__helplink">
                                                <a data-trigger="true" data-transactionid="@Model.TransactionId" data-doctype="@item.DocType" data-revision="@item.Folder" class="view_modal link">@item.Folder @Translate.Text("NOC_ViewDocuments")</a>
                                            </p>
                                            prev = item.Folder;
                                        }
                                    }
                                </div>

                            </fieldset>
                        }
                        if (Model.nocReqDewaAttachments != null)
                        {
                            var prev = string.Empty;
                            <fieldset class="fieldset">
                                <legend class="legend">@Translate.Text("NOC_DewaDocuments")</legend>
                                <div class="form-field form-field--text">
                                    @foreach (NocRequestAttachments item in Model.nocReqDewaAttachments)
                                    {
                                        if (!string.IsNullOrWhiteSpace(item.Folder) && !item.Folder.Equals(prev))
                                        {
                                            <p class="form-field__helplink">
                                                <a data-trigger="true" data-transactionid="@Model.TransactionId" data-doctype="@item.DocType" data-revision="@item.Folder" class="view_modal link">@((item.Folder.Equals("DEWA_APPROVED")) ? item.Folder.Replace("DEWA_APPROVED", "") + " " + Translate.Text("NOC_DewaViewDocuments") : item.Folder + " " + Translate.Text("NOC_ViewDocuments"))</a>
                                            </p>
                                            prev = item.Folder;
                                        }
                                    }
                                </div>
                            </fieldset>
                        }
                    }

                    <fieldset class="fieldset ">
                        <legend class="legend">@Translate.Text("NOC_Documents")</legend>
                        <label for="form-field-6ckws2kd9" class="form-field__label">
                            @Translate.Text("NOC_CopyOfAffectionPlan")
                            <span class="form-field__label-required aria-only">@Translate.Text("NOC_Required")</span>
                        </label>
                        <div class="form-field form-field--upload">
                            <div class="form-field__input-wrapper">
                                <div class="form-field__preview-wrapper">
                                    <img src="/images/preview@2x.png" data-src="/images/images/preview@2x.png" data-success="/images//upload_success@2x.png" class="form-field__preview tooltipstered" aria-hidden="true" role="presentation" alt="alt text" data-uploader-image="affectionplan">
                                </div>
                                <div class="form-field__uploader-details">
                                    <label for="form-field-affectionplan" class="form-field__label">
                                        <span class="form-field__label-required aria-only">@Translate.Text("NOC_Required")</span>
                                    </label>
                                    <div>
                                        <label>
                                            <input class="form-field__input form-field__input--upload"
                                                   id="form-field-affectionplan"
                                                   name="Copy_AffectionPlan"
                                                   type="file"
                                                   aria-describedby="description-for-affectionplan"
                                                   data-parsley-errors-container="#description-for-affectionplan"
                                                   required=""
                                                   data-parsley-required-message="@Translate.Text("NOC_File1RequiredField")"
                                                   data-uploader-field="affectionplan"
                                                   accept=""
                                                   data-accepts='"jpg","bmp","png","jpeg","pdf"'
                                                   data-size="15048000"
                                                   data-parsley-trigger="focusout"
                                                   data-parsley-id="16">

                                            <span class="button button--primary button--next button--small focus-enabled" data-uploader-button="upload-choose">@Translate.Text("NOC_Choose")</span>
                                        </label>
                                    </div>
                                    <p class="form-field__input--upload-format-error-message" data-uploader-format-error="error-message">@Translate.Text("NOC_UploadFormat_Error")</p>
                                    <p class="form-field__input--upload-size-error-message" data-uploader-size-error="error-message">@Translate.Text("NOC_FileSize_Error")</p>
                                    <p class="form-field__input--upload-filename" data-uploader-filename="affectionplan"></p>
                                    <p><button class="button button--text button--remove hidden" data-uploader-remove="affectionplan">@Translate.Text("NOC_Remove")</button></p>
                                </div>
                            </div>
                            <div id="description-for-affectionplan" class="form-field__messages">
                                <p class="form-field__description">@Translate.Text("NOC_UploadFile_Desc")</p>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="fieldset ">
                        <label for="form-field-coverletter" class="form-field__label">
                            @Translate.Text("NOC_ProposedWorkDrawingSketch")
                            <span class="form-field__label-required aria-only">@Translate.Text("NOC_Required")</span>
                        </label>
                        <div class="form-field form-field--upload">
                            <div class="form-field__input-wrapper">
                                <div class="form-field__preview-wrapper">
                                    <img src="/images/preview@2x.png" data-src="/images/preview@2x.png" data-success="/images/upload_success@2x.png" class="form-field__preview tooltipstered" aria-hidden="true" role="presentation" alt="alt text" data-uploader-image="coverletter">
                                </div>
                                <div class="form-field__uploader-details">
                                    <label for="form-field-coverletter" class="form-field__label">
                                        <span class="form-field__label-required aria-only">@Translate.Text("NOC_Required")</span>
                                    </label>
                                    <div>
                                        <label>
                                            <input class="form-field__input form-field__input--upload"
                                                   id="form-field-coverletter"
                                                   name="Cover_Letter"
                                                   type="file"
                                                   aria-describedby="description-for-coverletter"
                                                   data-parsley-errors-container="#description-for-coverletter"
                                                   data-parsley-required-message="@Translate.Text("NOC_File2RequiredField")"
                                                   data-uploader-field="coverletter"
                                                   accept=""
                                                   data-accepts='"jpg","bmp","png","jpeg","pdf"'
                                                   data-size="15048000"
                                                   data-parsley-trigger="focusout"
                                                   data-parsley-id="16">

                                            <span class="button button--primary button--next button--small focus-enabled" data-uploader-button="upload-choose">@Translate.Text("NOC_Choose")</span>
                                        </label>
                                    </div>
                                    <p class="form-field__input--upload-format-error-message" data-uploader-format-error="error-message">@Translate.Text("NOC_UploadFormat_Error")</p>
                                    <p class="form-field__input--upload-size-error-message" data-uploader-size-error="error-message">@Translate.Text("NOC_FileSize_Error")</p>
                                    <p class="form-field__input--upload-filename" data-uploader-filename="coverletter"></p>
                                    <p><button class="button button--text button--remove hidden" data-uploader-remove="coverletter">@Translate.Text("NOC_Remove")</button></p>
                                </div>
                            </div>
                            <div id="description-for-coverletter" class="form-field__messages">
                                <p class="form-field__description">@Translate.Text("NOC_UploadFile_Desc")</p>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="fieldset ">
                        <label for="form-field-6ckws2kd9" class="form-field__label">
                            @Translate.Text("NOC_ProposedWorkDrawingSketch")
                            <span class="form-field__label-required aria-only">@Translate.Text("NOC_Required")</span>
                        </label>
                        <div class="form-field form-field--upload">
                            <div class="form-field__input-wrapper">
                                <div class="form-field__preview-wrapper">
                                    <img src="/images/preview@2x.png" data-src="/images/preview@2x.png" data-success="/images//upload_success@2x.png" class="form-field__preview tooltipstered" aria-hidden="true" role="presentation" alt="alt text" data-uploader-image="proposedworksketch">
                                </div>
                                <div class="form-field__uploader-details">
                                    <label for="form-field-proposedworksketch" class="form-field__label">
                                        <span class="form-field__label-required aria-only">@Translate.Text("NOC_Required")</span>
                                    </label>
                                    <div>
                                        <label>
                                            <input class="form-field__input form-field__input--upload"
                                                   id="form-field-proposedworksketch"
                                                   name="ProposedWorked_Sketch"
                                                   type="file"
                                                   aria-describedby="description-for-proposedworksketch"
                                                   data-parsley-errors-container="#description-for-proposedworksketch"
                                                   data-parsley-required-message="@Translate.Text("NOC_File3RequiredField")"
                                                   data-uploader-field="proposedworksketch"
                                                   accept=""
                                                   data-accepts='"jpg","bmp","png","jpeg","pdf"'
                                                   data-size="15048000"
                                                   data-parsley-trigger="focusout"
                                                   data-parsley-id="16">

                                            <span class="button button--primary button--next button--small focus-enabled" data-uploader-button="upload-choose">@Translate.Text("NOC_Choose")</span>
                                        </label>
                                    </div>
                                    <p class="form-field__input--upload-format-error-message" data-uploader-format-error="error-message">@Translate.Text("NOC_UploadFormat_Error")</p>
                                    <p class="form-field__input--upload-size-error-message" data-uploader-size-error="error-message">@Translate.Text("NOC_FileSize_Error")</p>
                                    <p class="form-field__input--upload-filename" data-uploader-filename="proposedworksketch"></p>
                                    <p><button class="button button--text button--remove hidden" data-uploader-remove="proposedworksketch">@Translate.Text("NOC_Remove")</button></p>
                                </div>
                            </div>
                            <div id="description-for-proposedworksketch" class="form-field__messages">
                                <p class="form-field__description">@Translate.Text("NOC_UploadFile_Desc")</p>
                            </div>
                        </div>
                    </fieldset>

                    @if (!string.IsNullOrWhiteSpace(Model.TransactionId))
                    {
                        <fieldset class="fieldset">
                            <div class="form-field form-field--text form-field--textarea">
                                <label for="form-field-customernotes" class="form-field__label">
                                    @Translate.Text("NOC_CustomerNotes")
                                </label>
                                <span class="form-field__input-wrapper">
                                    <textarea class="form-field__input form-field__input--text form-field__input--textarea"
                                              maxlength="500"
                                              data-textarea="customernotes"
                                              id="form-field-customernotes"
                                              name="CustomerNotes"
                                              type="textarea"
                                              placeholder=" @Translate.Text("NOC_PlaceHolderCustomerNotes")"
                                              aria-describedby="description-for-customernotes"
                                              data-parsley-errors-container="#description-for-customernotes"
                                              data-parsley-id="22"></textarea>
                                </span>
                                <p class="form-field__helplink floatRight">
                                    <a class="link view_status" data-transactionid="@Model.TransactionId">@Translate.Text("NOC_InteractionHistory")</a>
                                </p>
                            </div>
                        </fieldset>
                    }

                    <fieldset id="termsconditions" class="fieldset">
                        <div class="form-field__checkbox inline-terms">
                            <label>
                                <input class="form-field__input form-field__input--checkbox"
                                       id="form-field-checkbox_termsconditions"
                                       name="TermsCondition"
                                       type="checkbox"
                                       value="true"
                                       aria-describedby="description-for-termsconditions"
                                       required="" data-parsley-error-message="@Translate.Text("NOC_Termscondition_Validation")"
                                       data-parsley-errors-container="#description-for-termsconditions"
                                       data-parsley-multiple="checkbox_termsconditions"
                                       data-parsley-id="23" tabindex="1">
                                <span class="form-field__fakecheckbox focus-enabled">
                                    <span class="text">@Translate.Text("NOC_I_AgreeNotes")</span>
                                    @Html.Sitecore().Placeholder("noc_agree_placholder")
                                    @*<a href="@LinkHelper.GetItemUrl("{43CE1D10-102C-4DCA-84AA-373B2C980CFE}")" target="_blank" class="link nowrap" id="_q39br6swv_trigger11">@Translate.Text("NOC_Undertaking")</a>*@
                                </span>
                            </label>
                        </div>
                        <div id="description-for-termsconditions" class="form-field__messages">

                        </div>
                    </fieldset>

                    <div class="form-field__button">
                        <button id="btnNocSubmit" data-submission-text="@Translate.Text("Submitting")..." type="submit" class="button button--primary button--fullwidth-mobile">@Translate.Text("NOC_Submit")</button>
                    </div>
                </div>
            }
        </div>

    </div>

    <!-- View Download Modal Popup -->
    <div class="m39-modal m39-modal--new j134-infrastructure-noc-modal" data-component="m39-modal" id="modal_true">
        <button data-trigger="true" class="m39-modal__trigger hidden view_modal__trigger" id="_sm7xs93q5_trigger" type="button" aria-controls="_sm7xs93q5_content">MODAL TRIGGER FOR VIEW</button>
        <div data-content="true" class="m39-modal__container" role="dialog" aria-expanded="true" id="_sm7xs93q5_content" aria-labelledby="_sm7xs93q5_trigger">
            <div class="m39-modal__dialog">
                <div class="m39-modal__header">
                    <div class="m39-modal__title" id="viewdocument_title">@Model.Revision</div>
                    <a data-close="true" class="m39-modal__button--close" id="_sm7xs93q5_close" aria-controls="_sm7xs93q5_content">@Translate.Text("NOC_Close")</a>
                    <div class="m39-modal__subtitle">@Translate.Text("NOC_Documents")</div>
                </div>
                <div class="m39-modal__content" id="viewdocuments">

                </div>
            </div>
        </div>
        <div class="m39-modal__overlay" style="display: block;"> </div>
    </div>
    <!-- End -->
    <!-- View Status/Comments Modal Popup -->
    <div class="m39-modal m39-modal--new j134-infrastructure-noc-tab-modal" data-component="m39-modal" id="modal_true">
        <button data-trigger="true" class="m39-modal__trigger hidden status_modal__trigger" id="_sm7xs93q5a_trigger" type="button" aria-controls="_sm7xs93q5a_content">MODAL TRIGGER FOR VIEW</button>
        <div data-content="true" class="m39-modal__container" role="dialog" aria-expanded="true" id="_sm7xs93q5a_content" aria-labelledby="_sm7xs93q5a_trigger">
            <div class="m39-modal__dialog">
                <div class="m39-modal__header">
                    <div class="m39-modal__title">@Translate.Text("NOC_ApplicationDetails")</div>
                    <a data-close="true" class="m39-modal__button--close" id="_sm7xs93q5a_close" aria-controls="_sm7xs93q5a_content">@Translate.Text("NOC_Close")</a>
                    <div class="m39-modal__subtitle">@Translate.Text("NOC_ApplicationNumber") @Model.TransactionId</div>
                </div>
                <div class="m39-modal__content" id="viewstatus">
                    <div class="m39-modal__tabs">
                        <ul>
                            <li class="tab-status" data-tab="status">@Translate.Text("NOC_Status")</li>
                            <li class="tab-comment" data-tab="comment">@Translate.Text("NOC_Comments")</li>
                        </ul>
                    </div>
                    <div id="viewcomment_content">

                    </div>
                </div>

            </div>
        </div>
        <div class="m39-modal__overlay" style="display: block;"> </div>
    </div>
    <!-- End -->
</div>
<script type="text/javascript">

    docReady(function () {
        steptrackerwithinpage(2, 1, "@Translate.Text("NOC_GeneralDetails")", "true");
        var transacid = '@Model.TransactionId';
        if (transacid != '') {
            jQuery("#form-field-affectionplan").removeAttr("required");
            jQuery("#form-field-checkbox_termsconditions").removeAttr("required");
            jQuery("#termsconditions").hide();
        }
        jQuery('.plot').keyup(function () {
            var $th = jQuery(this);
            $th.val($th.val().replace(/[^0-9 +]/g, function (str) { ; return ''; }));

        });
        //jQuery('#form-account-selector').submit(handleAccountSelection);
        //jQuery('#form-account-selector').submit();
        jQuery(".view_status").on("click", function () {
            var formId = "NocRequestForm";
            var url = "/api/sitecore/InfrastructureNoc/GetStatusComment";
            jQuery.ajax({
                url: url,
                type: 'POST',
                traditional: true,
                data: AddForgeryToken({ transactionId: $(this).attr("data-transactionid") }, formId),
                beforeSend: function () {
                    jQuery('.j105-drrg--loader').show();
                    jQuery('.j105-drrg--loader').css('top', $(window).scrollTop());
                    jQuery('body').removeClass('unscrollable').addClass('unscrollable');
                    jQuery("#viewcomment_content").html('');
                },
                complete: function () {
                    jQuery('.j105-drrg--loader').hide();
                    jQuery('body').removeClass('unscrollable');
                },
            }).done(function (response) {
                jQuery("#viewcomment_content").html(response);
                jQuery(".status_modal__trigger").trigger("click");
                jQuery(".tab-status").removeClass("active");
                jQuery(".tab-status").addClass("hidden");
                jQuery(".tab-comment").addClass("active");
            });
        });
        jQuery(".view_modal").on("click", function () {
            var formId = "NocRequestForm";
            var revision = $(this).attr("data-revision");
            var url = "/api/sitecore/InfrastructureNoc/GetDocuments";
            jQuery.ajax({
                url: url,
                type: 'POST',
                traditional: true,
                data: AddForgeryToken({ transactionId: $(this).attr("data-transactionid"), folderName: $(this).attr("data-revision"), docType: $(this).attr("data-doctype") }, formId),
                beforeSend: function () {
                    jQuery('.j105-drrg--loader').show();
                    jQuery('.j105-drrg--loader').css('top', $(window).scrollTop());
                    jQuery('body').removeClass('unscrollable').addClass('unscrollable');
                    jQuery("#viewdocuments").html('');
                },
                complete: function () {
                    jQuery('.j105-drrg--loader').hide();
                    jQuery('body').removeClass('unscrollable');
                },
            }).done(function (response) {
                jQuery("#viewdocuments").html('');
                jQuery("#viewdocuments").html(response);
                if (revision =='DEWA_APPROVED')
                    jQuery("#viewdocument_title").html('@Translate.Text("NOC_DewaViewDocuments")');
                else
                    jQuery("#viewdocument_title").html(revision);
                jQuery(".view_modal__trigger").trigger("click");
            });
        });
        jQuery('.nocRequestForm').submit(function (e) {
            e.preventDefault();
            if (jQuery(".nocRequestForm").parsley().validate()) {
                //alert();
                jQuery('.j105-drrg--loader').show();
                jQuery('.j105-drrg--loader').css('top', $(window).scrollTop());
                $('body').removeClass('unscrollable').addClass('unscrollable');
                var accountNumber = jQuery("#accountSelector").find('input[name="SelectedAccountNumber"]:checked').val();
                var bpNumber = jQuery("#accountSelector").find('input[name="SelectedAccountNumber"]:checked').attr("data-legacy-bp-number");
                if (accountNumber != "" && bpNumber != "") {
                    jQuery("#ContractAccount").val(accountNumber);
                    jQuery("#BusinessPartner").val(bpNumber);
                    $('.nocRequestForm').submit();
                }
                return true;
            }
            return false;
        });
        jQuery('#form-field-worktype').on("change", function () {
            jQuery("#form-field-affectionplan").attr("required", "")
            if (jQuery(this).val() == "Y0100" || jQuery(this).val() == "Y0104") {
                jQuery("#form-field-affectionplan").removeAttr("required")
            }

        });
    });
    function handleAccountSelection(e) {
        //var accountNumber = jQuery(e.target).find('input[name="SelectedAccountNumber"]:checked').val();
        //var bpNumber = jQuery(e.target).find('input[name="SelectedAccountNumber"]:checked').attr("data-legacy-bp-number");

        return false;
    }

    $('.m38-step-tracker__progressbar').attr('aria-valuetext', "@Translate.Text("NOC_GeneralDetails")");
    jQuery('.back-noc').on('click', function () {

        var $page = jQuery('.nocRequestForm').find('#step2'),
            good = 0;

        if (good == 0) {
            $page.prev().show();
            $page.hide();
            steptrackerwithinpage(2, 1, "@Translate.Text("NOC_GeneralDetails")", "true");
            jQuery('#step2').hide();
            jQuery("#accountSelector").show();
            jQuery('.back-noc').hide();
            jQuery('.back-noc-status').show();
        }
        jQuery('html,body').animate({ scrollTop: jQuery('.j105-drrg').offset().top }, 1000);
    });
    jQuery('#nocNext').on('click', function () {
        var nxtBtn = jQuery(this);
        var $page = jQuery(nxtBtn).closest('#step1'),
            good = 0;
        CheckAccountNo(function (d) {

                jQuery('.nocRequestForm').parsley().validate();
            $page.find('.form-field__input').each(function () {
                if (jQuery(this).parsley().validate() == true) {

                } else {
                    good++;
                }
            });

            if (good == 0 && jQuery("#ContractAccount").val()!="") {
                $page.next().show();
                $page.hide();
                steptrackerwithinpage(2, 2, "@Translate.Text("NOC_Attachments")", "true");
                jQuery('#step1').hide();
                jQuery("#accountSelector").hide();
                jQuery('.back-noc').show();
                jQuery('.back-noc-status').hide();
            }
            jQuery('html,body').animate({ scrollTop: jQuery('.j105-drrg').offset().top }, 1000);

        })

    });


    function CheckAccountNo(fnOnsuccess) {
        var accountNumber = jQuery("#accountSelector").find('input[name="SelectedAccountNumber"]:checked').val();
        var bpNumber = jQuery("#accountSelector").find('input[name="SelectedAccountNumber"]:checked').attr("data-legacy-bp-number");

        var url = "@Url.Action("CheckAccountNoValid")?acNo=" + accountNumber;
        jQuery.ajax({
            url: url,
            type: 'GET',
            beforeSend: function () {
                jQuery("#ContractAccount").val("");
                jQuery("#BusinessPartner").val("");
                jQuery("#description-for-ContractAccount").hide();
            },
            complete: function () {

            },
        }).done(function (response) {
            if (response.success) {
                if (accountNumber && bpNumber) {
                    jQuery("#ContractAccount").val(accountNumber);
                    jQuery("#BusinessPartner").val(bpNumber);
                }
            }
            else {
                jQuery("#description-for-ContractAccount").show();
            }
            return fnOnsuccess(response);
        });
    }
</script>
