@using DEWAXP.Foundation.Integration.Enums
@using DEWAXP.Foundation.Helpers
@using Sitecore.Globalization
@using Sitecore.Mvc
@using DEWAXP.Foundation.Content
@using DEWAXP.Foundation.Content.Models.Bills
@model DEWAXP.Foundation.Content.Models.Payment.PaymentCompletionModel

@{
    string timeFix = "";
    if (@Language.Current.Name.ToLowerInvariant() == "ar-ae")
    {
        timeFix = "\u200F";
    }
}
@{
    var dir = Sitecore.Context.Culture.TextInfo.IsRightToLeft ? "rtl" : "ltr";
    decimal _suqiaAmount = Model.Receipts.Any() ? Model.Receipts.FirstOrDefault().SuqiaAmount : 0;
}

@if (ViewBag.RammasErrorMessage != null)
{
    <div class="grid__row hidden" id="errorpayment">
        <div class="grid__column grid__column--12">
            <div class="m40-status-message m40-status-message--error icon icon-caution" data-component="m40-status-message">
                <div class="m40-status-message__title">@Sitecore.Globalization.Translate.Text(DictionaryKeys.Global.SubmissionError)</div>
                <div class="m40-status-message__text">@ViewBag.RammasErrorMessage</div>
            </div>
        </div>
    </div>
}
<!--_Confirmation.cshtml-->
<div class="grid">
    <div class="grid__row noprint">
        <div class="grid__column grid__column--12">
            @Html.Sitecore().Placeholder("payment-confirmation/page-title")
        </div>
    </div>

    @if (Model.Succeeded)
    {
        decimal total = Model.Total + _suqiaAmount;
        <div class="grid__row">
            <div class="grid__column grid__column--12 grid__column--form">

                <div class="m40-status-message m40-status-message--success icon icon-new-success-message " data-component="m40-status-message">
                    <div class="m40-status-message__title icon--success">@Translate.Text("Payment completed")</div>
                    <div class="m40-status-message__text">@Model.Message</div>
                    <p>
                        <button class="button button--text button--printer noprint" data-print="page">@Translate.Text("Print this page")</button>
                    </p>
                </div>
            </div>
        </div>

        <div class="grid__row mb0">
            <div class="grid__column grid__column--12 grid__column--form">
                <h2 class="text__section-title success-subtitle__h2">@Translate.Text("Transaction_Details")</h2>

                <div class="m42-keyvalue success-page">
                    <dl>
                        <dt class="m42-keyvalue__key--stacked">@Translate.Text("payment date and time label")</dt>
                        @if (Language.Current.Name.ToLowerInvariant() == "ar-ae")
                        {
                            <dd class="m42-keyvalue__value--stacked tran-details">@Model.PaymentDate.ToString("dd MMM yyyy | " + timeFix + "ss:" + timeFix + "mm:" + timeFix + "HH", Sitecore.Context.Culture)</dd>
                        }
                        else
                        {
                            <dd class="m42-keyvalue__value--stacked tran-details">@Model.PaymentDate.ToString("dd MMM yyyy | " + timeFix + "HH:" + timeFix + "mm:" + timeFix + "ss", Sitecore.Context.Culture)</dd>
                        }
                        @*<dt class="m42-keyvalue__key--stacked">@Translate.Text("receipt id label")</dt>
                <dd class="m42-keyvalue__value--stacked tran-details">@Model.ReceiptIdentifiers</dd>*@

                        <dt class="m42-keyvalue__key--stacked">@Translate.Text("deg transaction id label")</dt>
                        <dd class="m42-keyvalue__value--stacked tran-details">@Model.DegTransactionId</dd>

                        <dt class="m42-keyvalue__key--stacked">@Translate.Text("dewa transaction id label")</dt>
                        <dd class="m42-keyvalue__value--stacked tran-details">@Model.DewaTransactionId</dd>
                        @if (!string.IsNullOrWhiteSpace(Model.AffectedAccounts) && !Model.Receipts.Any())
                        {
                            <dt class="m42-keyvalue__key--stacked">@Translate.Text("Accounts")</dt>
                            <dd class="m42-keyvalue__value--stacked tran-details">@Model.AffectedAccounts</dd>
                        }
                        <dt class="m42-keyvalue__key--stacked">@Translate.Text("Total amount")</dt>
                        <dd class="m42-keyvalue__value--stacked tran-details" data-numeric-format="0,0.00" data-currency="@Translate.Text("AED")">@(total)</dd>
                    </dl>

                </div>
                @if (!string.IsNullOrWhiteSpace(Model.AffectedAccounts) && Model.Receipts.Any())
                {
                    <div class="m44-bill-selector" data-component="m44-bill-selector" data-bill-total="@(total)" data-currency-suffix="@Translate.Text("AED")">
                        <div class="m44-bill-selector__partner">
                            <div class="m44-bill-selector__accounts-list">
                                @foreach (AccountReceiptModel receipt in Model.Receipts.Cast<AccountReceiptModel>())
                                {
                                    var indicatorClass = receipt.AccountIsActive ? "active" : "inactive";

                                    <div class="m44-bill-selector__account_confirmation--detail">
                                        <span class="m44-bill-selector__account m44-bill-selector__account--confirm" data-acc-detail="wrapper">
                                            @if (receipt.PhotoAvailable)
                                            {
                                                <img src="/images/ajax-loader_50x50.gif" data-src="/account_thumbs.ashx?id=@(receipt.AccountNumber)&aty=@((int)receipt.BillingClassification)" class="m44-bill-selector__image" alt="" role="presentation" data-acc-detail="acc_image">
                                            }
                                            <span class="m44-bill-selector__header">
                                                <span class="m44-bill-selector__name" data-acc-detail="acc_name">
                                                    @(receipt.AccountName)
                                                    @*<span dir="@dir" class="m44-bill-selector__status m44-bill-selector__status--@indicatorClass"></span>*@
                                                </span>

                                                <span class="m44-bill-selector__details">
                                                    <abbr title="@Translate.Text("Account")">@Translate.Text("Acc")</abbr>: <span data-acc-detail="acc_number">@receipt.AccountNumber</span><span class="aria-only"> | </span>
                                                </span>

                                            </span>
                                        </span>
                                        <div class="m44-bill-selector__confirmation-details" data-numeric-format="0,0.00" data-currency="@Translate.Text("AED")">
                                            @receipt.Amount
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

    }
    else
    {
        @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")
    }

<div class="grid__row">
    <div class="grid__column grid__column--12 grid__column--centered grid__column--form">
        @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SuqiaSuccessPayment.cshtml", _suqiaAmount)
        @Html.Sitecore().Placeholder("content-transreciept-placeholder")
        @*@Html.Sitecore().Placeholder("payment-confirmation/next-step-title")
        <div class="noprint">
        </div>*@
        
        <div class="grid__column grid__column--12 grid__column--centered grid__column--form noprint mt12">
        <h2 class="summary-footer__title">@Sitecore.Globalization.Translate.Text("Whats Next")</h2>

        <a role="button" href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.J14_PAY_BILLS)" class="button button--primary button--next">@Translate.Text("Pay another bill")</a>
      </div>
    </div>
</div>
</div>
<!--_Confirmation.cshtml-->