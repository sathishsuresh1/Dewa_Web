@using DEWAXP.Foundation.Helpers
@using Sitecore.Globalization
@using Sitecore.Mvc
@using Sitecore.Mvc.Configuration
@using DEWAXP.Foundation.Content
@model DEWAXP.Feature.ScrapSale.Models.ScrapSale.ForgotPasswordModel


<div class="grid">
    <div class="grid__row">
        <div class="grid__column grid__column--12">
            @Html.Sitecore().Placeholder("j7/m26-page-title")
        </div>
    </div>



    <div class="grid__row">
        <div class="grid__column grid__column--12 grid__column--form">
            @using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, FormMethod.Post, new { @id = "ForgetPasswordFrom", @data_form = "true", @data_parsley_focus = "none", @class = "form", @data_submit_validate = "enabled" }))
            {
                @Html.Sitecore().FormHandler()
                @Html.AntiForgeryToken()

                @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")
                @Html.HiddenFor(m => m.OtpRequestId)
                @Html.HiddenFor(m => m.ReferenceId)                
                <fieldset class="fieldset">
                    <legend class="legend-color">.</legend>
                    <div class="form-field form-field--text userFields">
                        <label for="form-field-forgot-password-username" class="form-field__label">
                            @Translate.Text("username label")
                        </label>
                        <span class="form-field__input-wrapper">
                            @Html.TextBoxFor(x => x.Username, new
                       {
                           @class = "form-field__input form-field__input--text",
                           @id = "form-field-forgot-password-username",
                           @placeholder = Translate.Text("username label"),
                           @required = "required",
                           @data_parsley_error_message = Translate.Text("register username validation message"),
                           @data_parsley_errors_container = "#description-for-forgot-password-username",
                           @aria_describedby = "description-for-forgot-password-username",
                           @maxlength = "20",
                           @autocomplete = "off"
                       })
                        </span>
                        <div id="description-for-forgot-password-username" class="form-field__messages">
                            @Html.ValidationMessageFor(x => x.Username, "", new { @class = "parsley-errors-list" })
                        </div>
                    </div>
                    <div class="form-field form-field--text userFields">
                        <label for="form-field-email" class="form-field__label">
                            @Translate.Text("email label")
                        </label>
                        <span class="form-field__input-wrapper">
                            @Html.TextBoxFor(x => x.Email, new
                       {
                           @class = "form-field__input form-field__input--text",
                           @id = "form-field-email",
                           @placeholder = Translate.Text("J106.EnterEmailAddress"),
                           @required = "required",
                           @type = "email",
                           @data_parsley_error_message = Translate.Text("email validation message"),
                           @data_parsley_errors_container = "#description-for-email",
                           @aria_describedby = "description-for-email"
                       })
                        </span>
                        <div id="description-for-email" class="form-field__messages">
                            @Html.ValidationMessageFor(x => x.Email, "", new { @class = "parsley-errors-list" })
                        </div>
                        <div id="_usererror" class="red hidden"></div>
                    </div>
                    <div class="grid__column grid__column--12 hidden" id="setPassword">

                        <div class="form-field form-field--text form-field--password">
                            <label for="form-field-new_password" class="form-field__label">
                                @Translate.Text("New password")
                                <span class="form-field__label-required aria-only">(@Translate.Text("required"))</span>
                                <span role="link" class="button button--text form-field__label-password-visibility button--show">
                                    <span class="show icon-b-show">@Translate.Text("Show")</span>
                                    <span class="hide icon-b-hide">@Translate.Text("Hide")</span>
                                </span>
                            </label>
                            <span class="form-field__input-wrapper">
                                <input class="form-field__input form-field__input--text form-field__input--password"
                                       id="form-field-new_password"
                                       name="Password"
                                       type="password"
                                       autocomplete="off"
                                       placeholder="@Translate.Text("New password")"
                                       data-parsley-dewapassword=""
                                       data-parsley-dewapassword-message=""
                                       aria-describedby="description-for-new_password"
                                       data-parsley-errors-container="#description-for-new_password"
                                       required=""
                                       data-parsley-required-message="@Translate.Text("Password Error Message")"
                                       data-parsley-id="6">
                            </span>
                            <div class="form-field__messages-password">
                                <ul class="form-field__messages-password-list">
                                    <li class="form-field__messages-password-list-item message-lowercase"><span>@Translate.Text("Pwd.lowercase")</span></li>
                                    <li class="form-field__messages-password-list-item message-special"><span>@Translate.Text("Pwd.special")</span></li>
                                    <li class="form-field__messages-password-list-item message-uppercase"><span>@Translate.Text("Pwd.uppercase")</span></li>
                                    <li class="form-field__messages-password-list-item message-number"><span>@Translate.Text("Pwd.number")</span></li>
                                    <li class="form-field__messages-password-list-item message-minimum"><span>@Translate.Text("Pwd.minimum")</span></li>
                                </ul>
                            </div>
                        </div>
                        <div class="form-field form-field--text form-field--password">
                            <label for="form-field-confirmpassword" class="form-field__label">
                                @Translate.Text("confirm password label")
                                <span class="form-field__label-required aria-only">(@Translate.Text("required"))</span>
                                <span role="link" class="button button--text form-field__label-password-visibility button--show">
                                    <span class="show icon-b-show">@Translate.Text("Show")</span>
                                    <span class="hide icon-b-hide">@Translate.Text("Hide")</span>
                                </span>
                            </label>
                            <span class="form-field__input-wrapper">
                                <input class="form-field__input form-field__input--text form-field__input--password"
                                       id="form-field-confirmpassword"
                                       name="ConfirmPassword"
                                       type="password"
                                       autocomplete="off"
                                       placeholder="@Translate.Text("confirm password label")"
                                       aria-describedby="description-for-confirmpassword"
                                       data-parsley-errors-container="#description-for-confirmpassword"
                                       required=""
                                       data-parsley-error-message="@Translate.Text("Password mismatch error")"
                                       data-parsley-equalto="#form-field-new_password"
                                       data-parsley-id="8"
                                       data-parsley-trigger="focusout">
                            </span>
                            <div id="description-for-confirmpassword" class="form-field__messages">
                            </div>
                        </div>
                        <div class="form-field__button">
                            <a class="button button--quaternary button-2-fit" href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.SCRAPESALE_PORTAL_LOGINPAGE)">@Translate.Text("Cancel")</a>
                            <button class="button button--primary button-2-fit" id="fgpwdbtn" type="submit" data-submission-text="@Translate.Text("Submitting")...">@Translate.Text("Confirm")</button>
                        </div>
                    </div>

                </fieldset>
                <div class="form-field__button">
                    <button class="button button--primary button--fullwidth hidden" disabled="" type="submit" data-submission-text="@Translate.Text("Submitting")...">@Translate.Text("send recovery email button text")</button>
                    <div class="button button--primary button--fullwidth-mobile email-verify">@Translate.Text("Next")</div>
                </div>
            }
        </div>
    </div>
</div>
<!--OTP verification Modal Popup-->
<div class="m39-modal m39-modal--profile m39-modal--nofocus adjustHieght" data-component="m39-modal" id="modal_true">
    <button data-trigger="true" class="m39-modal__trigger optpopuptrigger hidden">OTP Trigger</button>
    <div data-content="true" class="m39-modal__container" role="dialog" aria-expanded="false">
        <div class="m39-modal__dialog otp">
            <div class="m39-modal__header">
                <button data-close="true" class="m39-modal__button--close">
                    <span class="aria-only">@Translate.Text("Close")</span>
                </button>
            </div>
            <div class="m39-modal__content flex-center">
                <div class="otp--modalcontent">
                    <div class="otp_inputdisplay_screen hidden">
                        <img class="otp_chatcheck hidden" src="/images/chatcheck.png">
                        <img class="otp_mailcheck hidden" src="/images/mailcheck.png">
                        <div class="otp--modalcontent-title">
                            <span class="otp-title"></span>
                        </div>
                        <div class="otp--modalcontent-details">
                            <span class="otp_inputdisplay_screen_error red">
                            </span>
                        </div>
                        <div class="otp--modalcontent-text hidden">
                            @Html.Raw(Translate.Text("cust.care.info.note"))
                        </div>
                    </div>
                    <div class="otpselectionoption hidden">
                        <form class="form mt24 " data-form>
                            <div class="form-field">
                                <span>@Translate.Text("refund.VerifyOtpSubtitle")</span>
                                <fieldset class="fieldset">
                                    <legend class="form-field__label">
                                        <span class="form-field__label-required aria-only">.</span>
                                    </legend>
                                    <div class=" grid__column grid__column--12  grid__column--form align_left mt24 mb24">
                                        <p class="form-field__radio displayEmail">
                                            <label>
                                                <input class="form-field__input form-field__input--radio otp_diplay_input" id="otp_diplay_input_1" data-stype="e" name="otp_diplay_input" type="radio" aria-describedby="description-for-maskedvalue" data-parsley-errors-container="#description-for-maskedvalue" data-parsley-multiple="j113_radio" data-parsley-id="26">
                                                <span class="form-field__fakeradio focus-enabled emailSpan">

                                                </span>
                                                <br>
                                            </label>
                                        </p>
                                        <p class="form-field__radio displayMobile">
                                            <label>
                                                <input class="form-field__input form-field__input--radio otp_diplay_input" id="otp_diplay_input_2" data-stype="m" name="otp_diplay_input" type="radio" aria-describedby="description-for-maskedvalue" data-parsley-errors-container="#description-for-maskedvalue" data-parsley-multiple="j113_radio" data-parsley-id="26">
                                                <span dir="ltr" class="form-field__fakeradio focus-enabled mobileSpan">

                                                </span>
                                                <br>
                                            </label>
                                        </p>
                                    </div>
                                    <div id="description-for-radio-maskedvalue" class="form-field__messages">
                                    </div>
                                </fieldset>

                                <div class="form-field">
                                    <a href="javascript:void(0)" class="button button--primary mt0 btn-SendOtpSelection">@Translate.Text("cust.SendOTP")</a>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="otp_input_screen hidden">
                        <img class="otp_chatcheck hidden" src="/images/chatcheck.png">
                        <img class="otp_mailcheck hidden" src="/images/mailcheck.png">
                        <div class="otp--modalcontent-title">
                            <span class="otp-title"></span>
                        </div>
                        <div class="otp--modalcontent-details">
                            <span class="otp-message"></span>
                        </div>

                        <form class="form mt24 input-otp-textbox" data-form>
                            <div class="form-field form-field--otp centered">
                                <span class="form-field__input-wrapper_otp">
                                    <input class="form-field__input form-field__input--otp"
                                           id="form-field-otpnumber" name="text" type="number"
                                           aria-describedby="description-for-otpnumber"
                                           data-parsley-maxnumber="1"
                                           data-parsley-errors-container="#description-for-mobiotpnumber"
                                           required="" autofocus=""
                                           data-parsley-required-message="@Translate.Text("cust.required.field")"
                                           data-parsley-trigger="focusout" data-parsley-id="6"
                                           aria-invalid="false">
                                </span>
                                <span class="form-field__input-wrapper_otp">
                                    <input class="form-field__input form-field__input--otp"
                                           id="form-field-otpnumber" name="text" type="number"
                                           aria-describedby="description-for-otpnumber"
                                           data-parsley-maxnumber="1"
                                           data-parsley-errors-container="#description-for-otpnumber"
                                           required="" data-parsley-required-message="@Translate.Text("cust.required.field")"
                                           data-parsley-trigger="focusout" data-parsley-id="8"
                                           aria-invalid="false">
                                </span>
                                <span class="form-field__input-wrapper_otp">
                                    <input class="form-field__input form-field__input--otp"
                                           id="form-field-otpnumber" name="text" type="number"
                                           aria-describedby="description-for-otpnumber"
                                           data-parsley-maxnumber="1"
                                           data-parsley-errors-container="#description-for-otpnumber"
                                           required="" data-parsley-required-message="@Translate.Text("cust.required.field")"
                                           data-parsley-trigger="focusout" data-parsley-id="10"
                                           aria-invalid="false">
                                </span>
                                <span class="form-field__input-wrapper_otp">
                                    <input class="form-field__input form-field__input--otp"
                                           id="form-field-otpnumber" name="text" type="number"
                                           aria-describedby="description-for-otpnumber"
                                           data-parsley-maxnumber="1"
                                           data-parsley-errors-container="#description-for-otpnumber"
                                           required="" data-parsley-required-message="@Translate.Text("cust.required.field")"
                                           data-parsley-trigger="focusout" data-parsley-id="12"
                                           aria-invalid="false">
                                </span>
                                <span class="form-field__input-wrapper_otp">
                                    <input class="form-field__input form-field__input--otp"
                                           id="form-field-otpnumber" name="text" type="number"
                                           aria-describedby="description-for-otpnumber"
                                           data-parsley-maxnumber="1"
                                           data-parsley-errors-container="#description-for-otpnumber"
                                           required="" data-parsley-required-message="@Translate.Text("cust.required.field")"
                                           data-parsley-trigger="focusout" data-parsley-id="14"
                                           aria-invalid="false">
                                </span>
                                <span class="form-field__input-wrapper_otp">
                                    <input class="form-field__input form-field__input--otp"
                                           id="form-field-otpnumber" name="text" type="number"
                                           aria-describedby="description-for-otpnumber"
                                           data-parsley-maxnumber="1"
                                           data-parsley-errors-container="#description-for-otpnumber"
                                           required="" data-parsley-required-message="@Translate.Text("cust.required.field")"
                                           data-parsley-trigger="focusout" data-parsley-id="16"
                                           aria-invalid="false">
                                </span>
                                <input class="form-field__input form-field__input--otp_main"
                                       id="form-field-otpnumbermain" name="text" type="number"
                                       aria-describedby="description-for-otpnumber"
                                       data-parsley-maxnumber="6"
                                       data-parsley-errors-container="#description-for-otpnumber"
                                       data-parsley-required-message="@Translate.Text("cust.required.field")"
                                       data-parsley-trigger="focusout" data-parsley-id="33">
                                <div id="description-for-otpnumber" class="form-field__messages"></div>
                            </div>
                            <div class="form-field mt0 otp_inputdisplay_screen_error red hidden">
                            </div>
                            <div class="form-field">
                                <div class="button button--timer timer-button--outline"
                                     data-component="m78-timer" id="timerbutton"
                                     timer-labels="{&quot;before&quot;:&quot;@Translate.Text("cust.resend.button.text")&quot;, &quot;after&quot;:&quot;@Translate.Text("cust.resend.button.text") (&quot;}"
                                     timer-time="{&quot;seconds&quot;:180}">
                                    <span class="m78-timer--button_text">@Translate.Text("cust.send.button.text")</span>
                                    <span class="m78-timer--button_time"></span>
                                </div>
                            </div>
                            <div class="form-field"><span id="notmytext"></span> @Html.Raw(Translate.Text("Contact Customer Care Center"))</div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="m39-modal__overlay"> </div>
</div>
<!--OTP Modal Popup End-->


<script src="~/Scripts/External/nml/form-submit-validate.js"></script>
<script type="text/javascript">
 ///////////////////OTP Verification Script Start//////////////////////////////
    docReady(function () {
        var $confirmBtn = jQuery(".email-verify");
        var verifystep = null;





        function sendOTPs() {

            $('.adjustHieght').addClass('otp_scrap_select');

            var userName = $('#form-field-forgot-password-username').val();
            verifystep = null;
            $("#OtpRequestId").val('');
            $(".otp_inputdisplay_screen_error").html('');
            $(".otp_inputdisplay_screen_error").hide();
            $('input[name="otp_diplay_input"]').prop('checked', false);
            $(".otp-title").html('');
            $(".otp-message").html('');
            $(".otp-message").removeClass("red");


            GetMaskedValue(GetMaskedValueData(userName,"0"), function (rdata) {

                if (rdata.status) {
                   // $('#_usererror').html('');
                   // $('#_usererror').hide();

                    $('.emailSpan').html(rdata.data.maskedemail);
                    $('.mobileSpan').html(rdata.data.maskedmobile);

                    $(".optpopuptrigger").trigger('click');
                    $(".otpselectionoption").show();
                    $(".otp_input_screen").hide();
                }
                else {
                    //_usererror
                  //  $('#_usererror').html(rdata.desc);
                   // $('#_usererror').show();
                }

                // callbackGetMaskedValue(rdata);
            });


        }

        AddCustomForgeryToken = function (data, elementId) {
            data.__RequestVerificationToken = $(elementId + ' input[name=__RequestVerificationToken]').val();
            return data;
        };
        function GetMaskedValue(requestData, onSuccess) {

            var _postUrl = '@Url.Content("~/api/sitecore/ScrapSale/GetMaskedEmailNMobile")';
            requestData = AddCustomForgeryToken(requestData, "#ForgetPasswordFrom");
            $.ajax({
                url: _postUrl,
                type: 'POST',
                data: requestData,
                beforeSend: function () {
                    $(".m39-modal__button--close").trigger('click');
                    $(".m66-preloader-fullpage").show();
                    $(".otp_inputdisplay_screen").hide();
                    $(".otp_input_screen").hide();
                    $(".otp_inputdisplay_screen_error").hide();
                    $(".otp_inputdisplay_screen_success").hide();
                },
                success: onSuccess,
                error: function (er) {
                    console.log(er);
                },
                complete: function (x) {
                    $(".m66-preloader-fullpage").fadeOut();
                    console.log(x);
                }
            });
        }

        var isVerify = "0";
        var refNum = '';
        var actOTP = '';

        function GetMaskedValueData(pUserId,pType) {
            var userName = pUserId;
            var dN = pType;
            var referenceNumber = '';
            var actualOTP = '';

            if (refNum != '')
                referenceNumber = refNum;

            if (actOTP != '')
                actualOTP = actOTP;

            var requestData = {
                userName: userName,
                dN: dN,
                referenceNumber: referenceNumber,
                actualOTP: actualOTP

            }

            return requestData;
        }



        function resetTimer() {
            $("#otpform").find('.form-field__input--otp').attr('disabled', false);
            $("#otpform").find('.form-field--otp').removeClass('form-field-disabled');
            setTimeout(function () {
                jQuery('.form-field--otp').find('.form-field__input--otp')[0].focus()
            }, 500);
            setTimeout(function () {
                jQuery('.button--timer').trigger('start.timer');
            }, 500);
        }



        setTimeout(function () {
            $(".form-field__input--otp").on('keyup blur', function () {
                var otp = jQuery(".form-field__input--otp_main").val();
                var userName = $('#form-field-forgot-password-username').val();
                if (otp.length >= 6 && isVerify != "0") {
                    actOTP = otp;
                    $(".form-field__input--otp").val('');                  
                    CrudOtp(GetMaskedValueData(userName, isVerify), function (rdata) {
                        $(".m66-preloader-fullpage").fadeOut();
                        if (rdata.status) {
                           
                            $(".otp-message").removeClass("red");
                            $(".otp_input_screen").hide();
                            $(".m39-modal__button--close").trigger('click');
                            $('#OtpRequestId').val(actOTP);


                            $('.userFields').hide();
                            $('.email-verify').hide();
                            $('#setPassword').show();
                               // jQuery('#ScrapSaleRegistrationFrom').submit();
                               // $("#btnConfirm").html('Translate.Text("Submitting")...');
                                //$("#btnConfirm").attr('disabled', true);
                                //$('.email-verify').hide();
                                //$("#btnConfirm").show();
                                //$(".m66-preloader-fullpage").show();


                        }
                        else {
                            $(".optpopuptrigger").trigger('click');
                            //$(".otp-message").addClass("red");
                            $(".otp_input_screen").show();
                            $(".otp_inputdisplay_screen_error").show();
                            $(".otp_inputdisplay_screen_success").hide();
                            //$(".otp--modalcontent-text").show();
                            $(".otp_inputdisplay_screen_error").html(rdata.desc);
                        }
                    });
                }
            });
        }, 500);





          function CrudOtp(requestData, onSuccess) {

            var _postUrl = '@Url.Content("~/api/sitecore/ScrapSale/CrudOtpForgetPassword")';
              requestData = AddCustomForgeryToken(requestData, "#ForgetPasswordFrom");
            $.ajax({
                url: _postUrl,
                type: 'POST',
                data: requestData,
                beforeSend: function () {
                    $(".m39-modal__button--close").trigger('click');
                    $(".m66-preloader-fullpage").show();
                    $(".otp_inputdisplay_screen").hide();
                    $(".otp_input_screen").hide();
                    $(".otp_inputdisplay_screen_error").hide();
                    $(".otp_inputdisplay_screen_success").hide();
                },
                success: onSuccess,
                error: function (er) {
                    console.log(er);
                },
                complete: function (x) {
                    $(".m66-preloader-fullpage").fadeOut();
                    console.log(x);
                }
            });
        }



        $(document).on('click', '.btn-SendOtpSelection', function (e) {
            var userName = $('#form-field-forgot-password-username').val();
            $('.adjustHieght').removeClass('otp_scrap_select');
            if ($('#otp_diplay_input_1').is(':checked')) {

                CrudOtp(GetMaskedValueData(userName, "1"), function (rdata) {

                    var title = '@Html.Raw(Translate.Text("cust.email.otp.screen.title"))';
                    var msg = '@Html.Raw(Translate.Text("cust.email.otp.screen.msg"))';
                    $(".m66-preloader-fullpage").fadeOut();
                    $(".otp_inputdisplay_screen").hide();
                    //$(".otp--modalcontent-text").hide();
                    $(".otp-title").html(title);
                    $(".otp_mailcheck").show();
                    $(".otp_chatcheck").hide();
                    $("#notmytext").html('@Translate.Text("cust.not.my.emailaddress")');
                    $(".otpselectionoption").hide();
                    if (rdata.status && rdata.data.referencenumber != null) {
                        isVerify = "1";
                        refNum = rdata.data.referencenumber;

                        $(".otp-message").html(msg.replace("{0}", rdata.data.email));
                        $("#ReferenceId").val(rdata.data.referencenumber);
                        $(".otp_input_screen").show();
                        $(".otp_inputdisplay_screen_error").hide();

                        resetTimer();
                        $(".optpopuptrigger").trigger('click');
                    }
                    else {
                        $(".optpopuptrigger").trigger('click');
                        $(".otp_input_screen").hide();
                        $(".otp_inputdisplay_screen").show();
                        $(".otp_inputdisplay_screen_error").show();
                        //$(".otp--modalcontent-text").show();
                        $(".otp_inputdisplay_screen_error").html(rdata.desc);
                    }
                });

            }
            else if ($('#otp_diplay_input_2').is(':checked')) {

                CrudOtp(GetMaskedValueData(userName, "2"), function (rdata) {

                    var title = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.title"))';
                    var msg = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.msg"))';
                    $(".m66-preloader-fullpage").fadeOut();
                    $(".otp_inputdisplay_screen").hide();
                    //$(".otp--modalcontent-text").hide();
                    $(".otp-title").html(title);
                    $("#notmytext").html('@Translate.Text("cust.not.my.mobilenumber")');
                    $(".otpselectionoption").hide();
                    if (rdata.status && rdata.data.referencenumber != null) {
                        isVerify = "2";
                        refNum = rdata.data.referencenumber;
                        $(".otp_chatcheck").show();
                        $(".otp_mailcheck").hide();

                        $(".otp-message").html(msg.replace("{0}", rdata.data.mobile));
                        $("#ReferenceId").val(rdata.data.referencenumber);
                        $(".otp_input_screen").show();
                        $(".otp_inputdisplay_screen_error").hide();
                        $(".otp_inputdisplay_screen_success").show();

                        resetTimer();
                        $(".optpopuptrigger").trigger('click');
                    }
                    else {
                        $(".optpopuptrigger").trigger('click');
                        $(".otp_input_screen").hide();
                        $(".otp_inputdisplay_screen").show();
                        $(".otp_inputdisplay_screen_error").show();
                        $(".otp_inputdisplay_screen_success").hide();
                        //$(".otp--modalcontent-text").show();
                        $(".otp_inputdisplay_screen_error").html(rdata.desc);
                    }
                });
            }

        });


        jQuery("#timerbutton").on("click", function () {

               if (!jQuery("#timerbutton").hasClass("timer-button--outline")) {

                    var userName = $('#form-field-forgot-password-username').val();

                   if (isVerify == "1") {

                       CrudOtp(GetMaskedValueData(userName, "1"), function (rdata) {

                           var title = '@Html.Raw(Translate.Text("cust.email.otp.screen.title"))';
                           var msg = '@Html.Raw(Translate.Text("cust.email.otp.screen.msg"))';
                           $(".m66-preloader-fullpage").fadeOut();
                           $(".otp_inputdisplay_screen").hide();
                           //$(".otp--modalcontent-text").hide();
                           $(".otp-title").html(title);
                           $(".otp_mailcheck").show();
                           $(".otp_chatcheck").hide();
                           $("#notmytext").html('@Translate.Text("cust.not.my.emailaddress")');
                           $(".otpselectionoption").hide();
                           if (rdata.status && rdata.data.referencenumber != null) {
                               isVerify = "1";
                               refNum = rdata.data.referencenumber;

                               $(".otp-message").html(msg.replace("{0}", rdata.data.email));
                               $("#ReferenceId").val(rdata.data.referencenumber);
                               $(".otp_input_screen").show();
                               $(".otp_inputdisplay_screen_error").hide();

                               resetTimer();
                               $(".optpopuptrigger").trigger('click');
                           }
                           else {
                               $(".optpopuptrigger").trigger('click');
                               $(".otp_input_screen").hide();
                               $(".otp_inputdisplay_screen").show();
                               $(".otp_inputdisplay_screen_error").show();
                               //$(".otp--modalcontent-text").show();
                               $(".otp_inputdisplay_screen_error").html(rdata.desc);
                           }
                       });

                   }
                   else if (isVerify == "2") {

                       CrudOtp(GetMaskedValueData(userName, "2"), function (rdata) {

                           var title = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.title"))';
                           var msg = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.msg"))';
                           $(".m66-preloader-fullpage").fadeOut();
                           $(".otp_inputdisplay_screen").hide();
                           //$(".otp--modalcontent-text").hide();
                           $(".otp-title").html(title);
                           $("#notmytext").html('@Translate.Text("cust.not.my.mobilenumber")');
                           $(".otpselectionoption").hide();
                           if (rdata.status && rdata.data.referencenumber != null) {
                               isVerify = "2";
                               refNum = rdata.data.referencenumber;
                               $(".otp_chatcheck").show();
                               $(".otp_mailcheck").hide();

                               $(".otp-message").html(msg.replace("{0}", rdata.data.mobile));
                               $("#ReferenceId").val(rdata.data.referencenumber);
                               $(".otp_input_screen").show();
                               $(".otp_inputdisplay_screen_error").hide();
                               $(".otp_inputdisplay_screen_success").show();

                               resetTimer();
                               $(".optpopuptrigger").trigger('click');
                           }
                           else {
                               $(".optpopuptrigger").trigger('click');
                               $(".otp_input_screen").hide();
                               $(".otp_inputdisplay_screen").show();
                               $(".otp_inputdisplay_screen_error").show();
                               $(".otp_inputdisplay_screen_success").hide();
                               //$(".otp--modalcontent-text").show();
                               $(".otp_inputdisplay_screen_error").html(rdata.desc);
                           }
                       });
                   }


            }
        });


        $(document).on('click', '.email-verify', function (e) {
            //code here ....
            //alert($("#ScrapSaleRegistrationFrom").valid());
            var error = 0;

            $("#ForgetPasswordFrom").find('.form-field__input').not(':hidden').each(function () {

                ////////enable this after popup is fixed////////////
                jQuery(this).parsley().validate();

                if (!jQuery(this).parsley().isValid()) {
                    error++;
                }
            });
            if (error == 0) {
                // $(".emailDivT .m39-modal__trigger").click();
                sendOTPs();
            }

            // e.preventDefault();

        });


    });


</script>