@using Sitecore.Globalization
@using Sitecore.Mvc
@using Sitecore.Mvc.Configuration
@using DEWAXP.Foundation.Content
@model DEWAXP.Feature.ScrapSale.Models.ScrapSale.SalesOrderDownloadOTPModel
@{
    var direction = Sitecore.Context.Language.CultureInfo.TextInfo.IsRightToLeft ? "rtl" : "ltr";
}
<style>
    .parsley-required {
        margin-top: 7px !important;
        line-height: 14px;
    }
</style>
<div class="grid__row">
    <div class="grid__column grid__column--12 grid__column--form">
        <p class="mt24"></p>
        @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")
        @if (Model.ActionType == Translate.Text("SOD_ACT_Verify"))
        {
            using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, FormMethod.Post, new { @class = "form mt24", @data_form = "true", @data_parsley_focus = "none", @data_submit_validate = "enabled", @novalidate = "true" }))
            {
                @Html.Sitecore().FormHandler()
                @Html.AntiForgeryToken()


                @Html.HiddenFor(x => x.RefId)
                <div id="OTPRENDERSECTION">
                    @Html.HiddenFor(x => x.OTP, new { @maxlength = "6", @data_parsley_type = "number", @data_parsley_trigger = "change" })
                    <p class="mb12 mt12 text-page__intro" style="padding:0px 0px !important">@Html.Raw(Translate.Text("SOD_otpNote"))</p>
                    <div class="form-field form-field--otp centered">
                        <span class="form-field__input-wrapper_otp">
                            <input class="form-field__input form-field__input--otp"
                                   id="form-field-mobilenumber"
                                   name="text" type="number"
                                   aria-describedby="description-for-mobilenumber"
                                   data-parsley-maxnumber="1"
                                   data-parsley-errors-container="#description-for-mobilenumber"
                                   required=""
                                   autofocus=""
                                   data-parsley-required-message="@Translate.Text("SOD_OTPRequired")"
                                   data-parsley-trigger="focusout"
                                   data-parsley-id="6"
                                   aria-invalid="false">
                        </span>
                        <span class="form-field__input-wrapper_otp">
                            <input class="form-field__input form-field__input--otp"
                                   id="form-field-mobilenumber"
                                   name="text" type="number"
                                   aria-describedby="description-for-mobilenumber"
                                   data-parsley-maxnumber="1"
                                   data-parsley-errors-container="#description-for-mobilenumber"
                                   required=""
                                   data-parsley-required-message="@Translate.Text("SOD_OTPRequired")"
                                   data-parsley-trigger="focusout"
                                   data-parsley-id="8"
                                   aria-invalid="false">
                        </span>
                        <span class="form-field__input-wrapper_otp">
                            <input class="form-field__input form-field__input--otp"
                                   id="form-field-mobilenumber"
                                   name="text" type="number"
                                   aria-describedby="description-for-mobilenumber"
                                   data-parsley-maxnumber="1"
                                   data-parsley-errors-container="#description-for-mobilenumber"
                                   required=""
                                   data-parsley-required-message="@Translate.Text("SOD_OTPRequired")"
                                   data-parsley-trigger="focusout"
                                   data-parsley-id="10"
                                   aria-invalid="false">
                        </span>
                        <span class="form-field__input-wrapper_otp">
                            <input class="form-field__input form-field__input--otp"
                                   id="form-field-mobilenumber"
                                   name="text" type="number"
                                   aria-describedby="description-for-mobilenumber"
                                   data-parsley-maxnumber="1"
                                   data-parsley-errors-container="#description-for-mobilenumber"
                                   required=""
                                   data-parsley-required-message="@Translate.Text("SOD_OTPRequired")"
                                   data-parsley-trigger="focusout"
                                   data-parsley-id="12"
                                   aria-invalid="false">
                        </span>
                        <span class="form-field__input-wrapper_otp">
                            <input class="form-field__input form-field__input--otp"
                                   id="form-field-mobilenumber"
                                   name="text" type="number"
                                   aria-describedby="description-for-mobilenumber"
                                   data-parsley-maxnumber="1"
                                   data-parsley-errors-container="#description-for-mobilenumber"
                                   required=""
                                   data-parsley-required-message="@Translate.Text("SOD_OTPRequired")"
                                   data-parsley-trigger="focusout"
                                   data-parsley-id="14"
                                   aria-invalid="false">
                        </span>
                        <span class="form-field__input-wrapper_otp">
                            <input class="form-field__input form-field__input--otp"
                                   id="form-field-mobilenumber"
                                   name="text" type="number"
                                   aria-describedby="description-for-mobilenumber"
                                   data-parsley-maxnumber="1"
                                   data-parsley-errors-container="#description-for-mobilenumber"
                                   required=""
                                   data-parsley-required-message="@Translate.Text("SOD_OTPRequired")"
                                   data-parsley-trigger="focusout"
                                   data-parsley-id="16"
                                   aria-invalid="false">
                        </span>
                        <input class="form-field__input form-field__input--otp_main"
                               id="form-field-mobilenumbermain"
                               name="text" type="number"
                               aria-describedby="description-for-mobilenumbermain"
                               data-parsley-maxnumber="6"
                               data-parsley-errors-container="#description-for-mobilenumbermain"
                               data-parsley-required-message="@Translate.Text("SOD_OTPRequired")"
                               data-parsley-trigger="focusout"
                               data-parsley-id="33">
                        <div id="description-for-mobilenumber" dir="@(direction)" class="form-field__messages">
                        </div>

                    </div>

                    <div class="form-field__button">
                        <button type="submit" id="fromSubmitbtn" name="ActionType" value="@Model.ActionType" class="button button--primary button--fullwidth-mobile" data-submission-text="@Translate.Text("Submitting")...">@Translate.Text("Submit")</button>
                    </div>

                    <script>
                        docReady(function () {
                            var _this = this,
                                $field = $('.form-field--otp'),
                                $input = $field.find('.form-field__input--otp'),
                                i,
                                $inputMain = $field.find('.form-field__input--otp_main');

                            $input.each(function (index) {
                                var $i = $(this);

                                $i.off('keyup.otp').on('keyup.otp', function () {
                                    if ($i.val().length > 0) {
                                        //$i.focusout();
                                        $i.closest('.form-field__input-wrapper_otp').next().find('.form-field__input--otp').focus();
                                        i = index
                                    };
                                });
                            });

                            $(".form-field__input--otp").on('keyup blur', function () {
                                var OTPValue = '';
                                var currentIndex = $input.index(this);

                                $.each($(".form-field__input--otp"), function () {
                                    OTPValue += $(this).val();
                                });

                                $(".form-field__input--otp_main").val(OTPValue);
                                if (currentIndex == $input.length - 1 && OTPValue != "" && OTPValue.length == 6) {
                                    jQuery('#OTP').val(OTPValue);
                                };
                            });





                        });
                    </script>
                </div>
            }
        }
        @if (Model.ActionType == Translate.Text("SOD_ACT_update"))
        {
            <form action="@Url.Action("DownloadSaleOrderDownload")" method="post" class="form mt24" data-form="true" data-parsley-focus="none" data-submit-validate="enabled" novalidate="true">

                @Html.Sitecore().FormHandler()
                @Html.AntiForgeryToken()


                @Html.HiddenFor(x => x.RefId)
                @Html.HiddenFor(x => x.OTP)
                <p class="mb12 mt12 text-page__intro" style="padding:0px 0px !important">@Html.Raw(Translate.Text("SOD_downloadNote"))</p>
                <div class="form-field__button">
                    <button type="submit" id="fromSubmitbtn" name="ActionType" value="@Model.ActionType" class="button button--primary button--fullwidth-mobile" data-submission-text="@Translate.Text("SOD_Downloading")...">@Translate.Text("SOD_Download")</button>
                </div>
            </form>
        }

        <script src="~/Scripts/External/nml/form-submit-validate.js"></script>
    </div>
</div>