@model DEWAXP.Feature.ScrapSale.Models.ScrapSale.LoginModel
@using DEWAXP.Foundation.Helpers
@using Glass.Mapper.Sc.Fields
@using Sitecore.Mvc
@using Sitecore.Mvc.Configuration
@using Sitecore.Globalization
@using DEWAXP.Foundation.Content
@using _scPageItemId = DEWAXP.Foundation.Content.ScPageItemId
@using DEWAXP.Foundation.Content.Repositories
@using DEWAXP.Foundation.Integration.APIHandler.Impl

@{
    var _cache = DependencyResolver.Current.GetService<ICacheProvider>();
    string _responseData = string.Empty;
    _cache.TryGet("return_URI", out _responseData);


    var rUsername = !string.IsNullOrEmpty(Model.Username) ? "readonly" : string.Empty;
    bool _IsloginActive = !string.IsNullOrEmpty(Model.Username);

    var _retURL = Request.QueryString["returnUrl"] != null ? Request.QueryString["returnUrl"].ToString() : string.Empty;

    string _serviceType = string.Empty;


    if (_retURL.ToLower().Contains(MasarConfig.ScrapSaleDashboardURL))
    {
        _serviceType = Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(MasarConfig.ScrapType));
    }
    else if (_retURL.ToLower().Contains(MasarConfig.ElectricMeterTesting) || _retURL.ToLower().Contains(MasarConfig.ElectricMeterTestingDEWAProjects) ||
      _retURL.ToLower().Contains(MasarConfig.TransformerOilTesting) || _retURL.ToLower().Contains(MasarConfig.JointerCertificationFormURL))
    {
        _serviceType = Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(MasarConfig.MiscellaneousType));
    }


}

<div class="grid j07-customer-login">
    <div class="grid">
        <div class="grid__row mt24">
            <div class="grid__column grid__column--12 p0">
                <div class="m17-sectiontitle m17-sectiontitle__title--green" data-component="m17-sectiontitle">
                    <h3 class="m17-sectiontitle__title  text__section-title">@Translate.Text("Welcome to DEWA")</h3>
                </div>
            </div>
        </div>
        <div class="grid__row">
            <div class="grid__column grid__column--3">
                <h2 class="m12-subsection__title">@Translate.Text("I am a")</h2>
                <ul class="links-list">
                    @*<li class="links-list__item"><a href="#" class="links-list__link active">Individual</a></li>
                        <li class="links-list__item"><a href="#" class="links-list__link">Business</a></li>
                        <li class="links-list__item"><a href="#" class="links-list__link">Partner/Supplier</a></li>
                        <li class="links-list__item"><a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.J8_GOVT_LOGIN_PAGE)" class="links-list__link">@Translate.Text("Government")</a></li>*@
                    <li class="links-list__item"><a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.J7_LOGIN_PAGE)" class="links-list__link">@Translate.Text("Individual")</a></li>
                    <li class="links-list__item"><a href="https://crm.dewa.gov.ae/irj/portal/anonymous" class="links-list__link">@Translate.Text("Contractors & Consultants")</a></li>
                    <li class="links-list__item"><a href="https://srm.dewa.gov.ae/irj/portal/anonymous" class="links-list__link">@Translate.Text("Suppliers")</a></li>
                    @*<li class="links-list__item"><a href="https://e-services.dewa.gov.ae/partners/login.aspx" class="links-list__link">@Translate.Text("Partners")</a></li>*@
                    @*<li class="links-list__item"><a href="https://careers.dewa.gov.ae/irj/portal/anonymous/onbp?lang=en" class="links-list__link  active">@Translate.Text("Careers")</a></li>*@
                    <li class="links-list__item"><a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.CAREER_POTAL_LOGIN)" class="links-list__link">@Translate.Text("Careers")</a></li>
                    <li class="links-list__item"><a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.J8_GOVT_LOGIN_PAGE)" class="links-list__link">@Translate.Text("Government")</a></li>
                    <li class="links-list__item"><a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.EXPO_LOGIN_PAGE)" class="links-list__link">@Translate.Text("Expo2020login")</a></li>
                    <li class="links-list__item"><a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.MISCELLANEOUS_LOGIN)" class="links-list__link active">@Translate.Text("SS_MiscellaneousTitle")</a></li>
                </ul>
            </div>



            <div class="grid__column grid__column--6">
                <div class="m12-subsection_login-wrapper" style="border:none;">
                    @using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, new { returnUrl = ViewBag.ReturnUrl }, FormMethod.Post, new { @id = "LoginForm", @data_parsley_focus = "true", @data_form = "true", @class = "form", @data_submit_validate = "enabled", @novalidate = string.Empty, @autocomplete = "off" }))
                    {
                    @Html.Sitecore().FormHandler()
                    @Html.AntiForgeryToken()
                    @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")
                    @Html.HiddenFor(m => m.LoginType)
                    @Html.HiddenFor(m => m.AfterLoginURL)

                    <h2 class="text__page-title">@Translate.Text("SS_MiscellaneousTitle")</h2>
                        if (_serviceType == string.Empty)
                        {
                    <div class="form-field form-field--select form-field--select-single">
                        <label for="form-field-z198vv0ad" class="form-field__label">
                            @Translate.Text("SS_ChooseService")
                        </label>
                        <span class="form-field__input-wrapper form-field__input-wrapper--select form-field__input-wrapper--validated">
                            @Html.DropDownListFor(model => model.MiscellaneousServicesKey, Model.MiscellaneousServices, new
                       {
                           @class = "form-field__input form-field__input--select form-field__input--select-full",
                           @id = "form-field-z198vv0ad",
                           @required = "",
                           @data_parsley_required_message = Translate.Text("SS_UR_ServiceRequired"),
                           @data_parsley_errors_container = "#description-for-z198vv0ad",
                           @aria_describedby = "description-for-z198vv0ad",

                       })
                        </span>
                        <div id="description-for-z198vv0ad" class="form-field__messages">
                        </div>
                    </div>
                        }

                    <div class="form-field form-field--text">
                        <label for="form-field-login-main-username" class="form-field__label">
                            @Translate.Text("username label")

                        </label>
                        <span class="form-field__input-wrapper">
                            @Html.TextBoxFor(x => x.Username, new
                       {
                           @class = "form-field__input form-field__input--text",
                           @type = "text",
                           @id = "form-field-login-main-username",
                           @placeholder = Translate.Text("username label"),
                           //@aria_required = "true",
                           @required = "required",
                           @data_parsley_error_message = Translate.Text("register username validation message"),
                           @data_parsley_errors_container = "#description-for-login-main-username",
                           @aria_describedby = "description-for-login-main-username",
                           @tabindex = "1",
                           @maxlength = "20"
                       })
                        </span>
                        <div id="description-for-login-main-username" class="form-field__messages">
                            @Html.ValidationMessageFor(x => x.Username, "", new { @class = "parsley-errors-list" })
                            <p class="form-field__helplink">
                                @*<a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.SCRAPESALE_FORGET_USERNAME)">@Translate.Text("forgot username link text")</a>*@
                                <a id="_forgotUser" href="javascript:void(0)">@Translate.Text("forgot username link text")</a>
                            </p>
                        </div>
                    </div>
                    <div class="form-field form-field--text mt0">
                        <label for="form-field-login-main-password" class="form-field__label">
                            @Translate.Text("login password label")

                        </label>
                        <span class="form-field__input-wrapper">
                            @Html.PasswordFor(x => x.Password, new
                       {
                           @class = "form-field__input form-field__input--text",
                           @id = "form-field-login-main-password",
                           @placeholder = Translate.Text("login password label"),
                           //@aria_required = "true",
                           @type = "password",
                           @required = "required",
                           @data_parsley_errors_container = "#description-for-login-main-password",
                           @aria_describedby = "description-for-login-main-password",
                           @data_parsley_error_message = Translate.Text(DictionaryKeys.Global.Login.PleaseEnterPassword),

                           @autocomplete = "off",
                           @tabindex = "1"
                       })
                        </span>
                        <div id="description-for-login-main-password" class="form-field__messages">
                            @Html.ValidationMessageFor(x => x.Password, "", new { @class = "parsley-errors-list" })
                            <p class="form-field__helplink">
                                <a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.SCRAPESALE_FORGET_PASSWORD)">@Translate.Text("forgot password link text")</a>
                            </p>
                        </div>
                    </div>
                    <div class="form-field form-field--toggles mt0">
                        <fieldset class="fieldset">
                            <legend class="form-field__label aria-only">
                                @Translate.Text("header.rememberme")
                                <span class="form-field__label-optional">(optional)</span>
                            </legend>
                            <div class="form-field__checkbox  last  first">
                                <label for="rememberme">
                                    <input class="form-field__input form-field__input--checkbox" id="rememberme" name="checkbox_rememberme1" type="checkbox" value="1" aria-describedby="description-for-jpjw6rpk1" data-parsley-errors-container="#description-for-jpjw6rpk1">
                                    <span class="form-field__fakecheckbox focus-enabled">
                                        @Translate.Text("header.rememberme")
                                    </span>
                                </label>
                            </div>
                            <div id="description-for-jpjw6rpk1" class="form-field__messages">
                            </div>
                        </fieldset>
                    </div>
                    <div class="form-field__button form-field__button-flex">
                        <button id="loginButton" type="submit" class="button button--primary" data-submission-text="@Translate.Text("Logging in")...">@Translate.Text("login button text")</button>
                        <div class="form-field__button-flex-links">
                            <span class="">

                                <a id="createAcc" href="javascript:void(0)" class="form-links__link">@Translate.Text("SS_UR_Enroll")</a>

                            </span><span class="">
                                @Translate.Text("SS_AlreadyEnrolled")
                                <a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.SCRAPESALE_TRACKAPPLICATION)" class="form-links__link inline-block">@Translate.Text("SS_TrackRequest")</a>

                            </span>



                        </div>

                    </div>


                    }
                    @Html.Sitecore().Placeholder("loginsession")
                </div>
            </div>




        </div>
    </div>
</div>
<script>
    if ('@rUsername' != "") {
        docReady(function () {
            var username = jQuery('#form-field-login-main-username');
            if (username.val() != "") {
                //username.attr('readonly', "");
            }
        });
    } else {
        docReady(function () {
            if (inIframe()) {
                var returnURL = '@string.Format("{0}?returnUrl={1}&uType={2}&isFrame=true", LinkHelper.GetItemUrl(SitecoreItemIdentifiers.J7_UAE_ID_LOGIN), LinkHelper.GetItemUrl(SitecoreItemIdentifiers.UNIVERSAL_SERVICE_CENTRE), SiteEnumHelper.UAEPassuser.careerportal)';
                jQuery(".uaepassreturnurl").attr("href", returnURL);
                jQuery(".uaepassreturnurl").attr("target", "_top");
            }
            function inIframe() {
                try {
                    return window.self !== window.top;
                } catch (e) {
                    return true;
                }
            }


            $('#createAcc').click(function () {
                var qVal = '@_serviceType';

                if (qVal == '') {
                    var error = 0;

                    $("#LoginForm").find('.form-field__input').not(':hidden').each(function () {

                        jQuery('#form-field-z198vv0ad').parsley().validate();
                        if (!jQuery('#form-field-z198vv0ad').parsley().isValid()) {
                            error++;
                        }


                    });

                    if (error == 0) {

                        var ddVal = $("#form-field-z198vv0ad").val();

                        if (ddVal == 'S') {
                            window.location.href = '@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.MISCELLANEOUS_USER_REGISTRATION)' + '?t=' + '@Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(MasarConfig.ScrapType))';

                        }
                        else {
                            window.location.href = '@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.MISCELLANEOUS_USER_REGISTRATION)' + '?t=' + '@Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(MasarConfig.MiscellaneousType))';

                        }

                    }
                }
                else {
                    var redirectUrl = '@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.MISCELLANEOUS_USER_REGISTRATION)' + '?t=' + qVal;

                    window.location.href = redirectUrl;
                }


            });


            $('#_forgotUser').click(function () {
                var qVal = '@_serviceType';

                if (qVal == '') {
                    var error = 0;

                    $("#LoginForm").find('.form-field__input').not(':hidden').each(function () {

                        jQuery('#form-field-z198vv0ad').parsley().validate();
                        if (!jQuery('#form-field-z198vv0ad').parsley().isValid()) {
                            error++;
                        }


                    });

                    if (error == 0) {

                        var ddVal = $("#form-field-z198vv0ad").val();

                        if (ddVal == 'S') {
                            window.location.href = '@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.SCRAPESALE_FORGET_USERNAME)' + '?t=' + '@Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(MasarConfig.ScrapType))';

                        }
                        else {
                            window.location.href = '@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.SCRAPESALE_FORGET_USERNAME)' + '?t=' + '@Convert.ToBase64String(System.Text.Encoding.UTF8.GetBytes(MasarConfig.MiscellaneousType))';

                        }

                    }
                }
                else {
                    var redirectUrl = '@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.SCRAPESALE_FORGET_USERNAME)' + '?t=' + qVal;

                    window.location.href = redirectUrl;
                }


            });


            setTimeout(function () {

                try {
                    var uid = readCookie("jid");
                    if (uid != null && uid != undefined && uid != "") {
                        jQuery("#form-field-login-main-username").val(window.atob(uid));
                        jQuery("#rememberme").prop("checked", true);
                    }

                } catch (e) {
                }

                jQuery("#jobseekerForm").submit(function () {
                    try {
                        var isRemember = jQuery("#rememberme").prop("checked");
                        if (isRemember) {
                            var v = jQuery("#form-field-login-main-username").val();
                            if (v != null && v != undefined && v != "") {
                                createCookie("jid", window.btoa(v), 7);
                            }
                        } else {
                            eraseCookie("jid");
                        }
                    } catch (e) {
                    }
                    return true;
                })

            }, 100);
        });

    }
</script>
<script src="~/scripts/External/nml/form-submit-validate.js"></script>