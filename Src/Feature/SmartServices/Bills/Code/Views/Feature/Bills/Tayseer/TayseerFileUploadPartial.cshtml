@model DEWAXP.Feature.Bills.Models.Tayseer.TayseerFileUploadDetail
@using Sitecore.Globalization
@using DEWAXP.Foundation.Helpers
@using DEWAXP.Foundation.Content

@{
   
    var lang = Sitecore.Context.Language.CultureInfo.TextInfo.IsRightToLeft ? "ar" : "en";
}

@if (ViewBag.Message != null)
{
    <div class="j102-tayseer-service" data-journey="j102-tayseer-service">
        <div class="m39-modal language-switch" data-component="m39-modal" id="modal_true">
            <div data-content="true" id="idfileValidation" class="m39-modal__container" role="dialog" aria-expanded="false">
                <div class="m39-modal__dialog">
                    <div class="m39-modal__header">
                        <div class="m39-modal__title">@Translate.Text("Tayseer")</div>
                    </div>
                    <div class="m39-modal__content" style="top:40px;">
                        <div> @ViewBag.Message</div>
                        <div class="button m39-m12-no" id="btnClose" style="margin-top:40px;">@Translate.Text("Close")</div>
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            // ViewBag.Message Validation Message.
            $("#idfileValidation").addClass('m39-modal__container--active');
            $('.mask').addClass('mask-show');
            $('body').addClass('unscrollable').css('position', 'static')
            $('.m39-m12-no').on('click', function () {
                $("#idfileValidation").removeClass('m39-modal__container--active')
                $('body').removeClass('unscrollable').css('position', 'initial')
                $('.mask').removeClass('mask-show');
            });
            $('#btnClose').on('click', function () {
                var _validateCheck = '@ViewBag.RedirectError';
                if (_validateCheck == '1')
                    window.location.reload();
            });
        </script>
    </div>

}

@if (ViewBag.ValidationMsg != null)
{
    <ul class="parsley-errors-list filled" id="parsley-id"><li class="parsley-required">@ViewBag.ValidationMsg</li></ul>
}
@if (ViewBag.Errorlist != null)
{
    <div class="j102-tayseer-service" data-journey="j102-tayseer-service">
        <div class="grid">
            <div class="grid__row mb12">
                <div class="grid__column grid__column--12 grid__column--form">
                    <span class="form-field__label" style="color:Red;">@Translate.Text("Correct Excel")</span>
                    <div class="pagination-container" style="text-align:center"><ul id="pagin" class="pagin pagination"></ul></div>
                    <table class="m23-table__content-table" cellspacing="0" rules="all" border="1" id="tblErrorlist" style="border-collapse:collapse;">
                        <tbody>
                            <tr>
                                <th class="m23-table__content-table-row m23-table__content-table-cell--header" scope="col">@Translate.Text("Line Number")</th>
                                <th class="m23-table__content-table-row m23-table__content-table-cell--header" scope="col">@Translate.Text("Account Number")</th>
                                <th class="m23-table__content-table-row m23-table__content-table-cell--header" scope="col">@Translate.Text("Error")</th>
                            </tr>
                            @foreach (var data in ViewBag.Errorlist)
                            {
                                <tr class="line-content">
                                    <td class="m23-table__content-table-cell">
                                        <span id="tblErrorlist_lblLineNo_0" class="form-field__label">@data.LineNo</span>
                                    </td>
                                    <td class="m23-table__content-table-cell">
                                        <span id="tblErrorlist_lblLineNo_0" class="form-field__label">@data.Data</span>
                                    </td>
                                    <td class="m23-table__content-table-cell">
                                        <span id="tblErrorlist_lblData_0" class="form-field__label" style="color:Red;"></span>
                                        <span id="tblErrorlist_lblError_0" class="form-field__label">@data.Error</span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <div class="pagination-container mt12" style="text-align:center"><ul id="pagin" class="pagin pagination"></ul></div>
                </div>
            </div>
            <div class="grid__row mt12">
                <div class="grid__column grid__column--12 grid__column--form grid__column--centered">
                    <a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.TAYSEER_PAYMENT_FILE_UPLOAD)" role="button" class="button button--primary button--back">@Translate.Text("Back")</a>
                </div>
            </div>
        </div>
    </div>
    <script>
        //Error Table Pagination
        $(function () {

            //Pagination

            pageSize = @Translate.Text("PageSize");
            var pageCount = $(".line-content").length / pageSize;

            for (var i = 0 ; i < pageCount; i++) {
                if(pageCount > 1){
                    if(i == 0){
                        $(".pagin").append('<li class="active"><a href="#" onclick="return false;">' + (i + 1) + '</a></li> ');
                    }
                    else{
                        $(".pagin").append('<li><a href="#" onclick="return false;">' + (i + 1) + '</a></li> ');
                    }
                }
            }
            $(".pagin li").first().find("li").addClass("active")
            showPage = function (page) {
                $(".line-content").hide();
                $(".line-content").each(function (n) {
                    if (n >= pageSize * (page - 1) && n < pageSize * page)
                        $(this).show();
                });
            }

            showPage(1);

            $(".pagin li a").click(function () {
                var _this = this;

                $(".pagin li").removeClass("active");
                $(".pagin li a").each(function () {
                    if ($(this).html() == $(_this).html()) {
                        $(this).parent().addClass("active");
                    }
                })
                //$(this).parent().addClass("active");
                showPage(parseInt($(this).text()))
            });

            //    try {
            //        var totalRows = $('#tblErrorlist').find('tbody tr:has(td)').length;
            //        var recordPerPage = 20;
            //        var totalPages = Math.ceil(totalRows / recordPerPage);
            //        var $pagesbefore = $('<div id="pagesbefore"></div>');
            //        var $pagesafter = $('<div id="pagesafter"></div>');
            //        for (i = 0; i < totalPages; i++) {
            //            $('<span class="pageNumber">&nbsp;' + (i + 1) + '</span>').appendTo($pagesbefore);
            //            $('<span class="pageNumber">&nbsp;' + (i + 1) + '</span>').appendTo($pagesafter);
            //        }

            //        $pagesbefore.insertBefore('#tblErrorlist');
            //        $pagesafter.appendTo('#tblErrorlist');

            //        $('.pageNumber').hover(
            //          function () {
            //              $(this).addClass('focus');
            //          },
            //          function () {
            //              $(this).removeClass('focus');
            //          }
            //        );

            //        $('table').find('tbody tr:has(td)').hide();
            //        var tr = $('table tbody tr:has(td)');
            //        for (var i = 0; i <= recordPerPage - 1; i++) {
            //            $(tr[i]).show();
            //        }
            //        $('span').click(function (event) {
            //            $('#tblErrorlist').find('tbody tr:has(td)').hide();
            //            var nBegin = ($(this).text() - 1) * recordPerPage;
            //            var nEnd = $(this).text() * recordPerPage - 1;
            //            for (var i = nBegin; i <= nEnd; i++) {
            //                $(tr[i]).show();
            //            }
            //        });
            //    } catch (e) {

            //    }
        });
    </script>
    <style>
        .focus {
            background-color: #ff00ff;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
        }

        .pageNumber {
            padding: 2px;
        }

        .current {
            color: green;
        }

        ul.pagination li a {
            border: 0px solid #ddd;
        }

        .pagin li a {
            color: black;
            float: left;
            padding: 5px 7px;
            text-decoration: none;
            font-weight: bold;
            /*transition: background-color 0.3s;*/
            /*border: 1px solid #ddd;*/
        }

        .pagination-container .active a {
            /*background-color: #4CAF50;*/
            color: #007560 !important;
            font-weight: bold;
            /*border: 1px solid #4CAF50;*/
        }

        .pagin li {
            display: inline-block;
        }
    </style>
}
@if (ViewBag.SuccessData != null)
{
    <input type="hidden" name="hdndeleteacc" id="hdndeleteacc" value="" />
    <div class="grid__row mt24" style="display:none" id="divTableMessageFD">
        <div class="grid__column grid__column--12 grid__column--form">
            <div class="m40-status-message m40-status-message--error icon icon-caution" data-component="m40-status-message">
                <div class="m40-status-message__title">@Sitecore.Globalization.Translate.Text(DictionaryKeys.Global.SubmissionError)</div>
                <div class="m40-status-message__text" id="divErrortextmsgFD"></div>
            </div>
        </div>
    </div>
    <div class="j102-tayseer-service" data-journey="j102-tayseer-service">
        <div class="grid">
            <div class="grid__row">
                <div class="j102-tayseer-add-account-wrapper">
                    <div class="grid__column grid__column--12 grid__column--form">
                        <button role="button" class="j102-tayseer-service--add button mb12" id="idAddAccount"><strong>+</strong>@Translate.Text("Add Account")</button>
                        <div class="j102-tayseer-service--add-form" id="divAddAcoount" style="display:none;">
                            <form method="get" class="form" data-form="true" action="#">
                                <div class="form-field form-field--text">
                                    <label for="form-field-ts1d5o820" class="form-field__label">
                                        @Translate.Text("Contract Account")
                                        <span class="form-field__label-required aria-only">(required)</span>
                                    </label>
                                    <span class="form-field__input-wrapper">
                                        <input class="form-field__input form-field__input--text"
                                               id="form-field-ts1d5o820"
                                               name="j102-tayseer-service-add"
                                               type="number"
                                               maxlength="10"
                                               onkeypress="return isNumeric(event)"
                                               oninput="maxLengthCheck(this)"
                                               placeholder="@Translate.Text("ContractAccountTextbox")"
                                               aria-describedby="description-for-ts1d5o820"
                                               data-parsley-errors-container="#description-for-ts1d5o820"
                                               required
                                               data-parsley-required-message="@Translate.Text("required validation message")"
                                               lang="en" />
                                    </span>
                                    <div id="description-for-ts1d5o820" class="form-field__messages">
                                    </div>
                                </div>
                                <div class="form-field form-field--text ">
                                    <label for="form-field-amounttopay" class="form-field__label">
                                        @Translate.Text("Amount to Pay")
                                        <span class="form-field__label-required aria-only">(required)</span>
                                    </label>
                                    <span class="form-field__input-wrapper">
                                        <input class="form-field__input form-field__input--text"
                                               id="form-field-amounttopay"
                                               name="j102-tayseer-service-add-amounttopay"
                                               maxlength="12"
                                               type="text"
                                               onfocusout="roundTo(this)"
                                               onkeypress="return isNumeric(event)"
                                               oninput="maxLengthCheck(this)"
                                               placeholder="@Translate.Text("AmounttoPayTextbox")"
                                               aria-describedby="description-for-amounttopay"
                                               data-parsley-errors-container="#description-for-amounttopay"
                                               required
                                               data-parsley-required-message="@Translate.Text("required validation message")"
                                               lang="en" />
                                    </span>
                                    <div id="description-for-amounttopay" class="form-field__messages">
                                    </div>
                                </div>
                                <div class="form-field__button">
                                </div>
                            </form>
                            <div class="j102-tayseer-service--add-form-buttons" style="margin-top:20px">
                                <input type="button" class="button button--primary button--small" id="idAddnewaccount" href="javascript:void(0)" value="@Translate.Text("Add")" />
                                <input type="button" class="button button--small j102-tayseer-service--add-form-cancel" id="idCancelnewaccount" href="javascript:void(0)" value="@Translate.Text("Cancel")" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid__row">
                <div class="grid__column grid__column--12 grid__column--form">
                    <div class="j102-tayseer-service-account-head">
                        <div class="head-numbers hidden" id="divTotal">
                        </div>
                        <div class="head-actions" style="min-height: 16px;">
                            <span class="total-page">@Translate.Text("Page") <span class="total-page-num">1</span> @Translate.Text("of") <span class="total-page-of-num">2</span></span>
                            <button role="button" type="button" class="link j102-tayseer-service--select mb24" id="idDeselectAll">@Translate.Text("Deselect All")</button>
                        </div>
                    </div>
                    @*<div class="pagination-container" style="text-align:center"><ul id="pagin" class="pagin pagination"></ul></div>*@
                    <div class="m49-list-filter" data-component="m49-list-filter" data-filter-list="[name='history-line-content']">
                        <input class="m49-list-filter--input" id="m49-list-filter--input" style="position:absolute" name="m49-list-filter--input" placeholder="@Translate.Text("Search by account number")" pattern="\d*" maxlength="20" type="text" data-parsley-maxnumber="20">
                        <button class="m49-list-filter-reset-button hidden mt0" title="@Translate.Text("Clear Filter")" type="button" aria-label="@Translate.Text("Clear Filter")"> <span class="aria-only">Filter</span></button>
                        <button class="m49-list-filter--button" title="@Translate.Text("Filter Results")" type="button" role="search" id="btnSearch" aria-label="@Translate.Text("Filter Results")"><span class="aria-only">Filter</span></button>
                    </div>
                    <div class="form-field form-field--toggles" name="history-line-content">
                        <fieldset class="fieldset">
                            @foreach (var data in ViewBag.SuccessData)
                            {
                                <div class="form-field__checkbox j102-tayseer-service--chckbx  line-content" data-id="@(data.ContractAccountNo)">
                                    <label>
                                        @if (@data.isSelected)
                                        {
                                            <input class="form-field__input form-field__input--checkbox accountchecked"
                                                   aria-describedby="description-for-"
                                                   data-parsley-errors-container="#description-for-"
                                                   type="checkbox"
                                                   name="chkSelect"
                                                   data-contractaccount="@data.ContractAccountNo"
                                                   checked="checked">
                                        }
                                        else
                                        {
                                            <input class="form-field__input form-field__input--checkbox accountchecked"
                                                   aria-describedby="description-for-"
                                                   data-parsley-errors-container="#description-for-"
                                                   type="checkbox"
                                                   name="chkSelect"
                                                   data-contractaccount="@data.ContractAccountNo">
                                        }
                                        <div class="form-field__fakecheckbox form-field__fakecheckbox--right focus-enabled">
                                            <div class="j102-tayseer-service--acc-num contractaccount">@Translate.Text("Contract Account"): <span data-acc-detail="acc_number">@data.ContractAccountNo</span></div>
                                            <div class="j102-tayseer-service--out-amount">@Translate.Text("Outstanding Amount"): <span class="j102-tayseer-service--outstanding">@data.OutstandingAmount</span> @Translate.Text("Currency")</div>
                                        </div>
                                    </label>
                                    <div class="j102-tayseer-service--custom-pay">
                                        <div class="j102-tayseer-service--pay-amount">@Translate.Text("Amount to Pay"): <span class="j102-tayseer-service--amount spanamount topay" id="idspanamount_@data.ContractAccountNo">@data.AmounttoPay</span> <span class="topay">@Translate.Text("Currency")</span></div>
                                        <div class="j102-tayseer-service--custom-pay-buttons">
                                            @*<a class="j102-tayseer-en-service--delete-amount lnkDeleteConfirm" data-contractaccount="@data.ContractAccountNo">@Translate.Text("Delete account")</a>*@
                                            <a class="j102-tayseer-en-service--edit-amount btnEditFileupload" data-cotractaccount="@data.ContractAccountNo">@Translate.Text("Edit amount")</a>
                                        </div>
                                    </div>
                                    <div class="j102-tayseer-service--amount-edit-wrapper active">
                                        <div class="j102-tayseer-service--amount-pay-form" id="divfileuploadaccount_@data.ContractAccountNo">
                                            <fieldset class="fieldset">
                                                <legend class="legend-color">.</legend>
                                                @*<div id="divSetAmount" style="display:none">*@
                                                <div class="j102-tayseer-service--amount-pay-form-input">
                                                    <form method="get" class="form" data-form="true" action="#">
                                                        <div class="form-field form-field--text ">
                                                            <label for="form-field-@data.ContractAccountNo" class="form-field__label">
                                                                @Translate.Text("Set Amount")
                                                                <span class="form-field__label-required aria-only">(required)</span>
                                                            </label>
                                                            <span class="form-field__input-wrapper form-field__input-wrapper--prefixed form-field__input-wrapper--currency">
                                                                <input class="form-field__input form-field__input--text form-field__input--prefixed txtAmountPay"
                                                                       id="form-field-@data.ContractAccountNo"
                                                                       data-cotractaccount="@data.ContractAccountNo"
                                                                       name="number-currency"
                                                                       maxlength="12"
                                                                       type="number"
                                                                       onfocusout="roundTo(this)"
                                                                       onkeypress="return isNumeric(event)"
                                                                       oninput="maxLengthCheck(this)"
                                                                       placeholder="@Translate.Text("Maximum Amount Allowed: 999,999,999.99")"
                                                                       aria-describedby="description-for-@data.ContractAccountNo"
                                                                       data-parsley-errors-container="#description-for-@data.ContractAccountNo"
                                                                       data-parsley-required="required"
                                                                       data-parsley-required-message="This field is required"
                                                                       data-parsley-currency=""
                                                                       data-parsley-trigger="focusout"
                                                                       data-parsley-currency-message="Please enter a valid monetary value"
                                                                       value="@data.AmounttoPay"
                                                                       data-parsley-range-message
                                                                       data-parsley-max="@PaymentConstants.MaximumAllowedPaymentAmount"
                                                                       lang="en" />
                                                            </span>
                                                            <div id="description-for-@data.ContractAccountNo" class="form-field__messages">
                                                            </div>
                                                        </div>
                                                        <div class="form-field__button">
                                                        </div>
                                                        <div style="display:none">
                                                            <input class="hidden txtAmountPayCopy" style="display:none"
                                                                   id="form-field-copy-@data.ContractAccountNo"
                                                                   data-cotractaccount="@data.ContractAccountNo"
                                                                   name="number-currency-copy"
                                                                   maxlength="12"
                                                                   type="number"
                                                                   placeholder="@Translate.Text("Maximum Amount Allowed: 999,999,999.99")"
                                                                   aria-describedby="description-for-copy-@data.ContractAccountNo"
                                                                   data-parsley-errors-container="#description-for-copy-@data.ContractAccountNo"
                                                                   value="@data.AmounttoPay"
                                                                   data-parsley-range-message
                                                                   data-parsley-max="@PaymentConstants.MaximumAllowedPaymentAmount"
                                                                   lang="en" />
                                                            <div id="description-for-copy-@data.ContractAccountNo" class="form-field__messages hidden">
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="edit-cancel">
                                                    <a class="button button--text idCancelFileupload" data-cotractaccount="@data.ContractAccountNo" role="button" aria-label="Cancel">@Translate.Text("Cancel")</a>
                                                </div>
                                                <div class="edit-set">
                                                    <a class="button button--text lnkSaveFU" data-cotractaccount="@data.ContractAccountNo" role="button">@Translate.Text("Set")</a>
                                                </div>
                                                @*  </div>*@
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                                @*<div class="line-content">
                                        <div class="j102-tayseer-service--acc">
                                                <span class="j102-tayseer-service--acc-num contractaccount">@Translate.Text("Contract Account"): @data.ContractAccountNo</span>
                                                <p class="j102-tayseer-service--out-amount">@Translate.Text("Outstanding Amount"): <span class="j102-tayseer-service--outstanding">@data.OutstandingAmount</span> @Translate.Text("Currency")</p>

                                                <p class="j102-tayseer-service--amount-pay">@Translate.Text("Amount to Pay"): <span class="j102-tayseer-service--amount spanamount" id="idspanamount_@data.ContractAccountNo">@data.AmounttoPay</span> @Translate.Text("Currency")</p>
                                                <a role="button" class="button button--text j102-tayseer-service--edit-amount btnEditFileupload" data-cotractaccount="@data.ContractAccountNo">@Translate.Text("Edit amount")</a>
                                            </div>
                                    </div>*@
                            }
                        </fieldset>
                        <div class="m49-no-matches hidden">@Translate.Text("M43.NoMatchesFound")</div>
                    </div>
                    @*<div class="j102-tayseer-service--total-wrapper">@Translate.Text("Total Amount"): <span class="j102-tayseer-service--total-pay">@ViewBag.GrandTotal</span> @Translate.Text("Currency")</div>*@
                    <div class="pagination-container mt12" style="text-align:center;border-top: 1px solid;color:#BCBEC0;padding-top:16px;"><ul id="pagin" class="pagin pagination"></ul></div>
                    <div class="j102-tayseer-service-account-head">
                        <div class="head-numbers hidden" id="divTotalBottom">
                        </div>
                    </div>
                </div>

            </div>
            <div class="grid__row">
                <div class="grid__column grid__column--12 grid__column--form grid__column--centered">
                    <input type="button" class="button button--primary lnkPaymentReviewFU" value="@Translate.Text("Review Payment")" />
                </div>
            </div>
        </div>

    </div>

    <input type="hidden" id="hdnreviewUrlupload" value="@ViewBag.ReviewUploadURL" />
    @*<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>*@
    <script type="text/javascript">
        $.fn.digits = function () {
            return this.each(function () {
                $(this).text($(this).text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));
            })
        }

        function maxLengthCheck(object) {
            //object.value = object.value.match(/^\d+\.?\d{0,2}/);
            if (object.value.length > object.maxLength)
                object.value = object.value.slice(0, object.maxLength);
        }

        function isNumeric(evt) {

            var theEvent = evt || window.event;
            //console.log(theEvent.keyCode);
            var key = theEvent.keyCode || theEvent.which;
            key = String.fromCharCode(key);
            // var regex = /[0-9]|\./;
            var regex = /^[0-9]*(\.[0-9]{0,2})?$/;
            if (!regex.test(key)) {
                theEvent.returnValue = false;
                if (theEvent.preventDefault) theEvent.preventDefault();
            }
        }
        function roundTo(x) {
            num = x.value.toString();
            var value = Number(num);
            var res = num.split(".");
            if (num.indexOf('.') === -1) {
                value = value.toFixed(2);
                num = value.toString();
            } else if (res[1].length >= 3) {
                value = value.toFixed(2);
                num = value.toString();
            }
          //  console.log(num);
            x.value = num;
        }

        // Function for number format with decimal and , seperates.
        function number_format(number, decimals, dec_point, thousands_sep) {
            var n = !isFinite(+number) ? 0 : +number, 
            prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
            sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
            dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
            toFixedFix = function (n, prec) {
                // Fix for IE parseFloat(0.55).toFixed(0) = 0;
                var k = Math.pow(10, prec);
                return Math.round(n * k) / k;
            },
            s = (prec ? toFixedFix(n, prec) : Math.round(n)).toString().split('.');
            if (s[0].length > 3) {
                s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
            }
            if ((s[1] || '').length < prec) {
                s[1] = s[1] || '';
                s[1] += new Array(prec - s[1].length + 1).join('0');
            }
            return s.join(dec);
        }

        $(function () {

            var select = true;
            $("#idAddAccount").on("click", function (e) {
                $("#divAddAcoount").css('display', 'inline');
            });
            // Cancel Button
            $(document).on('click', '#idCancelnewaccount', function (e) {
                $("#divAddAcoount").css('display', 'none');
                $("#form-field-ts1d5o820").val('');
                $("#form-field-amounttopay").val('');
                $("#divgriderrormsg").css('display', 'none');
            });
            $(".lnkPaymentReviewFU").attr("disabled", false);

            $('.btnEditFileupload').on('click', function (e) {
                e.preventDefault();
                var contractAcc = $(this).data("cotractaccount");
                $("#divfileuploadaccount_" + contractAcc).css('display', 'inline');
            });

            $(document).on('click', '.idCancelFileupload', function (e) {
                e.preventDefault();
                var contractAcc = $(this).data("cotractaccount");
                var _sval = $('#form-field-copy-' + contractAcc).val();
                if (_sval != undefined && _sval != '') {
                    $("#form-field-" + contractAcc).val(_sval);
                }

                $("#divfileuploadaccount_" + contractAcc).css('display', 'none');
            });

            // Save Button
            $(document).on('click', '.lnkSaveFU', function (e) {
                try {
                    e.preventDefault();
                    var contractAcc = $(this).data("cotractaccount"),
                        amounttoPay = $("#form-field-" + contractAcc).val();
                    $('#form-field-copy-' + contractAcc).val(amounttoPay);
                    var data = { ContractAccountNo: contractAcc, AmounttoPay: amounttoPay }

                    $.ajax({
                        type: "POST",
                        url: "/api/sitecore/Tayseer/TayseerEditRow",
                        data: AddForgeryToken(data,"projectdocument-details"),
                        cache: false,
                        success: function (response) {
                            try {
                                if (response.status == true) {
                                    $("#description-for-" + contractAcc).html('');
                                    $("#divTotal").html(response.Data);
                                    $("#divTotalBottom").html(response.Data);
                                    $("#idspanamount_" + contractAcc).text(number_format(amounttoPay.toString(),2));
                                    $("#divfileuploadaccount_" + contractAcc).css('display', 'none');
                                }
                                else {
                                  //  $("#idspanamount_" + contractAcc).text(amounttoPay);
                                    $("#description-for-" + contractAcc).html(response.Message);
                                }
                            } catch (e) {

                            }
                        },
                        error: function (error) {
                            //console.log("Error:" + error);
                        }
                    });
                } catch (e) {
                }
            });

            // Delete Button
            //$('.lnkDeleteConfirm').on('click', function (e) {
            //    $("#hdndeleteacc").val('');
            //    jQuery('.lnkHiddenDelete').trigger('click');
            //    var contractAcc = $(this).data("contractaccount");
            //    $("#hdndeleteacc").val(contractAcc);
            //});

            $(document).on('click', '.lnkDeleteFU', function (e) {
                try {
                    var contractAcc = $("#hdndeleteacc").val();

                    var url = "/api/sitecore/Tayseer/TayseerDeleteRow";
                    $.ajax({
                        type: "POST",
                        url: url,
                        data: AddForgeryToken({ ContractAccountNo: contractAcc },"projectdocument-details"),
                        cache: false,
                        success: function (response) {
                            $("#divfileupload").html(response);
                        }
                    });
                    //$.get(url, { ContractAccountNo: contractAcc }, function (response) {
                    //    $("#divfileupload").html(response);
                    //});
                } catch (e) {
                }
            });

            // Deselect All

            $(document).on('click', '#idDeselectAll', function (e) {
                var ele = $("#divfileupload").find('input:checkbox');
                if (select == true) {
                    ele.prop('checked', false);
                    $("#idDeselectAll").text("@Translate.Text("Select All")");
                    $(".total-ac-num").text('0');
                    select = false;
                } else {
                    ele.prop('checked', true);
                    $("#idDeselectAll").text("@Translate.Text("Deselect All")");
                    $(".total-ac-num").text(ele.length);
                    select = true;
                }

                var data = { AccountCheck: ele.is(':checked') };
                $.ajax({
                    type: "POST",
                    url: "/api/sitecore/Tayseer/TayseerUploadAccountcheckedAll",
                    data: AddForgeryToken(data, "projectdocument-details"),
                    cache: false,
                    success: function (response) {
                        if (response.status == true) {
                            $("#divTotal").html(response.Data);
                            $("#divTotalBottom").html(response.Data);
                        }
                        else {
                            //console.log(response);
                        }
                    },
                    error: function (error) {
                        //console.log("Error: " + error);
                    }
                });
            });

            $(".accountchecked").on("click", function (e) {
                var contractAcc = $(this).data("contractaccount"),
                    isChecked = $(this).is(':checked'),
                    data = { ContractAccount: contractAcc, AccountCheck: isChecked };

                $.ajax({
                    type: "POST",
                    url: "/api/sitecore/Tayseer/TayseerUploadAccountchecked",
                    data: AddForgeryToken(data, "projectdocument-details"),
                    cache: false,
                    success: function (response) {
                        if (response.status == true) {
                            $("#divTotal").html(response.Data);
                            $("#divTotalBottom").html(response.Data);
                        }
                        else {
                            //console.log(response);
                        }
                    },
                    error: function (error) {
                        //console.log("Error: " + error);
                    }
                })
            });

            // Add new account
            $("#idAddnewaccount").attr("disabled", false);
            $("#idAddnewaccount").on("click", function (e) {
                try {
                    var data,
                        contractAcc = $("#form-field-ts1d5o820").val(),
                        amounttoPay = $("#form-field-amounttopay").val();

                    var ischecked = [];
                    $('#divfileupload input:checked').each(function () {
                        ischecked.push($(this).data("contractaccount"));
                    });
                    ischecked.push(contractAcc);

                    data = { ContractAccountNo: contractAcc, AmounttoPay: amounttoPay, selectedAccount: ischecked.join() }

                    $("#idAddnewaccount").attr("disabled", true);
                    $("#idAddnewaccount").attr("disabled", true).val("@Translate.Text("Adding")...");

                    $.ajax({
                        type: "POST",
                        url: "/api/sitecore/Tayseer/TayseerAddAccountFileUploadTable",
                        data: AddForgeryToken(data, "projectdocument-details"),
                        cache: false,
                        success: function (response) {
                            $("#divfileupload").html(response);
                            $("#form-field-ts1d5o820").val('');
                            $("#form-field-amounttopay").val('');
                            $("#idAddnewaccount").attr("disabled", false);
                            $(".total-ac-num").text($("#divfileupload").find('input:checkbox:checked').length);
                            $("#idspanamount_" + contractAcc).text(number_format(amounttoPay.toString(), 2));

                        },
                        error: function (error) {

                            //console.log("Error: " + error);
                            $("#idAddnewaccount").attr("disabled", false);
                        }
                    });
                } catch (e) {
                }
            });


            // Payment Review Button Click
            $(document).on('click', '.lnkPaymentReviewFU', function (e) {
                try {
                    e.preventDefault();
                    var _selectTab = "fileUploadTab",
                    data = { selectedTab: _selectTab }

                    $(".lnkPaymentReviewFU").attr("disabled", true);
                    $(".lnkPaymentReviewFU").attr("disabled", true).val("@Translate.Text("Submitting")...");

                    $.ajax({
                        type: "POST",
                        url: "/api/sitecore/Tayseer/TayseerReviewPaymentClick",
                        data:AddForgeryToken(data,"projectdocument-details") ,
                        cache: false,
                        beforeSend: function () {
                            jQuery('.j105-drrg--loader').show();
                            jQuery('.j105-drrg--loader').css('top', $(window).scrollTop());
                            $('body').removeClass('unscrollable').addClass('unscrollable');
                        },
                        complete: function () {
                            jQuery('.j105-drrg--loader').hide();
                            $('body').removeClass('unscrollable');
                        },
                        success: function (response) {
                            try {
                                $("#hdnreviewUrlupload").val('@ViewBag.ReviewUploadURL');
                                var _url = $("#hdnreviewUrlupload").val();
                                if (response.status == true) {
                                    var _langcheck = '@lang';

                                    if (_langcheck == "ar") {
                                        location.href = "/ar-AE/consumer/billing/tayseer/tayseer-review-payment-upload";
                                    }
                                    else {
                                        location.href = "/en/consumer/billing/tayseer/tayseer-review-payment-upload";
                                    }
                                    // location.href = _url;
                                    //console.log(_url);
                                }
                                else {
                                    $("#divTableMessageFD").show();
                                    $("#divErrortextmsgFD").html(response.Message);
                                    $(window).scrollTop($('#divTableMessageFD').offset().top - 200);
                                    $(".lnkPaymentReviewFU").attr("disabled", false);
                                    $(".lnkPaymentReviewFU").val("@Translate.Text("Review Payment")");
                                }

                            } catch (e) {
                                $(".lnkPaymentReviewFU").attr("disabled", false);
                                $(".lnkPaymentReviewFU").val("@Translate.Text("Review Payment")");
                            }
                        },
                        error: function (error) {
                            //console.log("Error:" + error);
                        }
                    });
                } catch (e) {
                }
            });

            var DeleteRow = function () {

                $.ajax({
                    type: "POST",
                    url: "/api/sitecore/Tayseer/TayseerDeleteRow",
                    data: AddForgeryToken("","projectdocument-details"),
                    contentType: false,
                    processData: false,
                    cache: false,
                    success: function (response) {
                        alert("success");
                    },
                    error: function (error) {
                        alert("errror");
                    }
                });
            }


            //Pagination
            var pageSize = @Translate.Text("PageSize");
            var pageCount = $(".line-content").length / pageSize;

            $(".total-page-of-num").html(Math.ceil(pageCount));
            jQuery('.m49-list-filter--input').on('keypress', function (e) {
                if (e.charCode == 13) {
                    jQuery('.m49-list-filter-reset-button').removeClass('hidden');
                    jQuery('.m49-list-filter--button').click();
                }
            });

            jQuery('.m49-list-filter--button').on('click', function (e) {
                jQuery('.m49-list-filter-reset-button').removeClass('hidden');
                setTimeout(function () {
                    setSearchPagination();
                }, 700);

            });

            jQuery('.m49-list-filter-reset-button').on('click', function (e) {
                //debugger;
                jQuery('.j102-tayseer-service--chckbx').removeClass('line-search-content');
                if (!(jQuery('.m49-list-filter-reset-button').hasClass('hidden'))) {

                    jQuery('.m49-list-filter-reset-button').addClass('hidden');
                }
                jQuery("#m49-list-filter--input").val('');
                setTimeout(function () {
                    pageCount = $(".line-content").length / pageSize;
                    $(".total-page-of-num").html(Math.ceil(pageCount));
                    $(".pagin").html('');
                    setPagination();
                    $(".total-page-num").html(1);
                }, 400);
            });
            setPagination();
            function setSearchPagination() {
                $(".line-content:visible").each(function (n) {
                    $(this).addClass('line-search-content');
                });
                pageCount = $(".line-search-content").length / pageSize;
                if (pageCount > 1) {
                    // $(".head-actions").show();
                    $('.total-page').show();
                    $('#idDeselectAll').show();
                }
                else {
                    // $(".head-actions").hide();
                    $('.total-page').hide();
                    $('#idDeselectAll').show();
                }
                $(".pagin").html('');
                $(".total-page-num").html(1);
                $(".total-page-of-num").html(Math.ceil(pageCount));
                for (var i = 0; i < pageCount; i++) {
                    if (pageCount > 1) {
                        if (i == 0) {
                            $(".pagin").append('<li class="active"><a href="#" onclick="return false;">' + (i + 1) + '</a></li> ');
                        }
                        else {
                            $(".pagin").append('<li><a href="#" onclick="return false;">' + (i + 1) + '</a></li> ');
                        }
                    }
                }
                $(".pagin li").first().find("li").addClass("active");
                showSearchPage = function (page) {
                    $(".line-search-content").hide();
                    $(".line-search-content").each(function (n) {
                        if (n >= pageSize * (page - 1) && n < pageSize * page)
                            $(this).show();
                    });
                }
                showSearchPage(1);
                $(".pagin li a").click(function () {
                    var _this = this;
                    $(".pagin li").removeClass("active");
                    $(".pagin li a").each(function () {
                        if ($(this).html() == $(_this).html()) {
                            $(this).parent().addClass("active");
                        }
                    });
                    showSearchPage(parseInt($(this).text()));
                    $(".total-page-num").html(Math.ceil($(this).text()));
                });
            }
            function setPagination() {
                if (pageCount > 1) {
                    // $(".head-actions").show();
                    $('.total-page').show();
                    $('#idDeselectAll').show();
                }
                else {
                    // $(".head-actions").hide();
                    $('.total-page').hide();
                    $('#idDeselectAll').show();
                }
                $(".total-page-of-num").html(Math.ceil(pageCount));
                for (var i = 0; i < pageCount; i++) {
                    if (pageCount > 1) {
                        if (i == 0) {
                            $(".pagin").append('<li class="active"><a href="#" onclick="return false;">' + (i + 1) + '</a></li> ');
                        }
                        else {
                            $(".pagin").append('<li><a href="#" onclick="return false;">' + (i + 1) + '</a></li> ');
                        }
                    }
                }
                $(".pagin li").first().find("li").addClass("active");
                showPage = function (page) {
                    $(".line-content").hide();
                    $(".line-content").each(function (n) {
                        if (n >= pageSize * (page - 1) && n < pageSize * page)
                            $(this).show();
                    });
                }

                showPage(1);

                $(".pagin li a").click(function () {
                    var _this = this;

                    $(".pagin li").removeClass("active");
                    $(".pagin li a").each(function () {
                        if ($(this).html() == $(_this).html()) {
                            $(this).parent().addClass("active");
                        }
                    });
                    //$(this).parent().addClass("active");
                    showPage(parseInt($(this).text()));
                    $(".total-page-num").html(Math.ceil($(this).text()));
                });
            }
            $('span.j102-tayseer-service--outstanding').digits();
            $('span.spanamount').digits();
        });
    </script>
    <style>
        .j102-tayseer-service--amount-pay-form {
            display: none;
        }

        .current {
            color: green;
        }

        .pagin li {
            display: inline-block;
        }

        ul.pagination li a {
            border: 0px solid #ddd;
        }

        .pagin li a {
            color: black;
            float: left;
            padding: 5px 7px;
            text-decoration: none;
            font-weight: bold;
            /*transition: background-color 0.3s;*/
            /*border: 1px solid #ddd;*/
        }

        .pagination-container .active a {
            /*background-color: #4CAF50;*/
            color: #007560 !important;
            font-weight: bold;
            /*border: 1px solid #4CAF50;*/
        }
    </style>
}

@if (ViewBag.SetTotal != null)
{
    <script type="text/javascript">
        //setTimeout(function(){
            //$(document).ready(function () {
            $("#divTotal").show();
        $("#divTotal").html(decodeHTMLEntities("@ViewBag.SetTotal"));

        $("#divTotalBottom").show();
        $("#divTotalBottom").html(decodeHTMLEntities("@ViewBag.SetTotal"));
       // },1000);



        // Set Total replace applied style/
        function decodeHTMLEntities(text) {
            var entities = [
                ['amp', '&'],
                ['apos', '\''],
                ['#x27', '\''],
                ['#x2F', '/'],
                ['#39', '\''],
                ['#47', '/'],
                ['lt', '<'],
                ['gt', '>'],
                ['nbsp', ' '],
                ['quot', '"']
            ];

            for (var i = 0, max = entities.length; i < max; ++i)
                text = text.replace(new RegExp('&'+entities[i][0]+';', 'g'), entities[i][1]);

            return text;
        }
        jQuery(window).trigger('data_loaded');
    </script>
}
