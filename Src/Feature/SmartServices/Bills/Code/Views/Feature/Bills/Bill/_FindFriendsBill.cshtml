@using DEWAXP.Foundation.Helpers
@using Sitecore.Globalization
@using Sitecore.Mvc
@using Glass.Mapper.Sc.Web.Mvc
@using DEWAXP.Foundation.Content
@using Sitecore.Mvc.Configuration
@model DEWAXP.Foundation.Content.Models.Bills.FindBillModel
@{
    if (ReCaptchaHelper.Recaptchasetting())
    {
        ViewBag.SiteKey = ReCaptchaHelper.RecaptchaSiteKey();
        ViewBag.Recaptcha = true;
    }
    else
    {
        ViewBag.Recaptcha = false;
    }
}

@Html.Sitecore().Placeholder("j15/m26-page-title")

@Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")

@using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, FormMethod.Post, new { @class = "form form--inline", @id = "findAccountForm", @data_form = "true", @novalidate = string.Empty }))
{
    @Html.Sitecore().FormHandler()
    @Html.AntiForgeryToken()

    <div class="grid__row">
        <div class="grid__column grid__column--12 grid__column--form">
            @Html.Sitecore().Placeholder("j15/m38-step-tracker")
            @Html.Sitecore().Placeholder("j14/m99-intro-text")

            <fieldset>
                <legend class="legend-color">.</legend>
                <div class="form-field form-field--text ">
                    <label for="form-field-acc_number" class="form-field__label">
                        @Translate.Text("Friends account number")
                        <span class="form-field__label-required aria-only">(@Translate.Text("required"))</span>
                    </label>
                    <span class="form-field__input-wrapper">
                        <input class="form-field__input form-field__input--text" id="form-field-acc_number"
                               name="SearchCriteria"
                               type="number" lang="en"
                               placeholder="@Translate.Text("Enter friends 10 digit account number")"
                               aria-describedby="description-for-acc_number"
                               required=""
                               data-parsley-error-message="@Translate.Text("Please enter an account or premise number")"
                               data-parsley-errors-container="#description-for-acc_number"
                               data-parsley-account_premise_number="" />
                    </span>
                    <div id="description-for-acc_number" class="form-field__messages">
                        @Html.ValidationMessageFor(x => x.SearchCriteria, "", new { @class = "parsley-errors-list" })
                        <p class="form-field__helplink">
                            <a href="@LinkHelper.GetItemUrl(SitecoreItemIdentifiers.UNDERSTAND_YOUR_BILL)" class="link">@Translate.Text("Where do I find my friends account number")</a>
                        </p>
                    </div>
                </div>
            </fieldset>
            @if (Convert.ToBoolean(ViewBag.Recaptcha))
            {
                <div class="mt12">
                    <div class="g-recaptcha" id="captcha" data-callback="recaptchaCallback" data-expired-callback="recaptchaCallback" data-sitekey="@ViewBag.SiteKey"></div>
                    <span id='errorContainer' class="parsley-errors-list"></span>
                </div>
            }

            <div class="form-field__button">
                <button class="button button--primary button--submit" type="submit">@Translate.Text("Find Bill")</button>
            </div>
        </div>
    </div>
}
<script>
    docReady(function () {
        require(['parsley'], function () {
            jQuery('.button--submit').off('click.submit').on('click.submit', function (e) {
                    var captcha = recaptchaCallback();
                if (!jQuery('#findAccountForm').parsley().validate() || !captcha) {
                        e.preventDefault();
                        return false;
                    }
                    else {
                        return true;
                    }
            });
        });
    });
    function recaptchaCallback() {
        var v = grecaptcha.getResponse();
        if (v.length == 0) {
            jQuery('#errorContainer').text('@Translate.Text("FG_Capatcha_Valid")');
            return false;
        }
        else {
            jQuery('#errorContainer').text("");
            return true;
        }
    }
</script>
