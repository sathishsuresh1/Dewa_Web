@using DEWAXP.Foundation.Helpers
@using Sitecore.Globalization
@using Sitecore.Mvc
@using Sitecore.Mvc.Configuration
@model DEWAXP.Foundation.Content.Models.UpdateIBAN.UpdateIBANModel

@Html.Sitecore().Placeholder("j18/m26-page-title")

<div class="grid__row">
    <div class="grid__column grid__column--12 grid__column--form">
        @Html.Sitecore().Placeholder("j18/m38-step-tracker")
        @* @Html.Sitecore().Placeholder("j18/m14-formatted-text")*@
        @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")
    </div>
</div>
<div class="grid__row">
    <div class="grid__column grid__column--12 grid__column--form m14-richtext">
        <h2 class="centered">@Translate.Text("Review Summary")</h2>
        @*<p>By choosing the option for refunds, you are submitting your application and agreeing to the terms and conditions.</p>*@
        @Html.Sitecore().Placeholder("j18/m14-formatted-text")
    </div>
</div>
@using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, FormMethod.Post, new { @id = "confirmrefund", @data_parsley_focus = "true", @data_form = "true", @class = "form", @data_submit_validate = "enabled" }))
{
    @Html.Sitecore().FormHandler()
    @Html.AntiForgeryToken()
    @Html.HiddenFor(x => x.OtpRequestId)
    <div class="grid__row">
        <div class="grid__column grid__column--12 grid__column--form">
            <div class="m42-keyvalue">
                <dl>
                    @if (Model.SelectedIBAN == "w")
                    {
                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.firstname")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@(!string.IsNullOrWhiteSpace(Model.CustomerFirstName) ? Model.CustomerFirstName : Translate.Text("updateiban.firstnamedash"))</dd>
                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.lastname")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@(!string.IsNullOrWhiteSpace(Model.CustomerLastName) ? Model.CustomerLastName : Translate.Text("updateiban.lastnamedash"))</dd>
                    }
                    else
                    {
                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("J85.CustName")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@(!string.IsNullOrWhiteSpace(Model.CustomerName) ? Model.CustomerName : Translate.Text("updateiban.firstnamedash"))</dd>
                    }
                    @if (!string.IsNullOrWhiteSpace(Model.AccountSelected))
                    {
                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.customeraccountnumber")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.AccountSelected</dd>
                    }
                    @if (Model.SelectedIBAN == "w")
                    {
                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.refundthrough")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.RefundThrough</dd>

                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.country")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.SelectedCountrytext</dd>
                        if (!string.IsNullOrWhiteSpace(Model.SelectedStatetext))
                        {
                            <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.state")<span class="floatRight mobile-hide">:</span></dt>
                            <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.SelectedStatetext</dd>
                        }
                        if (!string.IsNullOrWhiteSpace(Model.SelectedCity))
                        {
                            <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.city")<span class="floatRight mobile-hide">:</span></dt>
                            <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.SelectedCity</dd>
                        }
                        if (!string.IsNullOrWhiteSpace(Model.SelectedCurrency))
                        {
                            <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.currency")<span class="floatRight mobile-hide">:</span></dt>
                            <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.SelectedCurrency</dd>
                        }
                    }
                    else if (Model.SelectedIBAN == "iban" || Model.SelectedIBAN == "upiban")
                    {
                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.refundthrough")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.RefundThrough</dd>

                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.ibannumber")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.IbanNumber</dd>

                    }
                    else if (Model.SelectedIBAN == "cq")
                    {
                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.refundthrough")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.RefundThrough</dd>
                    }
                    else if (Model.SelectedIBAN == "t")
                    {
                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("updateiban.refundthrough")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.RefundThrough</dd>

                        <dt class="m42-keyvalue__key m42-keyvalue__key--secondary">@Translate.Text("MoveOut.Account number")<span class="floatRight mobile-hide">:</span></dt>
                        <dd class="m42-keyvalue__value m42-keyvalue__value--secondary">@Model.transferaccount</dd>
                    }
                </dl>
            </div>
            <div class="form-field__button">
                <button type="button" id="btnConfirm" class="button--submit button button--primary button--next" data-submission-text="@Translate.Text("Submitting")...">@Translate.Text("Verify Text")</button>
            </div>
            <p class="centered"><span class="red">*</span>@Translate.Text("Moveoutreview.westernuniontext")</p>
        </div>
    </div>

    // OTP Verification modal popup
    <div class="m39-modal m39-modal--profile m39-modal--nofocus" data-component="m39-modal" id="modal_true">
        <button data-trigger="true" class="m39-modal__trigger optpopuptrigger hidden">OTP Trigger</button>
        <div data-content="true" class="m39-modal__container" role="dialog" aria-expanded="false">
            <div class="m39-modal__dialog otp">
                <div class="m39-modal__header">
                    <button data-close="true" class="m39-modal__button--close">
                        <span class="aria-only">@Translate.Text("Close")</span>
                    </button>
                </div>
                <div class="m39-modal__content flex-center">
                    <div class="otp--modalcontent">
                        <div class="otp_inputdisplay_screen hidden">
                            <img class="otp_chatcheck hidden" src="/images/chatcheck.png">
                            <img class="otp_mailcheck hidden" src="/images/mailcheck.png">
                            <div class="otp--modalcontent-title">
                                <span class="otp-title"></span>
                            </div>
                            <div class="otp--modalcontent-details">
                                <span class="otp_inputdisplay_screen_error red">
                                </span>
                            </div>
                            <div class="otp--modalcontent-text hidden">
                                @Html.Raw(Translate.Text("cust.care.info.note"))
                            </div>
                        </div>
                        <div class="otpselectionoption hidden">
                            <form class="form mt24 " data-form>
                                <div class="form-field">
                                    <span>@Translate.Text("refund.VerifyOtpSubtitle")</span>
                                    <fieldset class="fieldset">
                                        <legend class="form-field__label">
                                            <span class="form-field__label-required aria-only">.</span>
                                        </legend>
                                        <div class=" grid__column grid__column--12  grid__column--form align_left mt24 mb24">
                                            @if (!string.IsNullOrWhiteSpace(Model.MaskedEmailid))
                                            {
                                                <p class="form-field__radio">
                                                    <label>
                                                        <input class="form-field__input form-field__input--radio otp_diplay_input" id="otp_diplay_input_1" data-stype="e" name="otp_diplay_input" type="radio" value="@Model.MaskedEmailid" aria-describedby="description-for-maskedvalue" data-parsley-errors-container="#description-for-maskedvalue" data-parsley-multiple="j113_radio" data-parsley-id="26">
                                                        <span class="form-field__fakeradio focus-enabled">
                                                            @Model.MaskedEmailid
                                                        </span>
                                                        <br>
                                                    </label>
                                                </p>
                                            }
                                            @if (!string.IsNullOrWhiteSpace(Model.MaskedMobileNumber))
                                            {
                                                <p class="form-field__radio">
                                                    <label>
                                                        <input class="form-field__input form-field__input--radio otp_diplay_input" id="otp_diplay_input_2" data-stype="m" name="otp_diplay_input" type="radio" value="@Model.MaskedMobileNumber" aria-describedby="description-for-maskedvalue" data-parsley-errors-container="#description-for-maskedvalue" data-parsley-multiple="j113_radio" data-parsley-id="26">
                                                        <span dir="ltr" class="form-field__fakeradio focus-enabled">
                                                            @Model.MaskedMobileNumber
                                                        </span>
                                                        <br>
                                                    </label>
                                                </p>
                                            }

                                        </div>
                                        <div id="description-for-radio-maskedvalue" class="form-field__messages">
                                        </div>
                                    </fieldset>

                                    <div class="form-field">
                                        <a href="javascript:void(0)" class="button button--primary mt0 btn-SendOtp">@Translate.Text("cust.SendOTP")</a>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="otp_input_screen hidden">
                            <img class="otp_chatcheck hidden" src="/images/chatcheck.png">
                            <img class="otp_mailcheck hidden" src="/images/mailcheck.png">
                            <div class="otp--modalcontent-title">
                                <span class="otp-title"></span>
                            </div>
                            <div class="otp--modalcontent-details">
                                <span class="otp-message"></span>
                            </div>

                            <form class="form mt24 input-otp-textbox" data-form>
                                <div class="form-field form-field--otp centered">
                                    <span class="form-field__input-wrapper_otp">
                                        <input class="form-field__input form-field__input--otp"
                                               id="form-field-otpnumber" name="text" type="number"
                                               aria-describedby="description-for-otpnumber"
                                               data-parsley-maxnumber="1"
                                               data-parsley-errors-container="#description-for-mobiotpnumber"
                                               required="" autofocus=""
                                               data-parsley-required-message="@Translate.Text("cust.required.field")"
                                               data-parsley-trigger="focusout" data-parsley-id="6"
                                               aria-invalid="false">
                                    </span>
                                    <span class="form-field__input-wrapper_otp">
                                        <input class="form-field__input form-field__input--otp"
                                               id="form-field-otpnumber" name="text" type="number"
                                               aria-describedby="description-for-otpnumber"
                                               data-parsley-maxnumber="1"
                                               data-parsley-errors-container="#description-for-otpnumber"
                                               required="" data-parsley-required-message="@Translate.Text("cust.required.field")"
                                               data-parsley-trigger="focusout" data-parsley-id="8"
                                               aria-invalid="false">
                                    </span>
                                    <span class="form-field__input-wrapper_otp">
                                        <input class="form-field__input form-field__input--otp"
                                               id="form-field-otpnumber" name="text" type="number"
                                               aria-describedby="description-for-otpnumber"
                                               data-parsley-maxnumber="1"
                                               data-parsley-errors-container="#description-for-otpnumber"
                                               required="" data-parsley-required-message="@Translate.Text("cust.required.field")"
                                               data-parsley-trigger="focusout" data-parsley-id="10"
                                               aria-invalid="false">
                                    </span>
                                    <span class="form-field__input-wrapper_otp">
                                        <input class="form-field__input form-field__input--otp"
                                               id="form-field-otpnumber" name="text" type="number"
                                               aria-describedby="description-for-otpnumber"
                                               data-parsley-maxnumber="1"
                                               data-parsley-errors-container="#description-for-otpnumber"
                                               required="" data-parsley-required-message="@Translate.Text("cust.required.field")"
                                               data-parsley-trigger="focusout" data-parsley-id="12"
                                               aria-invalid="false">
                                    </span>
                                    <span class="form-field__input-wrapper_otp">
                                        <input class="form-field__input form-field__input--otp"
                                               id="form-field-otpnumber" name="text" type="number"
                                               aria-describedby="description-for-otpnumber"
                                               data-parsley-maxnumber="1"
                                               data-parsley-errors-container="#description-for-otpnumber"
                                               required="" data-parsley-required-message="@Translate.Text("cust.required.field")"
                                               data-parsley-trigger="focusout" data-parsley-id="14"
                                               aria-invalid="false">
                                    </span>
                                    <span class="form-field__input-wrapper_otp">
                                        <input class="form-field__input form-field__input--otp"
                                               id="form-field-otpnumber" name="text" type="number"
                                               aria-describedby="description-for-otpnumber"
                                               data-parsley-maxnumber="1"
                                               data-parsley-errors-container="#description-for-otpnumber"
                                               required="" data-parsley-required-message="@Translate.Text("cust.required.field")"
                                               data-parsley-trigger="focusout" data-parsley-id="16"
                                               aria-invalid="false">
                                    </span>
                                    <input class="form-field__input form-field__input--otp_main"
                                           id="form-field-otpnumbermain" name="text" type="number"
                                           aria-describedby="description-for-otpnumber"
                                           data-parsley-maxnumber="6"
                                           data-parsley-errors-container="#description-for-otpnumber"
                                           data-parsley-required-message="@Translate.Text("cust.required.field")"
                                           data-parsley-trigger="focusout" data-parsley-id="33">
                                    <div id="description-for-otpnumber" class="form-field__messages"></div>
                                </div>
                                <div class="form-field mt0 otp_inputdisplay_screen_error red hidden">
                                </div>
                                <div class="form-field">
                                    <div class="button button--timer timer-button--outline"
                                         data-component="m78-timer" id="timerbutton"
                                         timer-labels="{&quot;before&quot;:&quot;@Translate.Text("cust.resend.button.text")&quot;, &quot;after&quot;:&quot;@Translate.Text("cust.resend.button.text") (&quot;}"
                                         timer-time="{&quot;seconds&quot;:300}">
                                        <span class="m78-timer--button_text">@Translate.Text("cust.send.button.text")</span>
                                        <span class="m78-timer--button_time"></span>
                                    </div>
                                </div>
                                <div class="form-field"><span id="notmytext"></span> @Html.Raw(Translate.Text("Contact Customer Care Center"))</div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="m39-modal__overlay"> </div>
    </div>

}
<script src="~/scripts/External/nml/form-submit-validate.js"></script>
<script type="text/javascript">
    docReady(function () {
        var $confirmBtn = jQuery("#btnConfirm");
        var verifystep = null;
        var selectedOption = '@Model.SelectedIBAN';
        var selectedType = null;
        $confirmBtn.on('click', function (e) {
            verifystep = null;
            $("#OtpRequestId").val('');
            $(".otp_inputdisplay_screen_error").html('');
            $(".otp_inputdisplay_screen_error").hide();
            $('input[name="otp_diplay_input"]').prop('checked', false);
            $(".otp-title").html('');
            $(".otp-message").html('');
            $(".otp-message").removeClass("red");
            if (selectedOption == 'iban1') {
                jQuery(".otpselectionoption").hide();
                CrudOtp(GetReadRequestData("e"), function (rdata) {
                    e.preventDefault();
                    e.stopPropagation();
                    var title = '@Html.Raw(Translate.Text("cust.email.otp.screen.title"))';
                    var msg = '@Html.Raw(Translate.Text("cust.email.otp.screen.msg"))';
                    $(".m66-preloader-fullpage").fadeOut();
                    $(".otp_inputdisplay_screen").hide();
                    //$(".otp--modalcontent-text").hide();
                    $(".otp-title").html(title);
                    $(".otp_mailcheck").show();
                    $(".otp_chatcheck").hide();
                    $("#notmytext").html('@Translate.Text("cust.not.my.emailaddress")');
                    if (rdata.status) {
                        $(".otp-message").html(msg.replace("{0}", '@Model.MaskedEmailid'));
                        $("#OtpRequestId").val(rdata.data.otprequestid);
                        $(".otp_input_screen").show();
                        $(".otp_inputdisplay_screen_error").hide();

                        resetTimer();
                        $(".optpopuptrigger").trigger('click');
                    }
                    else {
                        $(".optpopuptrigger").trigger('click');
                        $(".otp_input_screen").hide();
                        $(".otp_inputdisplay_screen").show();
                        $(".otp_inputdisplay_screen_error").show();
                        //$(".otp--modalcontent-text").show();
                        $(".otp_inputdisplay_screen_error").html(rdata.desc);
                    }
                });
            }
            else {
                $(".optpopuptrigger").trigger('click');
                $(".otpselectionoption").show();
                $(".otp_input_screen").hide();
            }
        });
        jQuery(".btn-SendOtp").on("click", function () {
            var selected = $("input[type='radio'][name='otp_diplay_input']:checked");
            if (selected.length == 0) {
                return false;
            }
            CrudOtp(fnSendOtpRequestData(), function (rdata) {
                if ($(selected).attr("data-stype") == 'e') {
                    var title = '@Html.Raw(Translate.Text("cust.email.otp.screen.title"))';
                    $(".otp-title").html(title);
                }
                else {
                    var title = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.title"))';
                    $(".otp-title").html(title);
                }

                $(".m66-preloader-fullpage").fadeOut();
                $(".otp_inputdisplay_screen").hide();

                if (rdata.status) {
                    $(".otp-message").removeClass("red");
                    if ($(selected).attr("data-stype") == 'm') {
                        $(".otp_chatcheck").show();
                        $(".otp_mailcheck").hide();

                         var msg = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.msg"))';
                        $(".otp-message").html(msg.replace("{0}", '@Model.MaskedMobileNumber'));
                        $("#notmytext").html('@Translate.Text("cust.not.my.mobilenumber")');
                    }
                    else {
                        $(".otp_mailcheck").show();
                        $(".otp_chatcheck").hide();
                         var msg = '@Html.Raw(Translate.Text("cust.email.otp.screen.msg"))';
                        $(".otp-message").html(msg.replace("{0}", '@Model.MaskedEmailid'));
                        $("#notmytext").html('@Translate.Text("cust.not.my.emailaddress")');
                    }
                    $(".otp_input_screen").show();
                    $("#OtpRequestId").val(rdata.data.otprequestid);
                    jQuery(".otpselectionoption").hide();

                    resetTimer();
                    $(".optpopuptrigger").trigger('click');
                }
                else {
                    $(".optpopuptrigger").trigger('click');
                    //$(".otp-message").addClass("red");
                    $(".otp_inputdisplay_screen").show();
                    $(".otp_inputdisplay_screen_error").show();
                    $(".otpselectionoption").show();
                    // $(".otp--modalcontent-text").show();
                    $(".otp_inputdisplay_screen_error").html(rdata.desc);

                }
            });

        });
        setTimeout(function () {
           $(".form-field__input--otp").on('keyup blur', function () {
            var otp = jQuery(".form-field__input--otp_main").val();
            if (otp.length >= 6) {
                $(".form-field__input--otp").val('');
                CrudOtp(fnVerifyOtpData(otp), function (rdata) {
                    $(".m66-preloader-fullpage").fadeOut();
                    if (rdata.status) {
                        $(".otp-message").removeClass("red");
                        $(".otp_input_screen").hide();
                        $(".m39-modal__button--close").trigger('click');

                        jQuery('#confirmrefund').submit();
                        $("#btnConfirm").html('@Translate.Text("Submitting")...');
                        $("#btnConfirm").attr('disabled', true);
                        $(".m66-preloader-fullpage").show();


                        // if (selectedOption == "iban" && verifystep == null) {
                        //     verifystep = 1;
                        //     CrudOtp(GetReadRequestData("m"), function (rsdata) {
                        //         var title = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.title"))';
                        //         var msg = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.msg"))';
                        //         $(".m66-preloader-fullpage").fadeOut();
                        //         $(".otp_inputdisplay_screen").hide();
                        //         //$(".otp--modalcontent-text").hide();
                        //         $(".otp-title").html(title);
                        //         $("#notmytext").html('@Translate.Text("cust.not.my.mobilenumber")');
                        //         if (rsdata.status) {
                        //             $(".otp_chatcheck").show();
                        //             $(".otp_mailcheck").hide();
                        //
                        //             $(".otp-message").html(msg.replace("{0}", '@Model.MaskedMobileNumber'));
                        //             $("#OtpRequestId").val(rsdata.data.otprequestid);
                        //             $(".otp_input_screen").show();
                        //             $(".otp_inputdisplay_screen_error").hide();
                        //             $(".otp_inputdisplay_screen_success").show();
                        //
                        //             resetTimer();
                        //             $(".optpopuptrigger").trigger('click');
                        //         }
                        //         else {
                        //             $(".optpopuptrigger").trigger('click');
                        //             $(".otp_input_screen").hide();
                        //             $(".otp_inputdisplay_screen").show();
                        //             $(".otp_inputdisplay_screen_error").show();
                        //             $(".otp_inputdisplay_screen_success").hide();
                        //             //$(".otp--modalcontent-text").show();
                        //             $(".otp_inputdisplay_screen_error").html(rsdata.desc);
                        //         }
                        //     });
                        // }
                        // else {
                        //     jQuery('#confirmrefund').submit();
                        //     $("#btnConfirm").html('@Translate.Text("Submitting")...');
                        //     $("#btnConfirm").attr('disabled', true);
                        //     $(".m66-preloader-fullpage").show();
                        // }
                    }
                    else {
                        $(".optpopuptrigger").trigger('click');
                        //$(".otp-message").addClass("red");
                        $(".otp_input_screen").show();
                        $(".otp_inputdisplay_screen_error").show();
                        $(".otp_inputdisplay_screen_success").hide();
                        //$(".otp--modalcontent-text").show();
                        $(".otp_inputdisplay_screen_error").html(rdata.desc);
                    }
                });
            }
        });
        }, 500);

        jQuery("#timerbutton").on("click", function () {
            if (!jQuery("#timerbutton").hasClass("timer-button--outline")) {
                CrudOtp(fnSendOtpRequestData(), function (rdata) {
                    $(".m66-preloader-fullpage").fadeOut();
                    $(".otp_inputdisplay_screen").hide();
                    var selected = $("input[type='radio'][name='otp_diplay_input']:checked");
                    if ($(selected).attr("data-stype") == 'e') {
                        var title = '@Html.Raw(Translate.Text("cust.email.otp.screen.title"))';
                        var msg = '@Html.Raw(Translate.Text("cust.email.otp.screen.msg"))';
                        $(".otp_mailcheck").show();
                        $(".otp_chatcheck").hide();
                        $(".otp-message").html(msg.replace("{0}", '@Model.MaskedEmailid'));
                        $(".otp-title").html(title);
                    }
                    else {
                        var title = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.title"))';
                        var msg = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.msg"))';
                        $(".otp-message").html(msg.replace("{0}", '@Model.MaskedMobileNumber'));
                        $(".otp-title").html(title);
                        $(".otp_mailcheck").hide();
                        $(".otp_chatcheck").show();
                    }

                    //if (selectedOption != 'iban') {
                    //    var selected = $("input[type='radio'][name='otp_diplay_input']:checked");
                    //    if ($(selected).attr("data-stype") == 'e') {
                    //        var title = '@Html.Raw(Translate.Text("cust.email.otp.screen.title"))';
                    //        var msg = '@Html.Raw(Translate.Text("cust.email.otp.screen.msg"))';
                    //        $(".otp_mailcheck").show();
                    //        $(".otp_chatcheck").hide();
                    //        $(".otp-message").html(msg.replace("{0}", '@Model.MaskedEmailid'));
                    //        $(".otp-title").html(title);
                    //    }
                    //    else {
                    //        var title = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.title"))';
                    //        var msg = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.msg"))';
                    //        $(".otp-message").html(msg.replace("{0}", '@Model.MaskedMobileNumber'));
                    //        $(".otp-title").html(title);
                    //        $(".otp_mailcheck").hide();
                    //        $(".otp_chatcheck").show();
                    //    }
                    //}
                    //else {
                    //    if (verifystep == null) {
                    //        var title = '@Html.Raw(Translate.Text("cust.email.otp.screen.title"))';
                    //        var msg = '@Html.Raw(Translate.Text("cust.email.otp.screen.msg"))';
                    //        $(".otp_mailcheck").show();
                    //        $(".otp_chatcheck").hide();
                    //        $(".otp-message").html(msg.replace("{0}", '@Model.MaskedEmailid'));
                    //        $(".otp-title").html(title);
                    //    }
                    //    else {
                    //        var title = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.title"))';
                    //        var msg = '@Html.Raw(Translate.Text("cust.mobile.otp.screen.msg"))';
                    //        $(".otp-message").html(msg.replace("{0}", '@Model.MaskedMobileNumber'));
                    //        $(".otp-title").html(title);
                    //        $(".otp_mailcheck").hide();
                    //        $(".otp_chatcheck").show();
                    //    }
                    //}

                    if (rdata.status) {
                        $("#OtpRequestId").val(rdata.data.otprequestid);
                        $(".otp-message").removeClass("red");
                        $(".input-otp-textbox").show();
                        $(".otp_input_screen").show();

                        resetTimer();
                        $(".optpopuptrigger").trigger('click');
                    } else {
                        $(".optpopuptrigger").trigger('click');
                        $(".otp_input_screen").hide();
                        $(".otp_inputdisplay_screen").show();
                        $(".otp_inputdisplay_screen_error").show();
                        $(".otp_inputdisplay_screen_error").html(rdata.desc);
                    }
                });
            }
        });
        //$('#timerbutton').on('DOMNodeInserted', function () {
        //    if ($(this).hasClass('button--primary')) {
        //        $(this).closest('form').find('.form-field__input--otp').attr('disabled', true);
        //        $(this).closest('form').find('.form-field--otp').addClass('form-field-disabled');
        //    }
        //});
        function GetReadRequestData(type) {
            var mobile = null;
            var email = null;
            var bpno = null;
            var option = null
            var type = type;
            var otp = null;
            var prtype = "RFND";

            var requestData = {
                mobile: mobile,
                email: email,
                bpno: bpno,
                option: option,
                type: type,
                Otp: otp,
                prtype: prtype
            }
            requestData.mode = "S";
            if (verifystep != null)
                requestData.reqId = jQuery("#OtpRequestId").val();
            return requestData;
        }
        function fnVerifyOtpData(otp) {
            var requestData = GetReadRequestData();
            // if (selectedOption == "iban" && verifystep == null) {
            //     requestData.type = "e";
            // }
            // else if (selectedOption == "iban" && verifystep == 1) {
            //     requestData.type = "m";
            // }
            // else {
            //     var selected = $("input[type='radio'][name='otp_diplay_input']:checked");
            //     requestData.type = $(selected).attr("data-stype");
            // }

            var selected = $("input[type='radio'][name='otp_diplay_input']:checked");
            requestData.type = $(selected).attr("data-stype");
            requestData.Otp = otp;
            requestData.mode = "V";
            requestData.reqId = jQuery("#OtpRequestId").val()
            return requestData;
        }
        function fnSendOtpRequestData() {
            var requestData = GetReadRequestData();
            var selected = $("input[type='radio'][name='otp_diplay_input']:checked");
            requestData.type = $(selected).attr("data-stype");

           //if (selectedOption != 'iban') {
           //    var selected = $("input[type='radio'][name='otp_diplay_input']:checked");
           //    requestData.type = $(selected).attr("data-stype");
           //}
           //else {
           //    if (verifystep == null) { requestData.type = "e"; requestData.reqId = ""; }
           //    else {
           //        requestData.type = "m";
           //        requestData.reqId = jQuery("#OtpRequestId").val();
           //    }
           //}

            if( requestData.type == "m"){
                requestData.reqId = jQuery("#OtpRequestId").val();
            }else{
                 requestData.reqId = "";
            }
            requestData.mode = "S";
            return requestData;
        }
        AddCustomForgeryToken = function (data, elementId) {
            data.__RequestVerificationToken = $(elementId + ' input[name=__RequestVerificationToken]').val();
            return data;
        };
        function CrudOtp(requestData, onSuccess) {
            var _postUrl = '@Url.Content("~/api/sitecore/UpdateIBAN/CrudOtp")';
            requestData = AddCustomForgeryToken(requestData, "#confirmrefund");
            $.ajax({
                url: _postUrl,
                type: 'POST',
                data: requestData,
                beforeSend: function () {
                    $(".m39-modal__button--close").trigger('click');
                    $(".m66-preloader-fullpage").show();
                    $(".otp_inputdisplay_screen").hide();
                    $(".otp_input_screen").hide();
                    $(".otp_inputdisplay_screen_error").hide();
                    $(".otp_inputdisplay_screen_success").hide();
                },
                success: onSuccess,
                error: function (er) {
                    console.log(er);
                },
                complete: function (x) {
                    $(".m66-preloader-fullpage").fadeOut();
                    console.log(x);
                }
            });
        }
        //jQuery(".m39-modal__button--close").on("click", function () {
        //    jQuery('#timerbutton').addClass('stopped');
        //});
        function resetTimer() {
            $("#otpform").find('.form-field__input--otp').attr('disabled', false);
            $("#otpform").find('.form-field--otp').removeClass('form-field-disabled');
            setTimeout(function () {
                jQuery('.form-field--otp').find('.form-field__input--otp')[0].focus()
            }, 500);
            setTimeout(function () {
                jQuery('.button--timer').trigger('start.timer');
            }, 500);
        }
    });
</script>
