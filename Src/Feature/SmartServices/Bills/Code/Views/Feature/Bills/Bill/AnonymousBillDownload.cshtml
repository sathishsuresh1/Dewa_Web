@using Sitecore.Globalization
@using Sitecore.Mvc
@using Sitecore.Mvc.Configuration
@using DEWAXP.Foundation.Helpers

@{ 
    if (ReCaptchaHelper.Recaptchasetting())
    {
        ViewBag.SiteKey = ReCaptchaHelper.RecaptchaSiteKey();
        ViewBag.Recaptcha = true;
    }
    else
    {
        ViewBag.Recaptcha = false;
    }
}
@Html.Sitecore().Placeholder("j15/m26-page-title")

@using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, new { q = Request.QueryString["q"] }, FormMethod.Post, new { @data_parsley_focus = "true", @data_form = "true", @class = "form", @novalidate = "novalidate" }))
{
    @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")
    @Html.Sitecore().FormHandler()
    @Html.AntiForgeryToken()
    <div class="grid__row">
        <div class="grid__column grid__column--12 grid__column--form">
            <p>@Html.Sitecore().Placeholder("billdescription")</p>
            @if (Convert.ToBoolean(ViewBag.Recaptcha))
            {
                <div class="mt12">
                    <div class="g-recaptcha" id="captcha" data-callback="recaptchaCallback" data-expired-callback="recaptchaCallback" data-sitekey="@ViewBag.SiteKey"></div>
                    <span id='errorContainer' class="parsley-errors-list"></span>
                </div>
            }
            @*<div class="aspcaptcha">
                    @Html.Captcha(Translate.Text("Bill-Refresh"), Translate.Text("Bill-Captcha"), 5, "Is required field", true)
                </div>*@
        </div>

        <div class="grid__column grid__column--12 grid__column--centered">
            <button style="padding: 6px 32px;" id="billdownload-button" type="submit" class="button button--secondary button--submit" data-submission-text="@Translate.Text("Submitting")...">@Translate.Text("Bill.Download")</button>
        </div>
    </div>
}

<script type="text/javascript">
    docReady(function () {
        jQuery('.m12-main__navs').hide();
        jQuery('#rs_area').addClass('forceEN');
        jQuery('a').each(function () {
            if (jQuery(this).attr('href') == '#CaptchaImage') {
                jQuery(this).attr('href', 'javascript:void(0);');
            }
        })
    });
</script>
<script>
    docReady(function () {
        require(['parsley'], function () {
            jQuery('.button--submit').off('click.submit').on('click.submit', function (e) {
                    var captcha = recaptchaCallback();
                if (!captcha) {
                        e.preventDefault();
                        return false;
                    }
                    else {
                        return true;
                    }
            });
        });
    });
    function recaptchaCallback() {
        var v = grecaptcha.getResponse();
        if (v.length == 0) {
            jQuery('#errorContainer').text('@Translate.Text("FG_Capatcha_Valid")');
            return false;
        }
        else {
            jQuery('#errorContainer').text("");
            return true;
        }
    }
</script>