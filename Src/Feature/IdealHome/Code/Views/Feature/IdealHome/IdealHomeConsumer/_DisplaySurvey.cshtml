@model DEWAXP.Feature.IdealHome.Models.IdealHomeConsumer.SectionList
@using DEWAXP.Foundation.Helpers
@using Glass.Mapper.Sc.Fields
@using Sitecore.Mvc
@using Sitecore.Mvc.Configuration
@using Sitecore.Globalization
@using DEWAXP.Foundation.Content

<style>
    .parsley-errors-list {
        display: none;
    }

    .survey-error {
        font-size: .95em;
        margin: 18px 27px;
        color: #B00020;
    }
</style>
<div class="grid">


    <div class="grid__row">
        <div class="grid__column grid__column--12">
            @Html.Sitecore().Placeholder("ideal-home-score")
        </div>
    </div>



    <div class="grid__row">
        <div class="grid__column grid__column--12 grid__column--content">

            <div class="m38-step-tracker" data-component="m38-step-tracker" data-total-steps="@Model.TotalStep" data-current-step="@Model.CurrentStep">
                <div class="m38-step-tracker__progressbar" data-m38-progressbar="true" role="progressbar" aria-valuetext="Display Survey">

                </div>
            </div>

            <p class="intro-text j106-ideal-home__survey-section"></p>
        </div>
    </div>

    <div class="grid__row j106-ideal-home__questionnaires">
        <div class="grid__column grid__column--12 grid__column--content">


            @using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, new { returnUrl = "" }, FormMethod.Post, new { @data_parsley_focus = "true", @data_form = "true", @class = "form", @data_submit_validate = "enabled", @novalidate = true, @autocomplete = "off" }))
            {
                @Html.Sitecore().FormHandler()
                @Html.AntiForgeryToken()

                @Html.Partial("~/Views/Feature/CommonComponents/Shared/_SubmissionError.cshtml")

                @Html.HiddenFor(m => m.SelectedSection.ItemIndex, Request.QueryString["Item"]);

                if (Model.SelectedSection != null)
                {
                    <script>

                        $(".j106-ideal-home__survey-section").html("@Model.SelectedSection.SectionTitle");
                    </script>

                    foreach (var questionlist in Model.SelectedSection.QuestionsList)
                    {
                        <div class="form-field">

                            <fieldset class="fieldset">

                                <legend class="form-field__label">

                                    @questionlist.Question

                                    @{
                                        var id = questionlist.Item.ID;
                                    }



                                </legend>

                                @foreach (var answersList in questionlist.AnswersList)
                                {

                                    <p class="form-field__radio ">
                                        <label>
                                            <input class="form-field__input form-field__input--radio" id="@id" aria-label="@id"
                                                   name="Radio|@id"
                                                   type="radio"
                                                   value="@id|@answersList.Item.ID"
                                                   aria-describedby="description-for-@id"
                                                   data-parsley-errors-container="#description-for-f1s61g9ye"
                                                   data-parsley-required-message="@Translate.Text("J106.FieldRequired")"
                                                   required>

                                            <span class="form-field__fakeradio focus-enabled">

                                                @answersList.Text

                                            </span>
                                        </label>
                                    </p>

                                }


                                <div class="survey-error"></div>

                            </fieldset>

                        </div>
                        <div id="description-for-@id" class="form-field__messages">

                        </div>
                        <span class="form-field__label-required aria-only">(required)</span>
                    }

                }
                <div class="form-field__button">

                    <button type="submit" class="button button--primary button--next" data-submission-text="@Translate.Text("Submitting")...">@Translate.Text("J106.ContinueLabel")</button>

                </div>
            }


        </div>

    </div>

</div>

<script src="~/Scripts/External/nml/form-submit-validate.js"></script>
<script type="text/javascript">
    $('.button--primary').on('click', function () {
        setTimeout(function () {
            $('.parsley-required').each(function () {
                var survey_error = $(this).closest('.fieldset').find('.survey-error');
                survey_error.html($(this).html())
            })


        }, 1)
    });
    $('.form-field__input--radio').on('click', function () {
        var _this = this,
            survey_error = $(this).closest('.fieldset').find('.survey-error');

        survey_error.html('')


    });
</script>